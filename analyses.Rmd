---
title: "Ranging after reintroduction: do behavioural traits predict dispersal into new territory?"
author: "Gee C & Wilson B A" 
date: "May 22, 2025"
output: 
  html_document:
    toc: true
    number_sections: true
    top_depth: 3
    toc_float:
      collapsed: true
    theme: cerulean
    highlight: pygments
editor_options:
  chunk_output_type: console
knit: (function(inputFile, encoding) { rmarkdown::render(inputFile, encoding=encoding, output_file=file.path(dirname(inputFile), 'tutorial.html')) })
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, eval=TRUE)
```

# **Background**

This [R project](https://support.posit.co/hc/en-us/articles/200526207-Using-RStudio-Projects) presents the workflows and datasets used in the '*Ranging after reintroduction: do behavioural traits predict dispersal into new territory?*' project. For information on our methodological approach, see the [GitHub repo](https://github.com/coexistence-conservation-lab/eastern-quoll-behaviour-and-dispersal) README.

# **Abbreviations**

*Locations, organisations, and platforms*

  - **ACT:** Australian Capital Territory
  - **ANU:** The Australian National University
  - **API:** Application Programming Interface
  - **CCL:** Coexistence Conservation Lab
  - **GS:** Goorooyarroo Sanctuary
  - **MFGO:** Mulligans Flat–Goorooyarroo Woodland Experiment
  - **MFWS** or **MF:** Mulligans Flat Woodland Sanctuary

*Technical:*

  - **CMR:** capture-mark-recapture
  - **df:** dataframe
  - **GLM:** generalised linear model
  - **GLMM:** generalised linear mixed model
  - **mod:** model
  
# **Setup**

  1. Manually install prerequisite packages.
  
Here we install the [pacman](https://cran.r-project.org/web/packages/pacman/index.html) package, which enables efficient installation and loading of other packages. Note that this only needs to be done once per computer.

```{r, eval=FALSE}
# Manually install package
install.packages("pacman")
```

 2. Install and load other required packages using the `pacman` package.

```{r, results='hide', warning=FALSE, message=FALSE}
# Install and load required packages
               # General functions
pacman::p_load(beepr, broom, broom.mixed, dplyr, glue, grid, gtools, 
               here, janitor, lubridate, openxlsx, readxl, rprojroot, 
               sjlabelled, sjmisc, tidyverse, writexl, yaml, 
               # Plotting
               ggplot2, ggpubr, scales, sjPlot, viridis, 
               # Mapping
               ggmap, sf, sp, 
               # Analyses
               AICcmodavg, corrplot, kableExtra, lme4, lmerTest, MuMIn) 
```

  3. Assign custom values and global settings.

```{r}
# Define paths to objects
raw_data <- "input/raw data.xlsx"
processed_data <- "output/processed data.xlsx"

# Define repeated values and constants to objects
# MFWS centre coordinates
centre_lat <- -35.184396
centre_lon <- 149.171633

# Global setting to deactivate scientific notation
options(scipen=100, digits=4)
```

For consistency, here we assign steel- and viridis-scale colour codes as objects, rather than repeating the HEX codes for each of our plots.

```{r}
# Define discrete steel-scale colour codes
white    <- "#FFFFFF" 
mist     <- "#F0F0F0" 
silver   <- "#E5E5E5" 
steel    <- "#A9A9A9"
charcoal <- "#333333"
black    <- "#000000" 

# Define discrete viridis-scale colour codes
vir1     <- "#FDE725" # yellow 
vir2     <- "#D8E219" # citrus 
vir3     <- "#B5DE2B" # lime 
vir4     <- "#90D743" # apple 
vir5     <- "#69CD5B" # grass 
vir6     <- "#42BE71" # mint 
vir7     <- "#27AD81" # teal 
vir8     <- "#1FA088" # turquoise 
vir9     <- "#2A788E" # cyan 
vir10    <- "#3A528B" # azure 
vir11    <- "#443983" # indigo 
vir12    <- "#472D7B" # violet 
vir13    <- "#481B6D" # eggplant 
vir14    <- "#440154" # plum 

```

  4. Register Google API key.

To use Google's basemaps in our plots, we need a [Google API key](https://developers.google.com/maps/documentation/javascript/get-api-key). If you don't have one, you will need to create one and save it to the `api.txt` file in this repo's `/metadata` folder. We have set up the repo's `.gitgnore` file so that will ignore the `api.txt` file when pushing to Git, so that your key will remain secure on your local copy. 

To [create a Google API key](https://support.google.com/googleapi/answer/6158862?hl=en):

  1. Go to Google Maps Platform [Credentials page](https://console.cloud.google.com/project/_/google/maps-apis/credentials?utm_source=Docs_CreateAPIKey&utm_content=Docs_maps-backend&_gl=1*zug43g*_ga*NjUyNDE0MDgyLjE3NDAwMTA3ODc.*_ga_NRWSTWS78N*czE3NDY2ODU4MTkkbzMkZzEkdDE3NDY2ODU4NDMkajAkbDAkaDA.)
  2. `Create project` (e.g., "RStudio") > `No organisations` > `Create`. This will create a project, along with an API key > 
  3. Copy `your API key` > check `Enable all Google Maps APIs for this project` > `Go to Google Maps Platform`. 
  4. For `Protect your API key`, click `Maybe later`. Now you have an active Google Maps API key, which you can find under `Keys and credentials` in the left sidebar. 
  5. Next, go to the RStudio `Files` pane > click the `metadata` folder > click `api.txt` > paste your new Google Maps API key here > `Save` and close.
  6. Finally, register your API key using the code below. 

```{r, eval=FALSE}
# Read API key as a character string, while trimming whitespace
api_key <- trimws(readLines("metadata/api.txt", warn=FALSE))

# Register your Google API
ggmap::register_google(key=api_key)
```

   5. Set up [beepr](https://cran.r-project.org/web/packages/beepr/readme/README.html) package to play a sound when long-running code segments (🐢) finish running. 

```{r}
# Assign beepr sound; options include ping, coin, fanfare, complete, shotgun, 
# mario, treasure, ready, wilhelm, facebook, sword (try them out!)
sound <- "coin"
```

# **Map**

```{r, eval=FALSE}
# Read in trap site coordinates
traps <- read_excel(raw_data, sheet="sites") %>% 
  # Standardise column names to lowercase with underscores
  clean_names() %>% 
  # Remove eastern quoll den sites
  filter(type!="EQD")

# Fetch satellite map using Google Maps API
sat <- get_map(location=c(lon=centre_lon, lat=centre_lat), 
               zoom=13, source="google", maptype="satellite", crop=TRUE)

# Read in and reproject GS shapefile 
gs <- st_read("input/shapefiles/gs_polygon.shp", quiet=TRUE) %>%
  st_transform(crs=4326)

# Read in and reproject MFWS shapefile 
mfws <- st_read("input/shapefiles/mfws_polygon.shp", quiet=TRUE) %>%
  st_transform(crs=4326)

# Read in and reproject waterbodies shapefile 
water <- st_read("input/shapefiles/mfgo_water_polygons.shp", quiet=TRUE) %>%
  st_transform(crs=4326)
```

```{r, eval=FALSE}
# Plot infrastructure on satellite map
site_map <- ggmap(sat) + 
  # Goorooyarroo Sanctuary 
  geom_sf(data=gs, inherit.aes=FALSE, size=1, alpha=0.2, 
          col=vir1, fill=vir1) + 
  # Mulligans Flat Woodland Sanctuary
  geom_sf(data=mfws, inherit.aes=FALSE, size=6, alpha=0.2, shape=21, 
          col=vir4, fill=vir4) + 
  # Water bodies
  geom_sf(data=water, inherit.aes=FALSE, size=1, alpha=0.75, 
          col=vir8, fill=vir8) + 
  # Trap sites
  geom_text(traps, mapping=aes(x=longitude, y=latitude, label=waypoint), 
            col=white, size=2) + 
  theme(axis.text.x=element_blank(), 
        axis.text.y=element_blank(), 
        axis.ticks.x=element_blank(), 
        axis.ticks.y=element_blank(), 
        legend.key=element_blank(), 
        legend.position="none", 
        panel.background=element_rect(fill=white), 
        panel.grid.major=element_blank(), 
        plot.margin=unit(c(t=-5, r=-5, b=-5, l=-9), "cm")) + 
  labs(x="", y="") 

# Display plot
print(site_map)
```

```{r, eval=FALSE}
# Export plot to a jpeg file
ggsave(site_map, filename="output/plots/site map.jpeg", 
       height=20, width=20, units="cm")
```

# **Data preparation**

Read in meta, quoll, capture, and session data.

```{r}
# Read in metadata
meta <- read_excel(raw_data, sheet="metadata", na="N/A") %>% 
  # Standardise column names to lowercase with underscores
  clean_names() 

# Read in quoll data
quoll <- read_excel(raw_data, sheet="quoll", na="N/A") %>%
  # Standardise column names to lowercase with underscores
  clean_names()

# Read in capture data
capture <- read_excel(raw_data, sheet="captures") %>%
  # Standardise column names to lowercase with underscores
  clean_names()

# Read in session data
session <- read_excel(raw_data, sheet="sessions") %>%
  # Standardise column names to lowercase with underscores
  clean_names()
```

Generate behavioural occurrence dataset.

```{r}
# Read in behavioural assay data
raw <- read_excel(raw_data, sheet="assays", na="N/A") %>% 
  # Standardise column names to lowercase with underscores
  clean_names() %>%
  # Select relevant columns
  select("obs_id"="observation_id", "assay_id", "quoll_code", 
         behaviour="behavior", occurrences="total_number_of_occurences")

# Convert behavioural occurrences data to wide format 
occ <- pivot_wider(data=raw, 
                   names_from=behaviour, 
                   values_from=occurrences) %>%
  # Standardise column names to lowercase with underscores
  clean_names() %>%
  # Convert columns to numeric
  mutate(across(all_of(c("section_1", "section_2", "section_3", "section_4", 
                         "moving", "jump_climb", "food", "legs", "grooming", 
                         "resting", "perch")), as.numeric)) %>%
  # Rename columns
  rename(section_1_o="section_1", 
         section_2_o="section_2", 
         section_3_o="section_3", 
         section_4_o="section_4", 
         moving_o="moving", 
         jump_climb_o="jump_climb", 
         food_o="food", 
         legs_o="legs", 
         grooming_o="grooming", 
         resting_o="resting", 
         perch_o="perch")
```

Generate behavioural duration dataset.

```{r}
# Read in raw behavioural data
raw <- read_excel(raw_data, sheet="assays", na="N/A") %>% 
  # Standardise column names to lowercase with underscores
  clean_names() %>% 
  # Select relevant columns
  select("obs_id"="observation_id", "assay_id", quoll_code, 
         behaviour="behavior", duration="total_duration_s") 

# Convert behavioural duration data to wide format
dur <- pivot_wider(data=raw, 
                   names_from=behaviour, 
                   values_from=duration) %>% 
  clean_names() %>%
  mutate(across(all_of(c("section_1", "section_2", "section_3", "section_4", 
                         "moving", "jump_climb", "food", "legs", "grooming", 
                         "resting", "perch")), as.numeric)) %>%
  rename(section_1_d="section_1", 
         section_2_d="section_2", 
         section_3_d="section_3", 
         section_4_d="section_4", 
         moving_d="moving", 
         jump_climb_d="jump_climb", 
         food_d="food", 
         legs_d="legs", 
         grooming_d="grooming", 
         resting_d="resting", 
         perch_d="perch")
```

Combine datasets.

```{r}
# Combine occurrence and duration data
assays <- left_join(occ, dur, by=c("obs_id", "assay_id", "quoll_code"))

# Sum visitations per 'section'
assays$sumsect_o <- rowSums(assays[, c("section_1_o", "section_2_o", 
                                       "section_3_o", "section_4_o")])

# Sum total activity occurrences
assays$totalact_o <- rowSums(assays[, c(4:10)])

# Append metadata for each assay
behavdata <- left_join(meta, assays, by=c("assay_id", "quoll_code")) %>%
  filter(!is.na(assay_number))

behavdata <- left_join(behavdata, session, by=c("session")) %>%
  filter(!is.na(assay_number))

quolldata <- left_join(capture, quoll, by=c("quoll_code"))

data <- left_join(behavdata, quolldata, by=c("session", "quoll_code"))

# Mutate the df
data <- data %>%
  select(-min_temp, -session_desc, -capture_date, -new_animal) %>%
  mutate(assay_number=as.factor(assay_number), 
         cond_n=as.numeric(ifelse(condition=="Excellent", 4, 
                           ifelse(condition=="Good", 3, 
                           ifelse(condition=="Fair", 2, NA)))), 
         age_n=as.numeric(ifelse(age_estimate=="<1yr", 0, 
                          ifelse(age_estimate=="1-2yrs", 1, 
                          ifelse(age_estimate=="2-3yrs", 2, NA))))) %>%
  # Shorten column names
  mutate(site=study_site, 
         assay_n=assay_number, 
         emerge_time=time_to_emerge_s, 
         bait_eaten=bait_eaten_g, 
         stress_trap=stress_in_trap, 
         stress_bag=stress_in_bag, 
         stress_table=stress_on_table, 
         weight=body_weight_kg, 
         age=age_estimate, 
         pes_mean=pes_mean_mm, 
         head_length=head_length_mm) %>%
  mutate(assay_n=as.factor(assay_n))
```

## Calculate time differences 

```{r}
# Change time columns to correct POSIXct format
data <- data %>%
  # Convert columns to data format
  mutate(snout=as.POSIXct(snout), 
         process_end=as.POSIXct(process_end), 
         first_light=as.POSIXct(first_light), 
         # Calculate time differences
         time_process_assay=snout - process_end, 
         time_assay_light=first_light - snout) %>%
  # Remove two individuals who were assayed in September 2023
  filter(!(quoll_code %in% c("53328", "87DE0")))
```

## Correlation analysis

Conduct a correlation analysis to assess which morphological traits accounted for similar variation.

```{r}
cor <- data  %>% 
  dplyr::select(age_n, weight, cond_n, pes_mean, head_length)

# Running the correlation test
cor <- cor(cor)

# Export to a csv file
write.csv(cor, "output/morphology correlation matrix.csv")

# Create and print correlation matrix jpeg
col_names <- c("Age estimate", "Body weight (kg)", "Condition", 
               "Pes length (mm)", "Head length (mm)")
row_names <- c("Age estimate", "Body weight (kg)", "Condition", 
               "Pes length (mm)", "Head length (mm)")
colnames(cor) <- col_names
rownames(cor) <- row_names

# Correlation of occurrences and duration with sections
jpeg(height=2000, width=2000, file="output/plots/correlation matrix.jpeg", 
     type="cairo")
corrplot(cor, method="color", col=colorRampPalette(c(vir4, white, vir11))(10), 
         type="upper", # creates a correlation matrix
         cl.cex=3, number.cex=4, tl.cex=4, diag=FALSE, 
         tl.col=black, tl.srt=45, addCoef.col=black)
dev.off()
```

# **Single assays**

I created a data subset to test the demographic, morphometric and behavioural variables for the first assay for all 36 individual eastern quolls. 

Subset data to include first assays only.

```{r}
# Filter data to only first assays
data1 <- data %>% filter(assay_n !=2)

# 
data1$site01 <- ifelse(data1$site=="Goorooyarroo", 1, 0)

# 
write.csv(data1, "output/data1 - first assay data raw.csv")
```

Convert the df to the format needed.

```{r}
# 
data1 <- data1 %>%
  mutate(age_n=as.numeric(as.character(age_n)), 
         condition=factor(condition, levels=c("Excellent", "Good", 
                                              "Fair", "Poor")), 
         # Convert to factor
         age=as.factor(age)) %>%
  # Assign new labels
  mutate(age=recode(age, "1-2yrs"="1–2 years", 
                    "<1yr"="<1 year", 
                    "2-3yrs"="2–3 years"))  %>%
  # Reorder new labels
  mutate(age=factor(age, levels=c("2–3 years", "1–2 years", "<1 year")))
```

## Demographic and morphological analysis

```{r}
# Build model
mod <- glm(site01 ~ sex + weight + age_n + cond_n, data=data1, family=binomial)

# Summarise model
summary(mod)
```

## Extract table

```{r}
# Reduce decimal points to 3 digits
tidy_results <- tidy(mod) %>%
  mutate_if(is.numeric, ~round(., digits=3))

# Format table
table <- tidy_results %>%
  mutate(p.value=ifelse(p.value <=0.05, 
                        cell_spec(p.value, bold=TRUE), 
                        p.value)) %>%
  kbl(caption="Study site", escape=FALSE) %>%
  #kable_classic(full_width=F, html_font="Times New Roman") %>%
  #kable_styling(bootstrap_options="striped", font_size=15)

# Display table
print(table)
```

## Plot demographics and morphology

```{r}
# Plot smoothed regression, warnings expected
age_plot  <- ggplot() + 
  geom_smooth(data=data1, aes(x=age_n, y=as.numeric(site01)), 
              col=vir8, fill=vir8) + 
  annotate("text", x=1.9, y=0.95, label="a", size=8, hjust=1) + 
  annotate("text", x=0.3, y=0.95, label=expression(italic(p) == 0.045), size=5) +
  theme_minimal() + 
  theme(panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=16)) + 
  scale_y_continuous(breaks=seq(-0.4, 1, 0.2), 
                     labels=seq(-0.4, 1, 0.2), 
                     limits=c(-0.4, 1)) + 
  xlab("Age estimate (yrs)") + ylab("Probability of capture in MFWS (0) or GS (1)") 

# Display plot
print(age_plot)
```

```{r}
# Plot smoothed regression, warnings expected
weight_plot  <- ggplot() + 
 geom_smooth(data=data1, aes(x=weight, y=as.numeric(site01)), 
             col=vir13, fill=vir13) + 
  annotate("text", x=1.6, y=0.95, label="b", size=8, hjust=-0.5) + 
  annotate("text", x=0.6, y=0.95, label=expression(italic(p) == 0.031), size=5) +
  theme_minimal() + 
  theme(panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=16)) + 
   scale_y_continuous(breaks=seq(-0.4, 1, 0.2), 
                      labels=seq(-0.4, 1, 0.2), 
                      limits=c(-0.4, 1)) + 
  xlab("Body weight (kg)") + ylab("") 

# Display plot
print(weight_plot)
```

```{r}
# Plot smoothed regression, warnings expected
cond_plot <- ggplot() + 
  geom_smooth(data=data1, aes(x=cond_n, y=as.numeric(site01)), 
              col=vir9, fill=vir9) + 
  annotate("text", x=3.9, y=0.95, label="c", size=8, hjust=1) + 
  annotate("text", x=2.3, y=0.95, label=expression(italic(p) == 0.041), size=5) +
  theme_minimal() + 
  theme(panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=16)) + 
  scale_y_continuous(breaks=seq(-0.4, 1, 0.2), 
                     labels=seq(-0.4, 1, 0.2), 
                     limits=c(-0.4, 1)) + 
  xlab("Body condition score") + ylab(" ")

# Display plot
print(cond_plot)
```

```{r}
# Combine grooming plots
plot <- ggarrange(age_plot, weight_plot, cond_plot, nrow=1, ncol=3)
plot <- annotate_figure(plot, bottom=text_grob("Demographic and morphological variables", size=20))
plot <- annotate_figure(plot, left=text_grob("Study site", rot=90, size=20))

# Display plot
print(plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/morphology plots.jpeg", 
       plot, width=350, height=150, units="mm")
```

## Environmental vars influence GLM analysis

```{r}
# Summarise models
summary(glm(food_d ~ temp + moon_phase + 
              time_assay_light + time_process_assay, data=data1))
summary(glm(food_o ~ temp + moon_phase + 
             time_assay_light + time_process_assay, data=data1))

summary(glm(grooming_d ~ temp + moon_phase + 
             time_assay_light + time_process_assay, data=data1))
summary(glm(grooming_o ~ temp + moon_phase + 
             time_assay_light + time_process_assay, data=data1))

summary(glm(jump_climb_d ~ temp + moon_phase + 
             time_assay_light + time_process_assay, data=data1))
summary(glm(jump_climb_o ~ temp + moon_phase + 
             time_assay_light + time_process_assay, data=data1))

summary(glm(legs_d ~ temp + moon_phase + 
             time_assay_light + time_process_assay, data=data1))
summary(glm(legs_o  ~ temp + moon_phase + 
             time_assay_light + time_process_assay, data=data1))

summary(glm(moving_d ~ temp + moon_phase + 
             time_assay_light + time_process_assay, data=data1))
summary(glm(moving_o ~ temp + moon_phase + 
             time_assay_light + time_process_assay, data=data1))

summary(glm(perch_d ~ temp + moon_phase + 
             time_assay_light + time_process_assay, data=data1))
summary(glm(perch_o ~ temp + moon_phase + 
             time_assay_light + time_process_assay, data=data1))

summary(glm(bait_eaten ~ temp + moon_phase + 
              time_assay_light + time_process_assay, data=data1))
summary(glm(sumsect_o ~ temp + moon_phase + 
              time_assay_light + time_process_assay, data=data1))
summary(glm(totalact_o ~ temp + moon_phase + 
              time_assay_light + time_process_assay, data=data1))
summary(glm(emerge_max ~ temp + moon_phase + 
              time_assay_light + time_process_assay, data=data1))

summary(glm(stress_trap ~ temp + moon_phase, data=data1))
summary(glm(stress_bag ~ temp + moon_phase, data=data1))
summary(glm(stress_table ~ temp + moon_phase, data=data1))
```

## Environmental variables model extraction
```{r}
# Build model for extraction
mod <- (glm(stress_table ~ temp + moon_phase, data=data1))

# Summarise model
summary(mod)
```

## Environmental variables table

```{r}
# Tables with kableExtra
response_var <- all.vars(formula(mod))[1]

# 
tidy_results <- tidy(mod) %>%
  mutate_if(is.numeric, ~round(., digits=10))
# 
table <- tidy_results %>%
  mutate(p.value=ifelse(p.value <=0.05, 
                        cell_spec(p.value, bold=TRUE), 
                        p.value)) %>%
  kbl(caption=response_var, escape=FALSE) %>%
  kable_classic(full_width=F, html_font="Times New Roman") %>%
  #kable_styling(bootstrap_options="striped", font_size=12)

# 
print(table)
```

## Analysis of behaviour indicators

  1. Test the influence of fixed (e.g., site) and random effects (e.g., arena) on behavioural responses (e.g., food interaction duration) using the `lmer()` function.
  2. If multiple fixed effects produce significance, perform model selection using the `dredge()` function to determine which fixed effects are within delta 2 AICc.

## Capture behaviour GLMMS

Test behaviour in GLMMs including environmental variables as competing factors in fixed effects model.

```{r}
# 
summary(lmer(bait_eaten ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data1, na.action="na.fail", REML=FALSE))
summary(lmer(emerge_max ~ site + sex + age_n + cond_n + weight + temp + 
               (1|arena), data=data1, na.action="na.fail", REML=FALSE))

summary(lmer(food_d ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data1, na.action="na.fail", REML=FALSE))
summary(lmer(food_o ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data1, na.action="na.fail", REML=FALSE))

summary(lmer(grooming_d ~ site + sex + age_n + cond_n + weight + temp + 
               (1|arena), data=data1, na.action="na.fail", REML=FALSE))
summary(lmer(grooming_o ~ site + sex + age_n + cond_n + weight + temp + 
               (1|arena), data=data1, na.action="na.fail", REML=FALSE))

summary(lmer(jump_climb_d ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data1, na.action="na.fail", REML=FALSE))
summary(lmer(jump_climb_o ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data1, na.action="na.fail", REML=FALSE))

summary(lmer(legs_d ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data1, na.action="na.fail", REML=FALSE))
summary(lmer(legs_o ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data1, na.action="na.fail", REML=FALSE))

summary(lmer(moving_d ~ site + sex + age_n + cond_n + weight + 
               time_assay_light + 
               (1|arena), data=data1, na.action="na.fail", REML=FALSE))
summary(lmer(moving_o ~ site + sex + age_n + cond_n + weight + 
               time_assay_light + 
               (1|arena), data=data1, na.action="na.fail", REML=FALSE))

summary(lmer(perch_d ~ site + sex + age_n + cond_n + weight + temp + 
               moon_phase + time_assay_light + time_process_assay + 
               (1|arena), data=data1, na.action="na.fail", REML=FALSE))
summary(lmer(perch_o ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data1, na.action="na.fail", REML=FALSE))

summary(lmer(stress_bag ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data1, na.action="na.fail", REML=FALSE))
summary(lmer(stress_trap ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data1, na.action="na.fail", REML=FALSE))
summary(lmer(stress_table ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data1, na.action="na.fail", REML=FALSE))

summary(lmer(sumsect_o ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data1, na.action="na.fail", REML=FALSE))

summary(lmer(totalact_o ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data1, na.action="na.fail", REML=FALSE))
```

```{r}
# Tables with kableExtra
response_var <- all.vars(formula(mod))[1]

# 
tidy_results <- tidy(mod) %>%
  mutate_if(is.numeric, ~round(., digits=3))

# 
table <- tidy_results %>%
  mutate(p.value=ifelse(p.value <=0.05, 
                        cell_spec(p.value, bold=TRUE), 
                        p.value)) %>%
  kbl(caption=response_var, escape=FALSE)

# 
print(table)
```

## Capture behaviour AICc model selection

```{r}
# 
control_ml <- lmerControl(optimizer="Nelder_Mead")

# Grooming duration 
mod_gd_site <- lmer(grooming_d ~ site + (1|arena), data=data1, 
                    control=control_ml, na.action="na.fail", REML=FALSE)

# 
mod_gd_temp <- lmer(grooming_d ~ temp + (1|arena), data=data1, 
                    control=control_ml, na.action="na.fail", REML=FALSE)

# 
models <- list(mod_gd_site, mod_gd_temp)

# 
model.names <- c("Site", "Temp")

# Model selection
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Grooming occurrences
mod_go_site <- lmer(grooming_o ~ site + (1|arena), data=data1, 
                    control=control_ml, na.action="na.fail", REML=FALSE)

# 
mod_go_temp <- lmer(grooming_o ~ temp + (1|arena), data=data1, 
                    control=control_ml, na.action="na.fail", REML=FALSE)

# 
models <- list(mod_go_site, mod_go_temp)

# 
model.names <- c("Site", "Temp")

# Model selection
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Latency to emerge
mod_emerge_temp <- lmer(emerge_max ~ temp + (1|arena), data=data1, 
                        control=control_ml, na.action="na.fail", REML=FALSE)

# 
mod_emerge_weight <- lmer(emerge_max ~ weight + (1|arena), data=data1, 
                          control=control_ml, na.action="na.fail", REML=FALSE)

# 
mod_emerge_age <- lmer(emerge_max ~ age_n + (1|arena), data=data1, 
                       control=control_ml, na.action="na.fail", REML=FALSE)

# 
models <- list(mod_emerge_temp, mod_emerge_weight, mod_emerge_age)

# 
model.names <- c("Temp", "Weight", "Age")

# 
aictab(cand.set=models, modnames=model.names)
```

## Capture behaviour plots

```{r}
# Grooming duration by study site plot
groomd_site <- ggplot(data=data1, aes(x=site, y=grooming_d, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=110, label="a", size=9, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=18), 
        axis.text.x=element_text(size=18)) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(0, 110, 20), 
                     labels=seq(0, 110, 20), 
                     limits=c(0, 110)) + 
  labs("") + xlab("") + ylab("Grooming duration (s)") 

# Display plot
print(groomd_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/1 assay/study site by grooming dur.jpeg", 
       groomd_site, width=150, height=150, units="mm")
```

```{r}
# Grooming occurrences by study site plot
groomo_site <- ggplot(data=data1, aes(x=site, y=grooming_o, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=8, label="b", size=9, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=18), 
        axis.text.x=element_text(size=18)) + 
  scale_fill_manual(values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(0, 8, 2), 
                     labels=seq(0, 8, 2), 
                     limits=c(0, 8)) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Grooming occurrences ", italic(" (n)")))) 

# Display plot
print(groomo_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/1 assay/study site by grooming occ.jpeg", 
       groomo_site, width=150, height=150, units="mm")
```

```{r}
# Moving duration by study site plot
moved_site <- ggplot(data=data1, aes(x=site, y=moving_d, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=300, label="c", size=9, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=18), 
        axis.text.x=element_text(size=18)) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(0, 300, 50), 
                     labels=seq(0, 300, 50), 
                     limits=c(0, 300)) + 
  labs("") + xlab("") + ylab("Quadrupedal movement \nduration (s)") 

# Display plot
print(moved_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/1 assay/study site by moving dur.jpeg", 
       moved_site, width=100, height=150, units="mm")
```

Combine plots.

```{r}
# Combine grooming plots
plot <- ggarrange(groomd_site, groomo_site, moved_site, ncol=3, nrow=1)
plot <- annotate_figure(plot, 
        #left=text_grob("Adjusted behaviours over two assays", 
        #               rot=90, size=16, face="bold"), 
        bottom=text_grob("Study site", size=20))

# Display plot
print(plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/1 assay/groom and move violin plots.jpeg", 
       plot, width=350, height=150, units="mm")
```

```{r}
# Perching vs temp
perchtemp <- ggplot(data=data1, aes(x=temp, y=perch_d)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, col=vir8, fill=vir8) + 
  annotate("text", x=23, y=990, label="a", size=7, hjust=0) + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=20)) + 
  scale_y_continuous(breaks=seq(0, 1000, 250), 
                     labels=seq(0, 1000, 250), 
                     limits=c(-30, 1000)) + 
  labs("") + xlab(expression(paste("Ambient temperature (", degree, "C)"))) + 
  ylab("Perching duration (s)") 

# Display plot
print(perchtemp)

# Export plot as a jpeg file
ggsave(filename="output/plots/1 assay/perch temp.jpeg", 
       perchtemp, width=150, height=150, units="mm")
```

```{r}
# Latency to emerge vs temp
emergetemp <- ggplot(data=data1, aes(x=temp, y=emerge_max)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, col=vir13, fill=vir13) + 
  annotate("text", x=23, y=59, label="b", size=7, hjust=-1) + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=20)) + 
  scale_x_continuous(breaks=seq(10, 25, 5), 
                     labels=seq(10, 25, 5), 
                     limits=c(10, 25)) + 
  labs("") + xlab(expression(paste("Ambient temperature (", degree, "C)"))) + 
  ylab("Latency to emerge (s)") 

# Display plot
print(emergetemp)

# Export plot as a jpeg file
ggsave(filename="output/plots/1 assay/emerge temp.jpeg", 
       emergetemp, width=150, height=150, units="mm")
```

```{r}
# Emerge weight
emergeweight <- ggplot(data=data1, aes(x=weight, y=emerge_max)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, col=vir9, fill=vir9) + 
  annotate("text", x=1.6, y=59, label="c", size=7, hjust=0) + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=20)) + 
  scale_x_continuous(breaks=seq(0.25, 1.75, 0.5), 
                     labels=seq(0.25, 1.75, 0.5), 
                     limits=c(0.25, 1.75)) + 
  labs("") + xlab("Body weight (kg)") + ylab("Latency to emerge (s)") 

# Display plot
print(emergeweight)

# Export plot as a jpeg file
ggsave(filename="output/plots/1 assay/emerge weight.jpeg", 
       emergeweight, width=150, height=150, units="mm")
```

Combine plots.

```{r}
# Combine emerge plots
plot <- ggarrange(perchtemp, emergetemp, emergeweight, ncol=3, nrow=1)
plot <- annotate_figure(plot, 
        bottom=text_grob("Study site", size=20))

# Display plot
print(plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/1 assay/emerge plots.jpeg", 
       plot, width=350, height=150, units="mm")
```

# **Multiple assays**

I created a data subset to test the behavioural variables over multiple assays for 17 individual eastern quolls. 

## Subset to animals with repeated assays

```{r}
# 
values_to_exclude <- c("524E3", "53221", "53511", "53512", "53515", 
                       "53526", "563A6", "56ABE", "56EB2", "5FC08", 
                       "6D409" , "6D53F" , "6E990", "71A4D", "71B69", 
                       "86E19", "86FFC" , "87F61", "BCA09")

# 
data2 <- data %>% filter(!quoll_code %in% values_to_exclude)

# Export to csv file
write.csv(data2, "output/individuals with 2 assays.csv")
```

## Capture and recapture environmental vars GLM analysis

```{r}
# Fit GLM to test dependent variables by environmental variables
summary(glm(bait_eaten ~ temp + moon_phase + 
              time_assay_light + time_process_assay, data=data2))

summary(glm(food_d ~ temp + moon_phase + 
              time_assay_light + time_process_assay, data=data2))
summary(glm(food_o ~ temp + moon_phase + 
              time_assay_light + time_process_assay, data=data2))

summary(glm(grooming_d ~ temp + moon_phase + 
              time_assay_light + time_process_assay, data=data2))
summary(glm(grooming_o ~ temp + moon_phase + 
              time_assay_light + time_process_assay, data=data2))

summary(glm(jump_climb_d ~ temp + moon_phase + 
              time_assay_light + time_process_assay, data=data2))
summary(glm(jump_climb_o ~ temp + moon_phase + 
              time_assay_light + time_process_assay, data=data2))

summary(glm(legs_d ~ temp + moon_phase + 
              time_assay_light + time_process_assay, data=data2))
summary(glm(legs_o ~ temp + moon_phase + 
             time_assay_light + time_process_assay, data=data2))

summary(glm(moving_d ~ temp + moon_phase + 
             time_assay_light + time_process_assay, data=data2))
summary(glm(moving_o ~ temp + moon_phase + 
             time_assay_light + time_process_assay, data=data2))

summary(glm(perch_d ~ temp + moon_phase + 
             time_assay_light + time_process_assay, data=data2))
summary(glm(perch_o ~ temp + moon_phase + 
             time_assay_light + time_process_assay, data=data2))

summary(glm(emerge_max ~ temp + moon_phase + 
             time_assay_light + time_process_assay, data=data2))
summary(glm(sumsect_o ~ temp + moon_phase + 
             time_assay_light + time_process_assay, data=data2))
summary(glm(totalact_o ~ temp + moon_phase + 
             time_assay_light + time_process_assay, data=data2))

summary(glm(stress_trap ~ temp + moon_phase, data=data2))
summary(glm(stress_bag ~ temp + moon_phase, data=data2))
summary(glm(stress_table ~ temp + moon_phase, data=data2))
```

## Capture and recapture environmental variable tables

```{r}
# Collect variables
response_var <- all.vars(formula(mod))[1]

# 
tidy_results <- tidy(mod) %>%
  mutate_if(is.numeric, ~round(., digits=3))

# 
table <- tidy_results %>%
  mutate(p.value=ifelse(p.value <=0.05, 
                        cell_spec(p.value, bold=TRUE), 
                        p.value)) %>%
  kbl(caption=response_var, escape=FALSE)

# Display the table
print(table)
```

## Capture and recapture behaviour GLMMs with environmental vars

```{r}
# 
data2 <- data2 %>%
  mutate(age_n=as.numeric(as.character(age_n)))

# Fit GLM to test responses by predictor variables
summary(lmer(bait_eaten ~ site + sex + age_n + cond_n + weight + moon_phase + 
               (1|arena), data=data2, na.action="na.fail", REML=FALSE))

summary(lmer(emerge_max ~ site + sex + age_n + cond_n + weight + temp + 
               (1|arena), data=data2, na.action="na.fail", REML=FALSE))

summary(lmer(food_d ~ site + sex + age_n + cond_n + weight + moon_phase + 
               (1|arena), data=data2, na.action="na.fail", REML=FALSE))
summary(lmer(food_o ~ site + sex + age_n + cond_n + weight + 
               time_assay_light + time_process_assay + 
               (1|arena), data=data2, na.action="na.fail", REML=FALSE))

summary(lmer(grooming_d ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data2, na.action="na.fail", REML=FALSE))
summary(lmer(grooming_o ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data2, na.action="na.fail", REML=FALSE))

summary(lmer(jump_climb_d ~ site + sex + age_n + cond_n + weight + 
               time_assay_light + 
               (1|arena), data=data2, na.action="na.fail", REML=FALSE))
summary(lmer(jump_climb_o ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data2, na.action="na.fail", REML=FALSE))

summary(lmer(legs_d ~ site + sex + age_n + cond_n + weight + moon_phase + 
               (1|arena), data=data2, na.action="na.fail", REML=FALSE))
summary(lmer(legs_o ~ site + sex + age_n + cond_n + weight + 
               time_assay_light + time_process_assay + 
               (1|arena), data=data2, na.action="na.fail", REML=FALSE))

summary(lmer(moving_d ~ site + sex + age_n + cond_n + weight + moon_phase + 
              time_assay_light + time_process_assay + 
               (1|arena), data=data2, na.action="na.fail", REML=FALSE))
summary(lmer(moving_o ~ site + sex + age_n + cond_n + weight + moon_phase + 
               time_assay_light + time_process_assay + 
               (1|arena), data=data2, na.action="na.fail", REML=FALSE))

summary(lmer(perch_d ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data2, na.action="na.fail", REML=FALSE))
summary(lmer(perch_o ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data2, na.action="na.fail", REML=FALSE))

summary(lmer(stress_bag ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data2, na.action="na.fail", REML=FALSE))
summary(lmer(stress_table ~ site + sex + age_n + cond_n + weight + 
               (1|arena), data=data2, na.action="na.fail", REML=FALSE))

summary(lmer(sumsect_o ~ site + sex + age_n + cond_n + weight + 
               moon_phase + time_process_assay + 
               (1|arena), data=data2, na.action="na.fail", REML=FALSE))

summary(lmer(totalact_o ~ site + sex + age_n + cond_n + weight + 
               moon_phase + time_process_assay + time_assay_light + 
               (1|arena), data=data2, na.action="na.fail", REML=FALSE))
```

NB - I did not test 'stress in trap' in the previous chunk as there was no variation between individual stress ratings. 

Generate model tables.

```{r}
# Collect variables
response_var <- all.vars(formula(mod))[1]

# 
tidy_results <- tidy(mod) %>%
  mutate_if(is.numeric, ~round(., digits=3))

# 
table <- tidy_results %>%
  mutate(p.value=ifelse(p.value <=0.05, 
                        cell_spec(p.value, bold=TRUE), 
                        p.value)) %>%
  kbl(caption=response_var, escape=FALSE)

# Display table
print(table)
```

## Capture and recapture behaviour AICc model selection

```{r}
# 
control_ml <- lmerControl(optimizer="Nelder_Mead")

# Food occ   
mod_fo_process <- lmer(food_o ~ time_process_assay + (1|arena), data=data2, 
                       control=control_ml, na.action="na.fail", REML=FALSE)

# 
mod_fo_light <- lmer(food_o ~ time_assay_light + (1|arena), data=data2, 
                     control=control_ml, na.action="na.fail", REML=FALSE)

# 
models <- list(mod_fo_process, mod_fo_light)

# 
model.names <- c("Process to assay", "Assay to light")

# 
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Legs occ   
mod_lo_process <- lmer(legs_o ~ time_process_assay + (1|arena), data=data2, 
                       control=control_ml, na.action="na.fail", REML=FALSE)

# 
mod_lo_light <- lmer(legs_o ~ time_assay_light + (1|arena), data=data2, 
                     control=control_ml, na.action="na.fail", REML=FALSE)

# 
models <- list(mod_lo_process, mod_lo_light)

# 
model.names <- c("Process to assay", "Assay to light")

# 
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Move occ   
mod_mo_process <- lmer(moving_o ~ time_process_assay + (1|arena), data=data2, 
                       control=control_ml, na.action="na.fail", REML=FALSE)

# 
mod_mo_light <- lmer(moving_o ~ time_assay_light + (1|arena), data=data2, 
                     control=control_ml, na.action="na.fail", REML=FALSE)

# 
models <- list(mod_mo_process, mod_mo_light)

# 
model.names <- c("Process to assay", "Assay to light")

# 
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Move dur   
mod_md_process <- lmer(moving_d ~ time_process_assay + (1|arena), data=data2, 
                       control=control_ml, na.action="na.fail", REML=FALSE)

# 
mod_md_light <- lmer(moving_d ~ time_assay_light + (1|arena), data=data2, 
                     control=control_ml, na.action="na.fail", REML=FALSE)

# 
models <- list(mod_md_process, mod_md_light)

# 
model.names <- c("Process to assay", "Assay to light")

# 
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Table stress   
mod_table_process <- lmer(stress_table ~ time_process_assay + (1|arena), 
                          data=data2, control=control_ml, 
                          na.action="na.fail", REML=FALSE)

# 
mod_table_light <- lmer(stress_table ~ time_assay_light + (1|arena), 
                        data=data2, control=control_ml, 
                        na.action="na.fail", REML=FALSE)

# 
models <- list(mod_table_process, mod_table_light)

# 
model.names <- c("Process to assay", "Assay to light")

# 
aictab(cand.set=models, modnames=model.names)
```

## Plots for two assays

```{r}
# Grooming duration by sex 
groomdur <- ggplot(data=data2, aes(x=sex, y=grooming_d, fill=sex)) + 
  geom_boxplot() + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=black, 
             shape=21, size=1.5, stroke=1) + 
  annotate("text", x="M", y=80, label="c", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=20)) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_x_discrete(labels=c("M"="Male", "F"="Female")) + 
  scale_y_continuous(breaks=seq(0, 80, 20), 
                     labels=seq(0, 80, 20), 
                     limits=c(0, 80)) + 
  labs("") + xlab("Sex") + ylab("Grooming duration (s)") 

# Display plot
print(groomdur)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assays/sex by grooming.jpeg", 
       groomdur, width=150, height=150, units="mm")
```

```{r}
# Bait eaten by age
baitage <- ggplot(data=data2, aes(x=age, y=bait_eaten, fill=age)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=black, 
             shape=21, size=1.5, stroke=1) + 
  annotate("text", x=2, y=50, label="a", size=7, hjust=-6) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19)) + 
  scale_fill_manual (values=c(vir12, vir6, vir2)) + 
  scale_x_discrete(labels=c("<1yr"="<1 year", 
                            "1-2yrs"="1-2 years", 
                            "2-3yrs"="2-3 years")) + 
  scale_y_continuous(breaks=seq(0, 50, 25), 
                     labels=seq(0, 50, 25), 
                     limits=c(0, 50)) + 
  labs("") + xlab("Age estimate") + ylab("Bait eaten (g)") 

# Display plot
print(baitage)
```

```{r}
# Perhing by site
perchocc <- ggplot(data=data2, aes(x=site, y=perch_o, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=black, 
             shape=21, size=1.5, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=60, label="b", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19)) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(0, 60, 20), 
                     labels=seq(0, 60, 20), 
                     limits=c(0, 60)) + 
  xlab("Study site") + 
  ylab(expression(paste("Perching occurrences ", italic(" (n)")))) 

# Display plot
print(perchocc)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assays/site by perching.jpeg", 
       perchocc, width=150, height=150, units="mm")
```

```{r}
# Combine  plots
plot <- ggarrange(baitage, perchocc, groomdur, ncol=3, nrow=1)

# Display plot
print(plot)

# Export plot as a jpeg file
ggsave(plot, filename="output/plots/2 assays/bait perch emerge.jpeg", 
       height=150, width=350, units="mm")
```

```{r}
# Total section vs moon 
sum_moon <- ggplot(data=data2, aes(x=moon_phase, y=sumsect_o)) + 
  geom_point(col=vir14) + 
  geom_smooth(method="lm", se=TRUE, col=vir14, fill=vir14) + 
  annotate("text", x=100, y=100, label="a", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=18)) + 
  scale_y_continuous(breaks=seq(0, 100, 25), 
                     labels=seq(0, 100, 25), 
                     limits=c(0, 100)) + 
  labs("") + xlab("Moon illumination (%)") + 
  ylab(expression(paste("Sum of arena section visits", italic(" (n)")))) 

# Display plot
print(sum_moon)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assays/raw emerge temp.jpeg", 
       emergetemp, width=150, height=150, units="mm")
```

```{r}
# Food occ by time assay to light 
foodo_light <- ggplot(data=data2, aes(x=time_assay_light, y=food_o)) + 
  geom_point(col=vir11) + 
  geom_smooth(method="lm", se=TRUE, col=vir11, fill=vir11) + 
  annotate("text", x=400, y=55, label="b", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=18)) + 
  scale_y_continuous(breaks=seq(0, 50, 10), 
                     labels=seq(0, 50, 10), 
                     limits=c(-5, 55)) + 
  labs("") + xlab("Time: assay to first light (mins)") + 
  ylab(expression(paste("Food interaction occurrences ", italic(" (n)")))) 

# Display plot
print(foodo_light)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assays/raw food light.jpeg", 
       foodo_light, width=150, height=150, units="mm")
```

```{r}
# Food occ by time process to assay
foodo_process <- ggplot(data=data2, aes(x=time_process_assay, y=food_o)) + 
  geom_point(col=vir10) + 
  geom_smooth(method="lm", se=TRUE, col=vir10, fill=vir10) + 
  annotate("text", x=250, y=55, label="c", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=18)) + 
  scale_y_continuous(breaks=seq(0, 50, 10), 
                     labels=seq(0, 50, 10), 
                     limits=c(-10, 55)) + 
  scale_x_continuous(breaks=seq(50, 250, 50), 
                     labels=seq(50, 250, 50), 
                     limits=c(40, 250)) + 
  labs("") + xlab("Time: processing to assay (mins)") + 
  ylab(expression(paste("Food interaction occurrences ", italic(" (n)")))) 

# Display plot
print(foodo_process)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assays/raw food process.jpeg", 
       foodo_process, width=150, height=150, units="mm")
```

```{r}
# Move dur by time assay to light 
moved_light <- ggplot(data=data2, aes(x=time_assay_light, y=moving_d)) + 
 geom_point(col=vir9) + 
  geom_smooth(method="lm", se=TRUE, col=vir9, fill=vir9) + 
  annotate("text", x=400, y=245, label="d", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=18)) + 
  scale_y_continuous(breaks=seq(0, 250, 50), 
                     labels=seq(0, 250, 50), 
                     limits=c(0, 250)) + 
  labs("") + xlab("Time: assay to first light (mins)") + 
  ylab("Quadrupedal movement duration (s)") 

# Display plot
print(moved_light)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assays/raw moved light.jpeg", 
       moved_light, width=150, height=150, units="mm")
```

```{r}
# Move occ by time assay to light 
moveo_light <- ggplot(data=data2, aes(x=time_assay_light, y=moving_o)) + 
  geom_point(col=vir8) + 
  geom_smooth(method="lm", se=TRUE, col=vir8, fill=vir8) + 
  annotate("text", x=395, y=195, label="e", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=18)) + 
  scale_y_continuous(breaks=seq(0, 200, 50), 
                     labels=seq(0, 200, 50), 
                     limits=c(0, 200)) + 
  labs("") + xlab("Time: assay to first light (mins)") + 
  ylab(expression(paste("Quadrupedal movement occurrences ", italic(" (n)")))) 

# Display plot
print(moveo_light)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assays/raw move occ light.jpeg", 
       moveo_light, width=150, height=150, units="mm")
```

```{r}
# Move occ by time process to assay
moveo_process <- ggplot(data=data2, aes(x=time_process_assay, y=moving_o)) + 
  geom_point(col=vir6) + 
  geom_smooth(method="lm", se=TRUE, col=vir6, fill=vir6) + 
  annotate("text", x=300, y=195, label="f", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=18)) + 
  scale_x_continuous(breaks=seq(50, 300, 50), 
                     labels=seq(50, 300, 50), 
                     limits=c(50, 300)) + 
  labs("") + xlab("Time: processing to assay (mins)") + 
  ylab(expression(paste("Quadrupedal movement occurrences ", italic(" (n)")))) 

# Display plot
print(moveo_process)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assays/raw move occ process.jpeg", 
       moveo_process, width=150, height=150, units="mm")
```

```{r}
# Legs occ by time assay to light 
legso_light <- ggplot(data=data2, aes(x=time_assay_light, y=legs_o)) + 
  geom_point(col=vir5) + 
  geom_smooth(method="lm", se=TRUE, col=vir5, fill=vir5) + 
  annotate("text", x=400, y=150, label="g", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=18)) + 
  scale_y_continuous(breaks=seq(0, 150, 50), 
                     labels=seq(0, 150, 50), 
                     limits=c(0, 150)) + 
  labs("") + xlab("Time: assay to first light (mins)") + 
  ylab(expression(paste("Hind leg stand occurrences", italic(" (n)")))) 

# Display plot
print(legso_light)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assays/raw legs light.jpeg", 
       legso_light, width=150, height=150, units="mm")
```

```{r}
# Legs occ by time process to assay
legso_process <- ggplot(data=data2, aes(x=time_process_assay, y=legs_o)) + 
  geom_point(col=vir3) + 
  geom_smooth(method="lm", se=TRUE, col=vir3, fill=vir3) + 
  annotate("text", x=290, y=150, label="h", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=18)) + 
  scale_y_continuous(breaks=seq(0, 150, 50), 
                     labels=seq(0, 150, 50), 
                     limits=c(-20, 150)) + 
  scale_x_continuous(breaks=seq(50, 280, 50), 
                     labels=seq(50, 280, 50), 
                     limits=c(30, 290)) + 
  labs("") + xlab("Time: processing to assay (mins)") + 
  ylab(expression(paste("Hind leg stand occurrences", italic(" (n)")))) 

# Display plot
print(legso_process)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assays/raw legs process.jpeg", 
       legso_process, width=150, height=150, units="mm")
```

```{r}
# Latency to emerge by temp
emergetemp <- ggplot(data=data2, aes(x=temp, y=emerge_max)) + 
  geom_point(col=vir1) + 
  geom_smooth(method="lm", se=TRUE, col=vir1, fill=vir1) + 
  annotate("text", x=25, y=60, label="i", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=20)) + 
  scale_x_continuous(breaks=seq(10, 25, 5), 
                     labels=seq(10, 25, 5), 
                     limits=c(10, 25)) + 
  labs("") + ylab("Latency to emerge (s)") + 
  xlab(expression(paste("Ambient temperature (", degree, "C)"))) 

# Display plot
print(emergetemp)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assays/raw emerge temp.jpeg", 
       emergetemp, width=150, height=150, units="mm")
```

Combine plots.

```{r}
# Combine  plots
plot <- ggarrange(sum_moon, foodo_light, foodo_process, moved_light, 
                  moveo_light, moveo_process, legso_light, legso_process, 
                  emergetemp, ncol=3, nrow=3) 

# Display plot
print(plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assays/fixed effects.jpeg", 
       plot, width=350, height=350, units="mm")
```

## Environmental vars data mutate

I minimised environmental influence on the behaviour models by standardising their values: the means of the environmental variables were all scaled to zero, and the standard deviation to one, as in Wilson *et al*. (2022).

```{r}
# Mutating the environmental variables 
data2_mutate <- data2 %>%
  mutate_at(vars(temp, moon_phase, time_assay_light, time_process_assay), 
            ~ as.vector(scale(.)))

# 
data2$condition <- factor(data2$condition, 
                          levels=c("Excellent", "Good", "Fair", "Poor"))

# 
write.csv(data2_mutate, 
          "output/data2_mutate - both assays env vars adjusted.csv")
```

## Adjusted behaviour variables - extracting values

I fitted GLMs of the adjusted behaviours against assay number and the standardised environmental variables, and at the same time, I extracted intercept (‘personality’ measure) and slope (‘plasticity’ measure) coefficients for each behavioural variable. 

```{r}
# Define names for raw variables and corresponding predicted variables
raw_vars <- c("food_o", "food_d", "grooming_o", "grooming_d", "jump_climb_o", 
              "jump_climb_d", "legs_d", "legs_o", "moving_d", "moving_o", 
              "perch_d", "perch_o", "bait_eaten", "sumsect_o", "totalact_o", 
              "stress_trap", "stress_bag", "stress_table", "emerge_max")

pred_vars <- c("foodo_p", "foodd_p", "groomo_p", "groomd_p", "jumpo_p", 
               "jumpd_p", "legsd_p", "legso_p", "moved_p", "moveo_p", 
               "perchd_p", "percho_p", "bait_p", "sumsecto_p", "totalacto_p", 
               "stress_trap_p", "stress_bag_p", "stress_table_p", "emerge_p")

# Define which variables use a shorter formula (i.e., no time variables)
short_formula <- c("stress_trap", "stress_bag", "stress_table")

# Loop to fit models
for (i in seq_along(raw_vars)) {
  outcome <- raw_vars[i]
  predname <- pred_vars[i]
  
  formula <- if (outcome %in% short_formula) {
    as.formula(paste0(outcome, " ~ temp + moon_phase"))} else {
    as.formula(paste0(outcome, " ~ temp + moon_phase + time_assay_light + time_process_assay"))}
  
  mod <- glm(formula, family=gaussian, data=data2_mutate)
  data2_mutate[[predname]] <- predict(mod, type="response")}
```

## Adjusted behaviour variables

Once adjusted variables were extracted, we tidied up the df. 

```{r}
# 
data2_pred <- data2_mutate %>%
  select(-food_o, -food_d, -grooming_o, -grooming_d, -jump_climb_o, 
         -jump_climb_d, -legs_o, -legs_d, -moving_o, -moving_d, -perch_d, 
         -perch_o, -resting_o, -resting_d, -bait_eaten, -sumsect_o, 
         -totalact_o, -emerge_max, -emerge_time, -arena_entry) %>%
  mutate(assay_n=as.factor(assay_n))

# Export to a csv file
write.csv(data2_pred, 
          "output/both assays adjusted env variables.csv")
```

## Adjusted behaviour variables - test vs assay number

```{r}
# 
summary(glm(foodd_p ~ assay_n, family=gaussian, data=data2_pred))
summary(glm(foodo_p ~ assay_n, family=gaussian, data=data2_pred))
summary(glm(bait_p ~ assay_n, family=gaussian, data=data2_pred))
summary(glm(groomd_p ~ assay_n, family=gaussian, data=data2_pred))
summary(glm(groomo_p ~ assay_n, family=gaussian, data=data2_pred))
summary(glm(jumpd_p ~ assay_n, family=gaussian, data=data2_pred))
summary(glm(jumpo_p ~ assay_n, family=gaussian, data=data2_pred))
summary(glm(legsd_p ~ assay_n, family=gaussian, data=data2_pred))
summary(glm(legso_p ~ assay_n, family=gaussian, data=data2_pred))
summary(glm(moved_p ~ assay_n, family=gaussian, data=data2_pred))
summary(glm(moveo_p ~ assay_n, family=gaussian, data=data2_pred))
summary(glm(emerge_p ~ assay_n, family=gaussian, data=data2_pred))
summary(glm(perchd_p ~ assay_n, family=gaussian, data=data2_pred))
summary(glm(percho_p ~ assay_n, family=gaussian, data=data2_pred))
summary(glm(sumsecto_p ~ assay_n, family=gaussian, data=data2_pred))
summary(glm(totalacto_p ~ assay_n, family=gaussian, data=data2_pred))
summary(glm(stress_bag_p ~ assay_n, family=gaussian, data=data2_pred))
summary(glm(stress_trap_p ~ assay_n, family=gaussian, data=data2_pred))
summary(glm(stress_table_p ~ assay_n, family=gaussian, data=data2_pred))
```

```{r}
# Table with kableExtra
response_var <- all.vars(formula(mod))[1]

# 
tidy_results <- tidy(mod) %>%
  mutate_if(is.numeric, ~round(., digits=3))

# 
table <- tidy_results %>%
  mutate(p.value=ifelse(p.value <=0.05, 
                        cell_spec(p.value, bold=TRUE), 
                        p.value)) %>%
  kbl(caption=response_var, escape=FALSE)

# 
print(table)
```

## Adjusted behaviour variables vs assay number plots

```{r}
# Latency to emerge
ed_plot <- ggplot(data=data2_pred, aes(x=assay_n, y=emerge_p, fill=assay_n)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="2", y=50, label="d", size=7, hjust=-3) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=19), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(0, 50, 10), 
                     labels=seq(0, 50, 10), 
                     limits=c(0, 50)) + 
  labs("") + xlab("") + ylab(expression(paste("Latency to emerge (s)"))) 

# Display plot
print(ed_plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/assay number/assay number by emerge.jpeg", 
       ed_plot, width=150, height=150, units="mm")
```

```{r}
# Food interaction occurrences
fo_plot <- ggplot(data=data2_pred, aes(x=assay_n, y=foodo_p, fill=assay_n)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="2", y=30, label="a", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Food interaction \noccurrences", italic(" (n) ")))) 

# Display plot
print(fo_plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/assay number/assay number by food occ by site.jpeg", 
       fo_plot, width=200, height=150, units="mm")
```

```{r}
# Jump climb duration
jd_plot <- ggplot(data=data2_pred, aes(x=assay_n, y=jumpd_p, fill=assay_n)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="2", y=200, label="b", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Jumping + climbing \nduration (s)"))) 

# Display plot
print(jd_plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/assay number/assay number by jump dur by site.jpeg", 
       jd_plot, width=200, height=150, units="mm")
```

```{r}
# Jump climb occurrences
jo_plot <- ggplot(data=data2_pred, aes(x=assay_n, y=jumpo_p, fill=assay_n)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="2", y=80, label="c", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Jumping + \nclimbing occurrences ", italic(" (n) ")))) 

# Display plot
print(jo_plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/assay number/assay number by jump occ by site.jpeg", 
       jo_plot, width=200, height=150, units="mm")
```

```{r}
# Perching occurrences
po_plot <- ggplot(data=data2_pred, aes(x=assay_n, y=percho_p, fill=assay_n)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  
  annotate("text", x="2", y=30, label="e", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(0, 30, 10), 
                     labels=seq(0, 30, 10), 
                     limits=c(0, 30)) + 
  labs(x="", y=expression(paste("Perching \noccurrences ", italic(" (n) ")))) 

# Display plot
print(po_plot)

# Export plot as a jpeg file
ggsave(po_plot, filename="output/plots/assay number/assay number by perch occ.jpeg", 
       height=150, width=150, units="mm")
```

```{r}
# Moving duration
md_plot <- ggplot(data=data2_pred, aes(x=assay_n, y=moved_p, fill=assay_n)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="2", y=160, label="f", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(0, 160, 50), 
                     labels=seq(0, 160, 50), 
                     limits=c(0, 160)) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Quadrupedal \nmovement duration (s)"))) 

# Display plot
print(md_plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/assay number/assay number by move dur by site.jpeg", 
       md_plot, width=200, height=150, units="mm")
```

```{r}
# Moving occurrences
mo_plot <- ggplot(data=data2_pred, aes(x=assay_n, y=moveo_p, fill=assay_n)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="2", y=150, label="g", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(0, 150, 50), 
                     labels=seq(0, 150, 50), 
                     limits=c(0, 150)) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Quadrupedal\n movement occurrences", italic(" (n) ")))) 

# Display plot
print(mo_plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/assay number/assay number by move occ by site.jpeg", 
       mo_plot, width=200, height=150, units="mm")
```

```{r}
# Legs occurrences
lo_plot <- ggplot(data=data2_pred, aes(x=assay_n, y=legso_p, fill=assay_n)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="2", y=110, label="h", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) +
  scale_y_continuous(breaks=seq(0, 110, 20), 
                     labels=seq(0, 110, 20), 
                     limits=c(0, 110)) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Hindleg stand \noccurrences ", italic("(n) ")))) 

# Display plot
print(lo_plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/assay number/assay number by legs occ by site.jpeg", 
       lo_plot, width=200, height=150, units="mm")
```

```{r}
# Sum total activity 
act_plot <- ggplot(data=data2_pred, aes(x=assay_n, y=totalacto_p, 
                                        fill=assay_n)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="2", y=400, label="i", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(0, 400, 100), 
                     labels=seq(0, 400, 100), 
                     limits=c(0, 400)) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Total activity \noccurrences", italic(" (n) ")))) 

print(act_plot)

ggsave(filename="output/plots/assay number/assay number by totsect by site.jpeg", 
       act_plot, width=200, height=150, units="mm")
```

```{r}
# Sum section visits
sum_plot <- ggplot(data=data2_pred, aes(x=assay_n, y=sumsecto_p, 
                                        fill=assay_n)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="2", y=80, label="j", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(0, 80, 20), 
                     labels=seq(0, 80, 20), 
                     limits=c(0, 80)) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Total arena \nsection visits", italic(" (n) ")))) 

# Display plot
print(sum_plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/assay number/assay number by sum sect by site.jpeg", 
       sum_plot, width=200, height=150, units="mm")
```

```{r}
# Bag stress
bag_plot <- ggplot(data=data2_pred, aes(x=assay_n, y=stress_bag_p, 
                                        fill=assay_n)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  annotate("text", x="2", y=1.5, label="k", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) +   
  scale_y_continuous(breaks=seq(1, 1.5, 0.1), 
                     labels=seq(1, 1.5, 0.1), 
                     limits=c(0.9, 1.5)) + 
  labs("") + xlab("") + ylab("Adjusted bag\n stress rating") 

# Display plot
print(bag_plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/assay number/assay number by sum sect by site.jpeg", 
       sum_plot, width=200, height=150, units="mm")
```

```{r}
# Table stress
table_plot <- ggplot(data=data2_pred, aes(x=assay_n, y=stress_table_p, 
                                          fill=assay_n)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  annotate("text", x="2", y=1.5, label="l", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) +  
  scale_y_continuous(breaks=seq(1, 1.5, 0.1), 
                     labels=seq(1, 1.5, 0.1), 
                     limits=c(0.9, 1.5)) + 
  labs("") + xlab("") + ylab("Adjusted table \nstress rating") 

# Display plot
print(table_plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/assay number/assay number by sum sect by site.jpeg", 
       sum_plot, width=200, height=150, units="mm")
```

```{r}
# 
plot <- ggarrange(fo_plot, jd_plot, jo_plot, ed_plot, po_plot, md_plot, 
                  mo_plot, lo_plot, act_plot, sum_plot, bag_plot, table_plot, 
                  nrow=4, ncol=3)

# 
plot <- annotate_figure(plot, bottom=text_grob("Assay/capture number", size=25))

# Display plot
print(plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assays/activity by assay number.jpeg", 
       plot, width=400, height=550, units="mm")
```

# **Personality and plasticity**

I created data frame for personality and plasticity analysis with individual eastern quoll demographic and morphological traits.  

```{r}
# 
quoll2 <- data2_pred %>%
  select(-assay_date, -initial_repeat_assay, -trap_location, -snout, -haunches, 
         -trap_session_date, -trap_session_morning, -first_light, -ssr, 
         -process_start, -process_end, -pouch, -teeth_colour, -teeth_sharpness, 
         -teeth_shine, -stress_trap, -stress_bag, -stress_table)

# 
quoll2 <- quoll2 %>%
  # Convert columns to factor format
  mutate(condition=as.factor(condition), age=as.factor(age)) %>%
  # Rename columns
  mutate(age=recode(age, "1-2yrs"="1–2 years", 
                         "<1yr"="<1 year", 
                         "2-3yrs"="2–3 years"))  %>%
  # Reorder new labels
   mutate(condition=factor(condition, levels=c("Excellent", "Good", 
                                               "Fair", "Poor")), 
          age=factor(age, levels=c("2–3 years", "1–2 years", "<1 year")))

# Export as a csv file
write.csv(quoll2, "output/quoll2.csv")
```

## Intercept and slope 

Using the adjusted values I fitted models to extract the intercept (personality) and slope (plasticity) over multiple assays. 

```{r}
# Create a list of dependent behavioural variables
dependent <- c("foodd_p", "foodo_p", "groomd_p", "groomo_p", "jumpd_p", 
               "jumpo_p", "legsd_p", "legso_p", "moved_p", "moveo_p", 
               "perchd_p", "percho_p", "bait_p", "sumsecto_p", "totalacto_p", 
               "stress_trap_p", "stress_bag_p", "stress_table_p", "emerge_p")

# Define the levels in an object
quolls <- levels(factor(quoll2$quoll_code))

# Create a blank dataframe with four columns
coefficients <- data.frame(quoll_code=NULL, intercept=NULL, 
                           slope=NULL, variable=NULL)

# Loop to extract the intercept and slope of each behavioural response
for(v in 1:NROW(dependent)) {
  for(i in 1:NROW(quolls)){
    quoll_code <- quolls[i]
    variable <- dependent[v]
    mod <- lm(eval(as.name(paste0(variable))) ~ assay_n + temp + 
                moon_phase + time_assay_light + time_process_assay, 
              data=subset(quoll2, quoll_code==quolls[i]))
    i <- coef(mod)[1]
    s <- coef(mod)[2]
    results <- data.frame(cbind(quoll_code, i, s, variable))
    coefficients <- rbind(coefficients, results)}}

# Convert the df to wide format
coefficients <- reshape(coefficients, idvar="quoll_code", 
                        timevar="variable", direction="wide")

# Define names of the coefficients
names(coefficients) <- gsub("\\.", "_", names(coefficients))

# Remove duplicated coefficients
coefficients <- coefficients[ , !duplicated(colnames(coefficients))]

# Check structure of coefficients
str(coefficients)

# If they are being read as characters, change to numeric 
cols_to_convert <- setdiff(names(coefficients), "quoll_code")
coefficients[cols_to_convert] <- lapply(coefficients[cols_to_convert], 
                                        as.numeric)

# Join behavioural df with post-release df
ppdata <- left_join(quoll2, coefficients, by="quoll_code", "session") %>%
  distinct(quoll_code, .keep_all=TRUE)

# Remove duplicated column names
ppdata <- ppdata[ , !duplicated(colnames(ppdata))]

# Write to csv file
write_csv(ppdata, "output/ppdata - intercept and slope data.csv")
```

## Analyse personality and plasticity indices

Here, we:

  1. Tested the influence of predictors (e.g., site) on behavioural responses (e.g., food interaction duration).
      - Since one of the arenas only tested individuals of one sex, we could not include `arena` as a random variable in our models.
      - We did not test `stress in trap` since there was no variation between individuals for this response. 
  2. If multiple fixed effects produced significance, we performed model selection to determine which predictors were <△2 AICc.

```{r}
# Check how many sexes and sites were exposed to each arena
ppdata %>%
  group_by(arena) %>%
  summarise(sex_n=n_distinct(sex), 
            site_n=n_distinct(site), 
            n=n()) %>%
  arrange(sex_n)
```

Next, we used the False Discovery Rate (FDR) approach to account for our multiple hypothesis testing by controlling the **expected proportion of false positives** among the results we declared as significant. This involved:

  1. Calculating *p*-values for each test
  2. Ordering those *p*-values from smallest to largest
  3. Applying an FDR control procedure to determine which *p*-values are statistically significant
      - We used the Benjamini–Hochberg method (`BH`, [Benjamini & Hochberg 1995](https://doi.org/10.1111/j.2517-6161.1995.tb02031.x)) to set FDR = 0.05, meaning that on average, no more than 5% of the declared significant results are expected to be false positives. Note that this procedure doesn’t calculate a single adjusted alpha but rather compares each *p*-value to a threshold that increases with rank.
  4. Declaring as significant those tests with *p*-values below the adjusted threshold (i.e., alpha)

First, we prepare our input data for the GLMs.

```{r}
# Convert categorical predictors to factors
ppdata <- ppdata %>%
  mutate(sex=factor(sex), 
         site=factor(site)) 

# Define behavioural responses
responses <- ppdata %>%
  select(starts_with("i_"), starts_with("s_")) %>%
  colnames()

# Define predictors
predictors <- ppdata %>% 
  select(age_n, weight, cond_n, sex, site) %>%
  colnames()

# Load a table for renaming variables
rename_table <- read_excel(raw_data, sheet="variables") %>%
  select(Code, Description)

# Extract desired order for response labels
response_order <- rename_table %>%
  filter(str_detect(Code, "^i_|^s_")) %>%
  distinct(Description) %>%
  pull()
```

Here we fitted our GLMs using a loop, and generated a model table including `response` (behaviour), `predictor`, `estimate` (coefficient of predictor), standard error (`SE`), `t-statistic` (`estimate`/`SE`), and `p-value`

```{r}
# Fit GLMs, extract summaries, and annotate with response variable
glm_results <- map_dfr(responses, function(beh) {
  
  # Subset input data to response and predictors
  model_data <- ppdata %>%
    select(all_of(c(beh, predictors))) %>% 
    # Exclude rows with missing values
    drop_na()
  
  # Only fit model if enough complete rows
  if(nrow(model_data) >= length(predictors) + 1) {
    glm(as.formula(paste(beh, "~", paste(predictors, collapse=" + "))),
        data=model_data, na.action=na.fail) %>%
      tidy() %>%
      mutate(behaviour=beh)} 
  else tibble()}) %>%
  
  # Adjust p-values using Benjamini-Hochberg
  mutate(p_adj=p.adjust(p.value, method="BH")) %>%
  # Round all numeric columns to 3 decimal places
  mutate(across(where(is.numeric), ~round(.x, 3))) %>%
  # Flag statistically significant results
  mutate(significant=p_adj < 0.05) %>%
  # Clean `term` column for consistent joining with predictor codes
  mutate(term_clean=case_when(
    term == "(Intercept)"    ~ "(Intercept)",
    str_starts(term, "sex")  ~ "sex",
    str_starts(term, "site") ~ "site",
    TRUE                     ~ term)) %>%
  
  # Join to readable predictor labels
  left_join(rename_table, by=c("term_clean"="Code")) %>%
  rename(Predictor_raw=Description) %>%
  
  # Format contrast predictors with sublabels
  mutate(Predictor=case_when(
    term == "(Intercept)"    ~ "Intercept",
    str_starts(term, "sex")  ~ paste0("Sex (", str_remove(term, "sex"), ")"),
    str_starts(term, "site") ~ paste0("Site (", str_remove(term, "site"), ")"),
    TRUE                     ~ Predictor_raw)) %>%
  
  # Join to readable response labels
  left_join(rename_table, by=c("behaviour"="Code")) %>%
  rename(Response=Description)
```

Here we tidy the GLM results into an easily interpretable model table.

```{r}
# Format table content and arrange in response order
glm_prep <- glm_results %>%
  # Force factor levels for correct response ordering
  mutate(Response=factor(Response, levels=response_order)) %>%
  # Bold significant p-values
  mutate(p=ifelse(p.value <= 0.05, cell_spec(p.value, bold=TRUE), p.value),
         p_adj=ifelse(p_adj <= 0.05, cell_spec(p_adj, bold=TRUE), p_adj)) %>%
  # Select and rename final columns
  select(Response, Predictor, Estimate=estimate, SE=std.error, 
         t=statistic, p, `p-adjusted`=p_adj) %>%
  # Sort by response for grouped display
  arrange(Response)

# Count number of rows per response for grouping
row_counts <- glm_prep %>%
  count(Response, name="n") %>%
  drop_na() %>%
  deframe()

# Compile model output table
glm_table <- glm_prep %>%
  # Blank repeated response values for cleaner layout
  mutate(Response="") %>%
  ungroup() %>%
  
  # Format table using kableExtra
  kbl(escape=FALSE,
      caption="<b>GLMs testing intercept and slope coefficients</b>",
      col.names=c("<b>Response</b>", "<b>Predictor</b>", "<b>Estimate</b>",
                  "<b>SE</b>", "<b><i>t</i></b>", "<b><i>p</i></b>", 
                  "<b><i>p</i>-adjusted</b>"), 
      # Align columns as desired
      align=c("l", "l", "r", "r", "r", "r", "r")) %>%
  kable_classic(full_width=FALSE) %>%
  # Group rows using response blocks
  pack_rows(index=row_counts)

# Display table
print(glm_table)
```

### Model selection

```{r}
# Perching duration
mod_pdi_site <- lmer(i_perchd_p ~ site + (1|arena), data=ppdata, 
                     control=control_ml, na.action="na.fail", REML=FALSE)

mod_pdi_weight <- lmer(i_perchd_p ~ sex*weight + (1|arena), data=ppdata, 
                       control=control_ml, na.action="na.fail", REML=FALSE)
# 
models <- list(mod_pdi_site, mod_pdi_weight)

# 
model.names <- c("Study site", "Interaction of Sex and body weight kg")

# Model selection
aictab(cand.set=models, modnames=model.names)
```

## Intercept plots

```{r}
# Bag stress
i_bs_site <- ggplot(data=ppdata, aes(x=site, y=i_stress_bag_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=1.3, label="a", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(0.9, 1.3, 0.1), 
                     labels=seq(0.9, 1.3, 0.1), 
                     limits=c(0.9, 1.3)) + 
  labs("") + xlab("") + ylab("Adjusted bag stress \nrating intercept") 

# Display plot
print(i_bs_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept/study site by bag stress.jpeg", 
       i_bs_site, width=200, height=150, units="mm")
```

```{r}
# Table stress
i_ts_site <- ggplot(data=ppdata, aes(x=site, y=i_stress_table_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=1.3, label="b", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(0.9, 1.3, 0.1), 
                     labels=seq(0.9, 1.3, 0.1), 
                     limits=c(0.9, 1.3)) + 
  labs("") + xlab("") + ylab("Adjusted table stress \nrating intercept") 

# Display plot
print(i_ts_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept/study site by table stress.jpeg", 
       i_ts_site, width=200, height=150, units="mm")
```

```{r}
# Latency to emerge
i_e_site <- ggplot(data=ppdata, aes(x=site, y=i_emerge_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=50, label="c", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(0, 50, 10), 
                     labels=seq(0, 50, 10), 
                     limits=c(0, 50)) + 
  labs("") + xlab("") + ylab("Adjusted latency \nto emerge (s) intercept") 

# Display plot
print(i_e_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept/study site by latency to emerge.jpeg", 
       i_e_site, width=200, height=150, units="mm")
```

```{r}
# Hind legs duration
i_ld_site <- ggplot(data=ppdata, aes(x=site, y=i_legsd_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=300, label="d", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_y_continuous(breaks=seq(100, 300, 100), 
                     labels=seq(100, 300, 100), 
                     limits=c(100, 300)) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  labs("") + xlab("") +
  ylab("Adjusted hindleg stands \nduration (s) intercept") 

# Display plot
print(i_ld_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept/study site by legs dur.jpeg", 
       i_ld_site, width=200, height=150, units="mm")
```

```{r}
# Groom duration
i_gd_site <- ggplot(data=ppdata, aes(x=site, y=i_groomd_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=25, label="e", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  labs("") + xlab("") + ylab("Adjusted grooming\n duration (s) intercept") 

# Display plot
print(i_gd_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept/study site by grooming dur.jpeg", 
       i_gd_site, width=150, height=150, units="mm")
```

```{r}
# Bait eaten
i_b_site <- ggplot(data=ppdata, aes(x=site, y=i_bait_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=20, label="f", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  labs("") + xlab("") + ylab("Adjusted \nbait eaten (g) intercept") 

# Display plot
print(i_b_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept/study site by bait.jpeg", 
       i_b_site, width=200, height=150, units="mm")
```

```{r}
# Jump/climb duration
i_jd_site <- ggplot(data=ppdata, aes(x=site, y=i_jumpd_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=220, label="g", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(0, 200, 50), 
                     labels=seq(0, 200, 50), 
                     limits=c(0, 220)) + 
  labs("") + xlab("") + 
  ylab("Adjusted jumping + climbing \nduration (s) intercept") 

# Display plot
print(i_jd_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept/study site by jumpclimb dur.jpeg", 
       i_jd_site, width=200, height=150, units="mm")
```

```{r}
# Jump/climb occurrences
i_jo_site <- ggplot(data=ppdata, aes(x=site, y=i_jumpo_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=90, label="h", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_y_continuous(breaks=seq(0, 80, 20), 
                     labels=seq(0, 80, 20), 
                     limits=c(0, 90)) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Adjusted jumping + climbing\n occurrences intercept", 
                        italic("(n)")))) 

# Display plot
print(i_jo_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept/study site by jumpclimb occ.jpeg", 
       i_jo_site, width=200, height=150, units="mm")
```

```{r}
# Move duration
i_md_site <- ggplot(data=ppdata, aes(x=site, y=i_moved_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=160, label="i", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  labs("") + xlab("") + 
  ylab("Adjusted quadrupedal movement\n duration intercept  (s)") 

# Display plot
print(i_md_site)
  
# Export plot as a jpeg file
ggsave(filename="output/plots/intercept/study site by move dur.jpeg",
       i_md_site, width=200, height=150, units="mm")
```

```{r}
# Perch duration
i_pd_site <- ggplot(data=ppdata, aes(x=site, y=i_perchd_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=300, label="j", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
       text=element_text(size=19), 
       axis.text.x=element_text(size=19), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  labs("") + xlab("") + 
  ylab("Adjusted perching\n duration (s) intercept") 

# Display plot
print(i_pd_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept/study site by perch dur.jpeg", 
       i_pd_site, width=200, height=150, units="mm")
```

```{r}
# Perch occurrences
i_po_site <- ggplot(data=ppdata, aes(x=site, y=i_percho_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=30, label="k", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  xlab("") + 
  ylab(expression(paste("Adjusted perching \noccurrences intercept ", 
                        italic("(n)")))) 

# Display plot
print(i_po_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept/study site by perch occ.jpeg", 
       i_po_site, width=200, height=150, units="mm")
```

```{r}
# Sum of section visits
i_sumsect_site <- ggplot(data=ppdata, aes(x=site, y=i_sumsecto_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=70, label="l", size=9, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(30, 70, 10), 
                     labels=seq(30, 70, 10), 
                     limits=c(30, 70)) + 
  xlab("") +
  ylab(expression(paste("Adjusted total arena \nsection visits intercept ", 
                        italic("(n)")))) 

# Display plot
print(i_sumsect_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept/study site by sum sections.jpeg", 
       i_sumsect_site, width=200, height=150, units="mm")
```

```{r}
# Total activity occurrences
i_act_site <- ggplot(data=ppdata, aes(x=site, y=i_totalacto_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=350, label="m", size=9, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(150, 350, 100), 
                     labels=seq(150, 350, 100), 
                     limits=c(150, 350)) + 
  xlab("") + 
  ylab(expression(paste("Adjusted total activity \noccurrences intercept", 
                        italic("(n)")))) 

# Display plot
print(i_act_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept/study site by total activity.jpeg", 
       i_act_site, width=150, height=150, units="mm")
```

```{r}
# Combine plots
plot <- ggarrange(i_bs_site, i_ts_site, i_e_site, i_ld_site, i_gd_site, 
                  i_b_site, i_jd_site, i_jo_site, i_md_site, i_pd_site, 
                  i_po_site, i_sumsect_site, i_act_site, nrow=5, ncol=3)

# Annotate plot
plot <- annotate_figure(plot, bottom=text_grob("Study site", size=25))

# Display plot
print(plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept/combined intercept plot.jpeg", 
       plot, width=450, height=650, units="mm")
```

## Slope GLMMs

Test behaviour slope (plasticity) against independent variables.

```{r}
# Summarise models
summary(lmer(s_bait_p ~ sex + weight + site + cond_n + age_n + 
               (1|arena), data=ppdata, na.action="na.fail", REML=FALSE))

summary(lmer(s_emerge_p ~ sex + weight + site + cond_n + age_n + 
               (1|arena), data=ppdata, na.action="na.fail", REML=FALSE))

summary(lmer(s_foodd_p ~ sex + weight + site + cond_n + age_n + 
               (1|arena), data=ppdata, na.action="na.fail", REML=FALSE))

summary(lmer(s_foodo_p ~ sex + weight + site + cond_n + age_n + 
               (1|arena), data=ppdata, na.action="na.fail", REML=FALSE))

summary(lmer(s_groomd_p ~ sex + weight + site + cond_n + age_n + 
               (1|arena), data=ppdata, na.action="na.fail", REML=FALSE))

summary(lmer(s_groomo_p ~ sex + weight + site + cond_n + age_n + 
               (1|arena), data=ppdata, na.action="na.fail", REML=FALSE))

summary(lmer(s_jumpd_p ~ sex + weight + site + cond_n + age_n + 
               (1|arena), data=ppdata, na.action="na.fail", REML=FALSE))

summary(lmer(s_jumpo_p ~ sex + weight + site + cond_n + age_n + 
               (1|arena), data=ppdata, na.action="na.fail", REML=FALSE))

summary(lmer(s_legsd_p ~ sex + weight + site + cond_n + age_n + 
               (1|arena), data=ppdata, na.action="na.fail", REML=FALSE))

summary(lmer(s_legso_p ~ sex + weight + site + cond_n + age_n + 
               (1|arena), data=ppdata, na.action="na.fail", REML=FALSE))

summary(lmer(s_moved_p ~ sex + weight + site + cond_n + age_n + 
               (1|arena), data=ppdata, na.action="na.fail", REML=FALSE))

summary(lmer(s_moveo_p ~ sex + weight + site + cond_n + age_n + 
               (1|arena), data=ppdata, na.action="na.fail", REML=FALSE))

summary(lmer(s_perchd_p ~ sex + weight + site + cond_n + age_n + 
               (1|arena), data=ppdata, na.action="na.fail", REML=FALSE))

summary(lmer(s_percho_p ~ sex + weight + site + cond_n + age_n + 
               (1|arena), data=ppdata, na.action="na.fail", REML=FALSE))

summary(lmer(s_sumsecto_p ~ sex + weight + site + cond_n + age_n + 
               (1|arena), data=ppdata, na.action="na.fail", REML=FALSE))

summary(lmer(s_totalacto_p ~ sex + weight + site + cond_n + age_n + 
               (1|arena), data=ppdata, na.action="na.fail", REML=FALSE))

summary(lmer(s_stress_bag_p ~ sex + weight + site + cond_n + age_n + 
               (1|arena), data=ppdata, na.action="na.fail", REML=FALSE))

summary(lmer(s_stress_trap_p ~ sex + weight + site + cond_n + age_n + 
               (1|arena), data=ppdata, na.action="na.fail", REML=FALSE))

summary(lmer(s_stress_table_p ~ sex + weight + site + cond_n + age_n + 
               (1|arena), data=ppdata, na.action="na.fail", REML=FALSE))
```

## Tables with kableExtra

```{r}
# 
response_var <- all.vars(formula(mod))[1]

# 
tidy_results <- tidy(mod) %>%
  mutate_if(is.numeric, ~round(., digits=3))

# 
table <- tidy_results %>%
  mutate(p.value=ifelse(p.value <=0.05, 
                        cell_spec(p.value, bold=TRUE), 
                        p.value)) %>%
  kbl(caption=response_var, escape=FALSE) %>%
  kable_classic(full_width=F)

# 
print(table)
```

## Slope AICc model selection

```{r}
# Food occ
mod_fos_cond <- lmer(s_foodo_p ~ cond_n + (1|arena), data=ppdata, 
                     control=control_ml, na.action="na.fail", REML=FALSE)

mod_fos_sex <- lmer(s_foodo_p ~ sex + (1|arena), data=ppdata, 
                    control=control_ml, na.action="na.fail", REML=FALSE)

mod_fos_weight <- lmer(s_foodo_p ~ weight + (1|arena), data=ppdata, 
                       control=control_ml, na.action="na.fail", REML=FALSE)

# 
models <- list(mod_fos_cond, mod_fos_sex, mod_fos_weight)

# 
model.names <- c("Condition", "Sex", "Body weight")

# Model selection
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Legs occ
mod_los_cond <- lmer(s_legso_p ~ cond_n + (1|arena), data=ppdata, 
                     control=control_ml, na.action="na.fail", REML=FALSE)

mod_los_sex <- lmer(s_legso_p ~ sex + (1|arena), data=ppdata, 
                    control=control_ml, na.action="na.fail", REML=FALSE)

mod_los_weight <- lmer(s_legso_p ~ weight + (1|arena), data=ppdata, 
                       control=control_ml, na.action="na.fail", REML=FALSE)

mod_los_site <- lmer(s_legso_p ~ site + (1|arena), data=ppdata, 
                     control=control_ml, na.action="na.fail", REML=FALSE)

#
models <- list(mod_los_cond, mod_los_sex, mod_los_weight, mod_los_site)

# 
model.names <- c("Condition", "Sex", "Body weight", "Study site")

# Model selection
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Jump occ
mod_jos_cond <- lmer(s_jumpo_p ~ cond_n + (1|arena), data=ppdata, 
                     control=control_ml, na.action="na.fail", REML=FALSE)

mod_jos_weight <- lmer(s_jumpo_p ~ weight + (1|arena), data=ppdata, 
                       control=control_ml, na.action="na.fail", REML=FALSE)

mod_jos_site <- lmer(s_jumpo_p ~ site + (1|arena), data=ppdata, 
                     control=control_ml, na.action="na.fail", REML=FALSE)

# 
models <- list(mod_jos_cond, mod_jos_weight, mod_jos_site)

# 
model.names <- c("Condition", "Body weight", "Study site")

# Model selections
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Move dur
mod_mds_cond <- lmer(s_moved_p ~ cond_n + (1|arena), data=ppdata, 
                     control=control_ml, na.action="na.fail", REML=FALSE)

mod_mds_weight <- lmer(s_moved_p ~ weight + (1|arena), data=ppdata, 
                       control=control_ml, na.action="na.fail", REML=FALSE)

mod_mds_site <- lmer(s_moved_p ~ site + (1|arena), data=ppdata, 
                     control=control_ml, na.action="na.fail", REML=FALSE)

# 
models <- list(mod_mds_cond, mod_mds_weight, mod_mds_site)

# 
model.names <- c("Condition", "Body weight", "Study site")

# Model selection
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Move occ
mod_mos_cond <- lmer(s_moveo_p ~ cond_n + (1|arena), data=ppdata, 
                     control=control_ml, na.action="na.fail", REML=FALSE)

mod_mos_weight <- lmer(s_moveo_p ~ weight + (1|arena), data=ppdata, 
                       control=control_ml, na.action="na.fail", REML=FALSE)

mod_mos_site <- lmer(s_moveo_p ~ site + (1|arena), data=ppdata, 
                     control=control_ml, na.action="na.fail", REML=FALSE)

mod_mos_sex <- lmer(s_moveo_p ~ sex + (1|arena), data=ppdata, 
                    control=control_ml, na.action="na.fail", REML=FALSE)

# 
models <- list(mod_mos_cond, mod_mos_weight, mod_mos_site, mod_mos_sex)

# 
model.names <- c("Condition", "Body weight", "Study site", "Sex")

# Model selections
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Table stress
mod_tabs_cond <- lmer(s_stress_table_p ~ cond_n + (1|arena), data=ppdata, 
                      control=control_ml, na.action="na.fail", REML=FALSE)

mod_tabs_weight <- lmer(s_stress_table_p ~ weight + (1|arena), data=ppdata, 
                        control=control_ml, na.action="na.fail", REML=FALSE)

mod_tabs_site <- lmer(s_stress_table_p ~ site + (1|arena), data=ppdata, 
                      control=control_ml, na.action="na.fail", REML=FALSE)

# 
models <- list(mod_tabs_cond, mod_tabs_weight, mod_tabs_site)

# 
model.names <- c("Condition", "Body weight", "Study site")

# Model selection
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Sum section
mod_sums_weight <- lmer(s_sumsecto_p ~ weight + (1|arena), data=ppdata, 
                        control=control_ml, na.action="na.fail", REML=FALSE)

mod_sums_sex <- lmer(s_sumsecto_p ~ sex + (1|arena), data=ppdata, 
                     control=control_ml, na.action="na.fail", REML=FALSE)

# 
models <- list(mod_sums_weight, mod_sums_sex)

# 
model.names <- c("Body weight", "Sex")

# Model selection
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Total act
mod_tots_cond <- lmer(s_totalacto_p ~ cond_n + (1|arena), data=ppdata, 
                      control=control_ml, na.action="na.fail", REML=FALSE)

mod_tots_weight <- lmer(s_totalacto_p ~ weight + (1|arena), data=ppdata, 
                        control=control_ml, na.action="na.fail", REML=FALSE)

mod_tots_sex <- lmer(s_totalacto_p ~ sex + (1|arena), data=ppdata, 
                     control=control_ml, na.action="na.fail", REML=FALSE)

# 
models <- list(mod_tots_cond, mod_tots_weight, mod_tots_sex)

# 
model.names <- c("Condition", "Body weight", "Sex")

# Model selection
aictab(cand.set=models, modnames=model.names)
```

## Plasticity by weight plots

```{r}
# Food occ by weight
food <- ggplot(data=ppdata, aes(x=weight, y=s_foodo_p)) + 
  geom_point(col=vir14) + 
  geom_smooth(method="lm", se=TRUE, col=vir14, fill=vir14) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  annotate("text", x=1.6, y=10, label="a", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_y_continuous(breaks=seq(-30, 10, 10), 
                     labels=seq(-30, 10, 10), 
                     limits=c(-30, 10)) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Adjusted food \ninteraction occurrences slope", 
                        italic(" (n)")))) 

# Display plot
print(food)
```

```{r}
# Legs occ by weight
legso_weight <- ggplot(data=ppdata, aes(x=weight, y=s_legso_p)) + 
  geom_point(col=vir12) + 
  geom_smooth(method="lm", se=TRUE, col=vir12, fill=vir12) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) +  
  annotate("text", x=1.6, y=25, label="b", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_y_continuous(breaks=seq(-100, 25, 25), 
                     labels=seq(-100, 25, 25), 
                     limits=c(-100, 25)) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Adjusted hindleg stand \noccurrences slope",
                        italic(" (n)")))) 

# Display plot
print(legso_weight)
```

```{r}
# Legs dur by weight
legsd_weight <- ggplot(data=ppdata, aes(x=weight, y=s_legsd_p)) + 
  geom_point(col=vir10) + 
  geom_smooth(method="lm", se=TRUE, col=vir10, fill=vir10) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  annotate("text", x=1.6, y=50, label="c", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_y_continuous(breaks=seq(-40, 50, 20), 
                     labels=seq(-40, 50, 20), 
                     limits=c(-40, 50)) + 
  labs("") + xlab("") + 
  ylab("Adjusted hindleg stand \nduration slope (s)") 

# Display plot
print(legsd_weight)
```

```{r}
# Move dur by weight
moveweight <- ggplot(data=ppdata, aes(x=weight, y=s_moved_p)) + 
  geom_point(col=vir9) + 
  geom_smooth(method="lm", se=TRUE, col=vir9, fill=vir9) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  annotate("text", x=1.6, y=70, label="d", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) +    
  scale_y_continuous(breaks=seq(-150, 50, 50), 
                     labels=seq(-150, 50, 50), 
                     limits=c(-170, 70)) + 
  xlab("") + ylab("Adjusted quadrupedal \nmovement duration slope (s)") 

# Display plot
print(moveweight)
```

```{r}
# Move occ by weight
moveo_weight <- ggplot(data=ppdata, aes(x=weight, y=s_moveo_p)) + 
  geom_point(col=vir8) + 
  geom_smooth(method="lm", se=TRUE, col=vir8, fill=vir8) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  annotate("text", x=1.6, y=50, label="e", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_y_continuous(breaks=seq(-150, 50, 50), 
                     labels=seq(-150, 50, 50), 
                     limits=c(-150, 50)) + 
  xlab("") + 
  ylab(expression(paste("Adjusted quadrupedal \nmovement occurrences slope ", 
                        italic(" (n)")))) 

# Display plot
print(moveo_weight)
```

```{r}
# Sums sect by weight
sum_weight <- ggplot(data=ppdata, aes(x=weight, y=s_sumsecto_p)) + 
  geom_point(col=vir7) + 
  geom_smooth(method="lm", se=TRUE, col=vir7, fill=vir7) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  annotate("text", x=1.6, y=0, label="f", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_y_continuous(breaks=seq(-40, 0, 20), 
                     labels=seq(-40, 0, 20), 
                     limits=c(-40, 0)) + 
  xlab("") + 
  ylab(expression(paste("Adjusted total\n arena section visits slope", 
                        italic(" (n)")))) 

# Display plot
print(sum_weight)
```

```{r}
# Total act by weight
tot_weight <- ggplot(data=ppdata, aes(x=weight, y=s_totalacto_p)) + 
  geom_point(col=vir5) + 
  geom_smooth(method="lm", se=TRUE, col=vir5, fill=vir5) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) +  
  annotate("text", x=1.6, y=0, label="g", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) +  
  scale_y_continuous(breaks=seq(-300, 10, 50), 
                     labels=seq(-300, 10, 50), 
                     limits=c(-300, 20)) + 
  xlab("") + 
  ylab(expression(paste("Adjusted total\n activity slope", italic(" (n)")))) 

# Display plot
print(tot_weight)
```

```{r}
# Combine plots
plot <- ggarrange(food, legso_weight, legsd_weight, moveweight, 
                  moveo_weight, sum_weight, tot_weight, nrow=3, ncol=3)

# Annotate plot
plot <- annotate_figure(plot, bottom=text_grob("Body weight (kg)", size=25))

# Display plot
print(plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/slope/weight plots.jpeg", 
       plot, width=350, height=400, units="mm")
```

## Plasticity by site plots

```{r}
# Assign custom numbers per site
site_colours <- c("Goorooyarroo"=vir12, "Mulligans Flat"=vir6)

# Create a df for using assay number as a number rather than a factor
d2pred <- data2_pred %>%
  mutate(assay_n=as.numeric(assay_n))
```

```{r}
# Food interaction dur violin
s_fd_site <- ggplot(data=ppdata, aes(x=site, y=s_foodd_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) +  
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=60, label="Ai", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=18), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) +    
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(-100, 60, 20), 
                     labels=seq(-100, 60, 20), 
                     limits=c(-100, 60)) + 
  labs("") + xlab("") + ylab("Adjusted food \ninteraction duration slope (s)") 

# Display plot
print(s_fd_site)
```

```{r}
# Food dur vs site smooth
food <- ggplot(data=d2pred, aes(x=assay_n, y=foodd_p, col=site, fill=site)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, aes(fill=site)) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  annotate("text", x=max(d2pred$assay_n), y=110, label="Aii", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=18), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_color_manual(values=site_colours) + 
  scale_fill_manual(values=site_colours) + 
  scale_y_continuous(breaks=seq(-50, 100, 25), 
                     labels=seq(-50, 100, 25), 
                     limits=c(-50, 110)) + 
  scale_x_continuous(breaks=c(min(d2pred$assay_n), max(d2pred$assay_n))) + 
  labs(col="Study site", fill="Study site") + 
  xlab("") + ylab("Adjusted food \ninteraction duration (s)") 

# Display plot
print(food)
```

```{r}
# Jump + climb dur violin
s_jd_site <- ggplot(data=ppdata, aes(x=site, y=s_jumpd_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=50, label="Bi", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=18), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(-150, 50, 50), 
                     labels=seq(-150, 50, 50), 
                     limits=c(-150, 50)) + 
  xlab("") + ylab("Adjusted jumping + \nclimbing duration slope (s)") 

# Display plot
print(s_jd_site)
```

```{r}
# Jump climb dur smooth
jump <- ggplot(data=d2pred, aes(x=assay_n, y=jumpd_p, col=site, fill=site)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, aes(fill=site)) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  annotate("text", x=max(d2pred$assay_n), y=200, label="Bii", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_color_manual(values=site_colours) + 
  scale_fill_manual(values=site_colours) + 
  scale_x_continuous(breaks=c(min(d2pred$assay_n), max(d2pred$assay_n))) + 
  labs(col="Study site", fill="Study site") + 
  xlab("") + ylab("Adjusted jumping + \nclimbing duration (s)") 

# Display plot
print(jump)
```

```{r}
# Jump + climb occurrences violin
s_jo_site <- ggplot(data=ppdata, aes(x=site, y=s_jumpo_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=0, label="Ci", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(-60, 0, 20), 
                     labels=seq(-60, 0, 20), 
                     limits=c(-60, 0)) + 
  xlab("") + 
  ylab(expression(paste("Adjusted jumping + \nclimbing occurrences slope  ", 
                        italic("(n)")))) 

# Display plot
print(s_jo_site)
```

```{r}
# Jump climb occ smooth
jump2 <- ggplot(data=d2pred, aes(x=assay_n, y=jumpo_p, col=site, fill=site)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, aes(fill=site)) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  annotate("text", x=max(d2pred$assay_n), y=80, label="Cii", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_color_manual(values=site_colours) + 
  scale_fill_manual(values=site_colours) + 
  scale_x_continuous(breaks=c(min(d2pred$assay_n), max(d2pred$assay_n))) + 
  labs(col="Study site", fill="Study site") + xlab("") + 
  ylab(expression(paste("Adjusted jumping + \nclimbing occurrences ", 
                        italic("(n)"), ""))) 

# Display plot
print(jump2)
```

```{r}
# Latency to emerge violin
s_e_site <- ggplot(data=ppdata, aes(x=site, y=s_emerge_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=50, label="Di", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=18), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) +  
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(-10, 50, 10), 
                     labels=seq(-10, 50, 10), 
                     limits=c(-10, 50)) + 
  labs("") + xlab("") + ylab("Adjusted latency to \nemerge slope (s)") 

# Display plot
print(s_e_site)
```

```{r}
# Latency to emerge smooth
emerge <- ggplot(data=d2pred, aes(x=assay_n, y=emerge_p, col=site, fill=site)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, aes(fill=site)) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  annotate("text", x=max(d2pred$assay_n), y=50, label="Dii", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=18), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) +  
  scale_color_manual(values=site_colours) + 
  scale_fill_manual(values=site_colours) + 
  scale_x_continuous(breaks=c(min(d2pred$assay_n), max(d2pred$assay_n))) + 
  scale_y_continuous(breaks=seq(-10, 50, 10), 
                     labels=seq(-10, 50, 10), 
                     limits=c(-10, 50)) + 
  labs(col="Study site", fill="Study site") + 
  xlab("") + ylab("Adjusted latency \nto emerge (s)") 

# Display plot
print(emerge)
```

```{r}
# Perching duration violin
s_pd_site <- ggplot(data=ppdata, aes(x=site, y=s_perchd_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) +  
  annotate("text", x="Mulligans Flat", y=200, label="Ei", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=18), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(-200, 200, 100), 
                     labels=seq(-200, 200, 100), 
                     limits=c(-200, 200)) + 
  labs("") + xlab("") + ylab("Adjusted perching \nduration slope (s)")

# Display plot
print(s_pd_site)
```

```{r}
# Perch dur smooth
perch <- ggplot(data=d2pred, aes(x=assay_n, y=perchd_p, col=site, fill=site)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, aes(fill=site)) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  annotate("text", x=max(d2pred$assay_n), y=300, 
           label="Eii", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=18), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_color_manual(values=site_colours) + 
  scale_fill_manual(values=site_colours) + 
  scale_x_continuous(breaks=c(min(d2pred$assay_n), max(d2pred$assay_n))) + 
  labs(col="Study site", fill="Study site") + 
  xlab("") + ylab("Adjusted perching \nduration (s)") 

# Display plot
print(perch)
```

```{r}
# Perching occurrences violin
s_po_site <- ggplot(data=ppdata, aes(x=site, y=s_percho_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) +  
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=5, label="Fi", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_fill_manual(values=c(vir12, vir6)) + 
  xlab("") + ylab(expression(paste("Adjusted perching \noccurrences slope", 
                                   italic(" (n)")))) 

# Display plot
print(s_po_site)
```

```{r}
# Perch occ smooth 
perch2 <- ggplot(data=d2pred, aes(x=assay_n, y=percho_p, col=site, fill=site)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, aes(fill=site)) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  annotate("text", x=max(d2pred$assay_n), y=30, label="Fii", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_color_manual(values=site_colours) + 
  scale_fill_manual(values=site_colours) + 
  scale_x_continuous(breaks=c(min(d2pred$assay_n), max(d2pred$assay_n))) + 
  labs(col="Study site", fill="Study site") + xlab("") + 
  ylab(expression(paste("Adjusted perching\n occurrences ", 
                        italic("(n)"), ""))) 

# Display plot
print(perch2)
```

```{r}
# Movement duration by site
s_md_site <- ggplot(data=ppdata, aes(x=site, y=s_moved_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  annotate("text", x="Mulligans Flat", y=50, label="Gi", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=18), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  labs("") + xlab("") + 
  ylab("Adjusted quadrupedal \nmovement duration slope (s)") 

# Display plot
print(s_md_site)
```

```{r}
# Move dur vs site 
move <- ggplot(data=d2pred, aes(x=assay_n, y=moved_p, col=site, fill=site)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, aes(fill=site)) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  annotate("text", x=max(d2pred$assay_n), y=160, 
           label="Gii", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=18), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_color_manual(values=site_colours) + 
  scale_fill_manual(values=site_colours) + 
  scale_x_continuous(breaks=c(min(d2pred$assay_n), max(d2pred$assay_n))) + 
  labs(col="Study site", fill="Study site") + 
  xlab("") + ylab("Adjusted quadrupedal\n movement duration (s)") 

# Display plot
print(move)
```

```{r}
# Bag stress rating violin
s_bs_site <- ggplot(data=ppdata, aes(x=site, y=s_stress_bag_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  annotate("text", x="Mulligans Flat", y=0.2, label="Hi", size=7, hjust=-2) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=18), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  labs("") + xlab("") + ylab("Adjusted bag stress\n rating slope") 

# Display plot
print(s_bs_site)
```

```{r}
# Bag stress vs site smooth
bag <- ggplot(data=d2pred, aes(x=assay_n, y=stress_bag_p, 
                               col=site, fill=site)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, aes(fill=site)) + 
  # geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  annotate("text", x=max(d2pred$assay_n), y=1.3, label="Hii", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=18), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_color_manual(values=site_colours) + 
  scale_fill_manual(values=site_colours) + 
  scale_y_continuous(breaks=seq(0.9, 1.3, 0.1), 
                     labels=seq(0.9, 1.3, 0.1), 
                     limits=c(0.9, 1.3)) + 
  scale_x_continuous(breaks=c(min(d2pred$assay_n), max(d2pred$assay_n))) + 
  labs(col="Study site", fill="Study site") + 
  xlab("") + ylab("Adjusted bag \nstress rating") 

# Display plot
print(bag)
```

```{r}
# Table stress site violin
s_ts_site <- ggplot(data=ppdata, aes(x=site, y=s_stress_table_p, fill=site)) + 
  geom_violin(alpha=0.8) + 
  geom_boxplot(col=steel, fill=steel, width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col=black, fill=white, 
               shape=21, size=3, stroke=1) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  annotate("text", x="Mulligans Flat", y=0.2, label="Ii", size=7, hjust=-3) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=18), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_fill_manual (values=c(vir12, vir6)) + 
  scale_y_continuous(breaks=seq(-0.1, 0.2, 0.1), 
                     labels=seq(-0.1, 0.2, 0.1), 
                     limits=c(-0.1, 0.2)) + 
  labs("") + xlab("") + ylab("Adjusted table \nstress rating slope") 

# Display plot
print(s_ts_site)
```

```{r}
# Table stress vs site 
table <- ggplot(data=d2pred, aes(x=assay_n, y=stress_table_p, 
                                 col=site, fill=site)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, aes(fill=site)) + 
  geom_hline(yintercept=0, linetype="dashed", col=steel) + 
  annotate("text", x=max(d2pred$assay_n), y=2, label="Iii", size=7, hjust=1) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(colour=steel), 
        axis.line.y=element_line(colour=steel), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=18), 
        plot.margin=margin(t=0.5, r=0.5, b=0.5, l=0.5, "cm")) + 
  scale_color_manual(values=site_colours) + 
  scale_fill_manual(values=site_colours) + 
  scale_x_continuous(breaks=c(min(d2pred$assay_n), max(d2pred$assay_n))) + 
  labs(col="Study site", fill="Study site") + 
  xlab("") + ylab("Adjusted table\n stress rating") 

# Display plot
print(table)
```

```{r}
# Combine plots
plot <- ggarrange(s_fd_site, 	s_jd_site, 	s_jo_site, food, jump, jump2, 
                  s_e_site, 	s_pd_site, s_po_site, emerge, perch, perch2, 
                  s_md_site, s_bs_site, s_ts_site, move, bag, table, 
                  nrow=6, ncol=3)

# Export plot as a jpeg file
ggsave(plot, filename="output/plots/slope/combined slope plots.jpeg", 
       height=700, width=450, units="mm")
```

# **Session information**

```{r, eval=TRUE}
# Display R version, OS, and loaded packages
sessionInfo()
```

```{r, include=FALSE}
# Creates a citation.cff file for your analyses in the metadata folder
params <- list(main_rmd=here::here("analyses.Rmd"))
knitr::knit_child("metadata/citation.Rmd", envir=list2env(params))
```