---
title: "Ranging after reintroduction: do behavioural traits predict dispersal into new territory?"
author: "Gee C & Wilson B" 
date: "March 4, 2025"
output: 
  html_document:
    toc: true
    number_sections: true
    top_depth: 3
    toc_float:
      collapsed: true
    theme: cerulean
    highlight: pygments
editor_options:
  chunk_output_type: console
knit: (function(inputFile, encoding) { rmarkdown::render(inputFile, encoding=encoding, output_file=file.path(dirname(inputFile), 'tutorial.html')) })
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, eval=FALSE)
```

# **Background**

This [R project](https://support.posit.co/hc/en-us/articles/200526207-Using-RStudio-Projects) presents the workflows and datasets used in the '*Ranging after reintroduction: do behavioural traits predict dispersal into new territory?*' project. For information on our methodological approach, see the [GitHub repo](https://github.com/coexistence-conservation-lab/eastern-quoll-behaviour-and-dispersal) README.

# **Abbreviations**

*Locations, organisations, and platforms*

  - **ACT:** Australian Capital Territory
  - **ANU:** The Australian National University
  - **API:** Application Programming Interface
  - **CCL:** Coexistence Conservation Lab
  - **GS:** Goorooyarroo Sanctuary
  - **MFGO:** Mulligans Flat–Goorooyarroo Woodland Experiment
  - **MFWS** or **MF:** Mulligans Flat Woodland Sanctuary

*Technical:*

  - **CMR:** Capture-mark-recapture
  - **df:** dataframe
  - **GLM:** generalised linear model
  - **GLMM:** generalised linear mixed model
  - **mod:** model
  
# **Setup**

  1. Manually install prerequisite packages.
  
Here we install the [pacman](https://cran.r-project.org/web/packages/pacman/index.html) package, which enables efficient installation and loading of other packages. Note that this only needs to be done once per computer.

```{r, eval=FALSE}
# Manually install package
install.packages(pacman)
```

 2. Install and load other required packages using the `pacman` package.

```{r, results='hide', warning=FALSE, message=FALSE}
# Install and load required packages
pacman::p_load(beepr, broom, broom.mixed, dplyr, grid, gtools, janitor, lme4, 
               lubridate, readxl, sjmisc, sjlabelled, 
               tidyverse, writexl, # General functionality
               ggplot2, ggpubr, jPlot, scales, viridis, # Plotting
               ggmap, sf, # Mapping
               AICcmodavg, corrplot, kableExtra, 
               lme4, lmerTest, MuMIn) # Modelling
```

  3. Assign custom values and global settings.

```{r}
# Assign paths to objects
raw_data <- "input/raw data.xlsx"
processed_data <- "output/processed data.xlsx"

# Global setting to deactivate scientific notation
options(scipen=100, digits=4)
```

  4. Register Google API key.

We need a [Google API key](https://developers.google.com/maps/documentation/javascript/get-api-key) to map our sites onto Google basemaps. 

If you don't have a Google API key, you will need to [set one up](https://support.google.com/googleapi/answer/6158862?hl=en), and paste it into the `input/api.txt` file. We have set up this repo so that Git will ignore this file so the key remains private and secure.

```{r}
# Read API key as a character string, while trimming whitespace
api_key <- trimws(readLines("metadata/api.txt", warn=FALSE))

# Register your Google API
ggmap::register_google(key=api_key)
```

   5. Set up [beepr](https://cran.r-project.org/web/packages/beepr/readme/README.html) package to play a sound when long-running code segments (🐢) finish running. 

```{r}
# Assign beepr sound; options include ping, coin, fanfare, complete, shotgun, 
# mario, treasure, ready, wilhelm, facebook, sword (try them out!)
sound <- "coin"
```

# **Data preparation**

Read in meta, quoll, capture, and session data.

```{r}
# Read in metadata
meta <- read_excel(raw_data, sheet="Metadata", na="N/A") %>% 
  # Standardise column names to lowercase with underscores
  clean_names()

# Read in quoll data
quoll <- read_excel(raw_data, sheet="Quoll", na="N/A") %>%
  # Standardise column names to lowercase with underscores
  clean_names()

# Read in capture data
capture <- read_excel(raw_data, sheet="Captures") %>%
  # Standardise column names to lowercase with underscores
  clean_names()

# Read in session data
session <- read_excel(raw_data, sheet="Sessions") %>%
  # Standardise column names to lowercase with underscores
  clean_names()
```

Generate behavioural occurrence dataset.

```{r}
# Read in behavioural assay data
raw <- read_excel(raw_data, sheet="Assays", na="N/A") %>% 
  # Standardise column names to lowercase with underscores
  clean_names() %>%
  # Select relevant columns
  select("obs_id"="observation_id", 
         "assay_id", 
         "quoll_code", 
         behaviour="behavior", 
         occurrences="total_number_of_occurences")

# Convert behavioural occurrences data to wide format 
occ <- pivot_wider(data=raw, 
                   names_from=behaviour, 
                   values_from=occurrences) %>%
  # Standardise column names to lowercase with underscores
  clean_names() %>%
  # Convert columns to numeric
  mutate(across(all_of(c("section_1", "section_2", "section_3", "section_4", 
                         "moving", "jump_climb", "food", "legs", 
                         "grooming", "resting", "perch")), as.numeric)) %>%
  # Rename columns
  rename(section_1_o="section_1", 
         section_2_o="section_2", 
         section_3_o="section_3", 
         section_4_o="section_4", 
         moving_o="moving", 
         jump_climb_o="jump_climb", 
         food_o="food", 
         legs_o="legs", 
         grooming_o="grooming", 
         resting_o="resting", 
         perch_o="perch")
```

Generate behavioural duration dataset.

```{r}
# Read in raw behavioural data
raw <- read_excel(raw_data, sheet="Assays", na="N/A") %>% 
  # Standardise column names to lowercase with underscores
  clean_names() %>%
  # Select relevant columns
  select("obs_id"="observation_id", 
         "assay_id", 
         quoll_code, 
         behaviour="behavior", 
         duration="total_duration_s")

# Convert behavioural duration data to wide format
dur <- pivot_wider(data=raw, 
                   names_from=behaviour, 
                   values_from=duration) %>%
  clean_names() %>%
  mutate(across(all_of(c("section_1", "section_2", "section_3", "section_4", 
                         "moving", "jump_climb", "food", "legs", 
                         "grooming", "resting", "perch")), as.numeric)) %>%
  rename(section_1_d="section_1", 
         section_2_d="section_2", 
         section_3_d="section_3", 
         section_4_d="section_4", 
         moving_d="moving", 
         jump_climb_d="jump_climb", 
         food_d="food", 
         legs_d="legs", 
         grooming_d="grooming", 
         resting_d="resting", 
         perch_d="perch")
```

Combine datasets.

```{r}
# Combine occurrence and duration data
assays <- left_join(occ, dur, by=c("obs_id", "assay_id", "quoll_code"))

# Sum visitations per 'section'
assays$sumsect_o <- rowSums(assays[, c("section_1_o", "section_2_o", 
                                       "section_3_o", "section_4_o")])

# Sum total activity occurrences
assays$totalact_o <- rowSums(assays[, c(4:10)])

# Append metadata for each assay
behavdata <- left_join(meta, assays, by=c("assay_id", "quoll_code"))%>%
  filter(!is.na(assay_number))

behavdata <- left_join(behavdata, session, by=c("session"))%>%
  filter(!is.na(assay_number))

quolldata <- left_join(capture, quoll, by=c("quoll_code"))

data <- left_join(behavdata, quolldata, by=c("session", "quoll_code"))

# Mutate the df
data <- data %>%
  select(-min_temp, -session_desc, -capture_date, -new_animal) %>%
  mutate(assay_number=as.factor(assay_number), 
         cond_n=as.numeric(ifelse(condition=="Excellent", 4, 
                            ifelse(condition=="Good", 3, 
                                   ifelse(condition=="Fair", 2, NA)))), 
         age_n=as.numeric(ifelse(age_estimate=="<1yr", 0, 
                               ifelse(age_estimate=="1-2yrs", 1, 
                                      ifelse(age_estimate=="2-3yrs", 2, NA)))))
```

## Calculate time differences 

```{r}
# Change time columns to correct POSIXct format
data <- data %>%
  # Convert columns to data format
  mutate(snout=as.POSIXct(snout), 
         process_end=as.POSIXct(process_end), 
         first_light=as.POSIXct(first_light), 
         # Calculate time differences
         time_processtoassay=snout - process_end, 
         time_assaytolight=first_light - snout) %>%
  # Remove two individuals who were assayed in September 2023
  filter(!(quoll_code %in% c("53328", "87DE0")))
```

## Correlation analysis

Conduct a correlation analysis to assess which morphological traits accounted for similar variation.

```{r}
cor <- data  %>% 
  dplyr::select(age_n, body_weight_kg, cond_n, pes_mean_mm, head_length_mm)

# Running the correlation test
cor <- cor(cor)
view(cor)

# Export to a csv file
write.csv(cor, "output/data - morphometric correlation matrix.csv")

# Creating and printing correlation matrix .jpgs which colour code the correlations
col_names <- c("Age estimate", "Body weight (kg)", "Condition", 
               "Pes length (mm)", "Head length (mm)")
row_names <- c("Age estimate", "Body weight (kg)", "Condition", 
               "Pes length (mm)", "Head length (mm)")
colnames(cor) <- col_names
rownames(cor) <- row_names

# Correlation of occurrences and duration with sections
jpeg(height=2000, width=2000, file="data corplot.jpeg", type="cairo")
corrplot(cor, method="color", 
                  col=colorRampPalette(c("# B8DE29", "# FFFFFF", 
                                         "# 2D718E"))(10), 
         type="upper", # creates a correlation matrix
         cl.cex=3, number.cex=4, tl.cex=4, diag=FALSE, 
         tl.col="black", tl.srt=45, addCoef.col="black")
dev.off()
```

# **Single assays**

I created a data subset to test the demographic, morphometric and behavioural variables for the first assay for all 36 individual eastern quolls. 

Subset data to include first assays only.

```{r}
# 
data1 <- data %>%
      filter(assay_number !=2)

# 
data1$site01 <- ifelse(data1$study_site=="Goorooyarroo", 1, 0)

# 
write.csv(data1, "output/data1 - first assay data raw.csv")
```

Convert the df to the format needed.

```{r}
# 
data1 <- data1 %>%
  mutate(age_n=as.numeric(as.character(age_n)), 
         condition=factor(condition, levels=c("Excellent", "Good", 
                                              "Fair", "Poor")), 
         # Convert to factor
         age_estimate=as.factor(age_estimate)) %>%
  # Assign new labels
  mutate(age_estimate=recode(age_estimate, 
                             "1-2yrs"="1–2 years", 
                             "<1yr"="<1 year", 
                             "2-3yrs"="2–3 years"))  %>%
  # Reorder new labels
  mutate(age_estimate=factor(age_estimate, 
                             levels=c("2–3 years", "1–2 years", "<1 year")))

```

## Demo/morpho analysis

```{r}
# 
mod <- glm(site01 ~ sex + body_weight_kg + age_n + cond_n, 
           data=data1, family=binomial)

# Summarise model
summary(mod)
```

## Extract table

```{r}
# 
tidy_results <- tidy(mod) %>%
  mutate_if(is.numeric, ~round(., digits=3))

# 
table <- tidy_results %>%
  mutate(p.value=ifelse(p.value <=0.05, 
                        cell_spec(p.value, bold=TRUE), 
                        p.value)) %>%
  kbl(caption="Study site", escape=FALSE) %>%
  kable_classic(full_width=F, html_font="Times New Roman") %>%
  kable_styling(bootstrap_options="striped", font_size=15)

# Display table
print(table)
```

## Plot demographics and morphology

```{r}
# Age plot
age_plot  <- ggplot() + 
  geom_smooth(data=data1, aes(x=age_n, y=as.numeric(site01)), 
              colour="# 1caa85", fill="# 68C6AE") + 
  theme_minimal() + 
  theme(panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=16)) + 
  scale_y_continuous(breaks=seq(-0.4, 1, 0.2), 
                     labels=seq(-0.4, 1, 0.2), limits=c(-0.4, 1)) + 
  xlab("Age estimate") + 
  ylab("Probability of capture in MF (0) or GS (1)") + 
  annotate("text", x=1.9, y=0.95, label="A", size=8, hjust=1)
```

```{r}
# Plot smoothed regression
cond_plot  <- ggplot() + 
 geom_smooth(data=data1, aes(x=cond_n, y=as.numeric(site01)), 
             colour="# 2D718E", fill="# 5089A1") + 
  theme_minimal() + 
  theme(panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=16)) + 
   scale_y_continuous(breaks=seq(-0.4, 1, 0.2), 
                      labels=seq(-0.4, 1, 0.2), 
                      limits=c(-0.4, 1)) + 
  xlab("Body condition score") + ylab(" ") + 
  annotate("text", x=3.9, y=0.95, label="C", size=8, hjust=1)
```

```{r}
# Plot smoothed regression
weight_plot  <- ggplot() + 
 geom_smooth(data=data1, aes(x=body_weight_kg, y=as.numeric(site01)), 
             colour="# 482677", fill="# 674A8E") + 
  theme_minimal() + 
  theme(panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=16)) + 
   scale_y_continuous(breaks=seq(-0.4, 1, 0.2), 
                      labels=seq(-0.4, 1, 0.2), limits=c(-0.4, 1)) + 
  ylab(" ") + xlab("Body weight (kg)") + 
  annotate("text", x=1.6, y=0.95, label="B", size=8, hjust=-0.5)
```


```{r}
# Combine grooming plots
plot <- ggarrange(age_plot, weight_plot, cond_plot, nrow=1, ncol=3)
plot <- annotate_figure(plot, bottom=text_grob("Study site", size=20))

# Display plot
print(plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/morpho plots.jpeg", 
       plot, width=350, height=150, units="mm")
```

## Environmental vars influence GLM analysis

```{r}
# 
mod <- glm(food_d ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data1)
mod <- glm(food_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data1)

# 
mod <- glm(grooming_d ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data1)
mod <- glm(grooming_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data1)

# 
mod <- glm(jump_climb_d ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data1)
mod <- glm(jump_climb_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data1)

# 
mod <- glm(legs_d ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data1)
mod <- glm(legs_o  ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data1)

# 
mod <- glm(moving_d ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data1)
mod <- glm(moving_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data1)

# 
mod <- glm(perch_d ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data1)
mod <- glm(perch_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data1)

# 
mod <- glm(bait_eaten_g ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data1)
mod <- glm(sumsect_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data1)
mod <- glm(totalact_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data1)
mod <- glm(emerge_max ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data1)
# 

mod <- glm(stress_in_trap ~ temp + moon_phase, data=data1)
mod <- glm(stress_in_bag ~ temp + moon_phase, data=data1)
mod <- glm(stress_on_table ~ temp + moon_phase, data=data1)
summary(mod)
```

## Environmental variables table

```{r}
# Tables with kableExtra
response_var <- all.vars(formula(mod))[1]

# 
tidy_results <- tidy(mod) %>%
  mutate_if(is.numeric, ~round(., digits=3))
# 
table <- tidy_results %>%
  mutate(p.value=ifelse(p.value <=0.05, cell_spec(p.value, bold=TRUE), p.value)) %>%
  kbl(caption=response_var, escape=FALSE) %>%
  kable_classic(full_width=F, html_font="Times New Roman") %>%
  kable_styling(bootstrap_options="striped", font_size=12)

# 
table
```

## Analysis of behaviour indicators

  1. Test the influence of fixed (e.g., site) and random effects (e.g., arena) on behavioural responses (e.g., food interaction duration) using the `lmer()` function.
  2. If multiple fixed effects produce significance, perform model selection using the dredge() function to determine which fixed effects are within delta 2 AICc.

## Capture behaviour GLMMS

Test behaviour in GLMMs including environmental variables as competing factors in fixed effects model.

```{r}
# 
mod <- lmer(bait_eaten_g ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + (1|arena), 
            data=data1, na.action="na.fail")

# 
mod <- lmer(emerge_max ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + temp + (1|arena), 
            data=data1, na.action="na.fail")

# 
mod <- lmer(food_d ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + (1|arena), 
            data=data1, na.action="na.fail")

# 
mod <- lmer(food_o ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + (1|arena), 
            data=data1, na.action="na.fail")

# 
mod <- lmer(grooming_d ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + temp + (1|arena), 
            data=data1, na.action="na.fail")

# 
mod <- lmer(grooming_o ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + temp + (1|arena), 
            data=data1, na.action="na.fail")

# 
mod <- lmer(jump_climb_d ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + (1|arena), 
            data=data1, na.action="na.fail")

# 
mod <- lmer(jump_climb_o ~ study_site + sex + age_n + cond_n + 
              body_weight_kg + (1|arena), 
            data=data1, na.action="na.fail")

# 
mod <- lmer(legs_d ~ study_site + sex + age_n + cond_n + 
              body_weight_kg + (1|arena), 
            data=data1, na.action="na.fail")

# 
mod <- lmer(legs_o ~ study_site + sex + age_n + cond_n + 
              body_weight_kg + (1|arena), 
            data=data1, na.action="na.fail")

# 
mod <- lmer(moving_d ~ study_site + sex + age_n + cond_n + 
              body_weight_kg + time_assaytolight + (1|arena), 
            data=data1, na.action="na.fail")

# 
mod <- lmer(moving_o ~ study_site + sex + age_n + cond_n + 
              body_weight_kg + time_assaytolight + (1|arena), 
            data=data1, na.action="na.fail")

# 
mod <- lmer(perch_d ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + temp + moon_phase + 
              time_assaytolight + time_processtoassay + (1|arena), 
            data=data1, na.action="na.fail")

# 
mod <- lmer(perch_o ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + (1|arena), 
            data=data1, na.action="na.fail")

# 
mod <- lmer(stress_in_bag ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + (1|arena), 
            data=data1, na.action="na.fail")

# 
mod <- lmer(stress_in_trap ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + (1|arena), 
            data=data1, na.action="na.fail")

# 
mod <- lmer(stress_on_table ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + (1|arena), 
            data=data1, na.action="na.fail")

# 
mod <- lmer(sumsect_o ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + (1|arena), 
            data=data1, na.action="na.fail")

# 
mod <- lmer(totalact_o ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + (1|arena), 
            data=data1, na.action="na.fail")
```


```{r}
# Tables with kableExtra
response_var <- all.vars(formula(mod))[1]

# 
tidy_results <- tidy(mod) %>%
  mutate_if(is.numeric, ~round(., digits=3))

# 
table <- tidy_results %>%
  mutate(p.value=ifelse(p.value <=0.05, cell_spec(p.value, bold=TRUE), p.value)) %>%
  kbl(caption=response_var, escape=FALSE)

# 
table
```

## Capture behaviour AICc model selection

```{r}
# 
control_ml <- lmerControl(optimizer="Nelder_Mead")

# Grooming duration 
mod_gd_site <- lmer(grooming_d ~ study_site + (1|arena), 
            data=data1, control=control_ml, na.action="na.fail")

# 
mod_gd_temp <- lmer(grooming_d ~ temp + (1|arena), 
            data=data1, control=control_ml, na.action="na.fail")

# 
models <- list(mod_gd_site, mod_gd_temp)

# 
model.names <- c("Site", "Temp")

# 
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Grooming occurrences
mod_go_site <- lmer(grooming_o ~ study_site + (1|arena), 
            data=data1, control=control_ml, na.action="na.fail")

# 
mod_go_temp <- lmer(grooming_o ~ temp + (1|arena), 
            data=data1, control=control_ml, na.action="na.fail")

# 
models <- list(mod_go_site, mod_go_temp)

# 
model.names <- c("Site", "Temp")

# 
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Latency to emerge
mod_emerge_temp <- lmer(emerge_max ~ temp + (1|arena), 
            data=data1, control=control_ml, na.action="na.fail")

# 
mod_emerge_weight <- lmer(emerge_max ~ body_weight_kg + (1|arena), 
            data=data1, control=control_ml, na.action="na.fail")

# 
mod_emerge_age <- lmer(emerge_max ~ age_n + (1|arena), 
            data=data1, control=control_ml, na.action="na.fail")

# 
models <- list(mod_emerge_temp, mod_emerge_weight, mod_emerge_age)

# 
model.names <- c("Temp", "Weight", "Age")

# 
aictab(cand.set=models, modnames=model.names)
```

## Capture behaviour plots

```{r}
# Grooming duration v study site plot
groomd_site <- ggplot(data=data1, aes(x=study_site, y=grooming_d, 
                                      fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 7E67A0", "# 68C6A5")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=18),  
       axis.text.x=element_text(size=18)) + 
  scale_y_continuous(breaks=seq(0, 110, 20), 
                     labels=seq(0, 110, 20), 
                     limits=c(0, 110)) + 
  xlab("") + ylab("Grooming duration (s)") + labs("") + 
  annotate("text", x="Mulligans Flat", y=110, label="A", size=9, hjust=-2)

# Display plot
print(groomd_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/1st assay - study site v grooming dur.jpeg", 
       groomd_site, width=150, height=150, units="mm")
```

```{r}
# Grooming occurrences v study site plot
groomo_site <- ggplot(data=data1, aes(x=study_site, y=grooming_o, 
                        fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 7E67A0", "# 68C6A5")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=18),  
        axis.text.x=element_text(size=18)) + 
  scale_y_continuous(breaks=seq(0, 8, 2), 
                     labels=seq(0, 8, 2), 
                     limits=c(0, 8)) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Grooming occurrences ", italic(" (n)")))) + 
  annotate("text", x="Mulligans Flat", y=8, label="B", size=9, hjust=-2)

# Display plot
print(groomo_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/1st assay - study site v grooming occ.jpeg", 
       groomo_site, width=150, height=150, units="mm")
```

```{r}
# Moving duration v study site plot
moved_site <- ggplot(data=data1, aes(x=study_site, y=moving_d, 
                                     fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 7E67A0", "# 68C6A5")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=18),  
        axis.text.x=element_text(size=18)) + 
  scale_y_continuous(breaks=seq(0, 300, 50), 
                     labels=seq(0, 300, 50), 
                     limits=c(0, 300)) + 
  labs("") + xlab("") + ylab("Quadrupedal movement \nduration (s)") + 
  annotate("text", x="Mulligans Flat", y=300, label="C", size=9, hjust=-2)

# Display plot
print(moved_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/1st assay - study site v moving dur.jpeg", 
       moved_site, width=100, height=150, units="mm")
```

Combine plots.

```{r}
# Combine grooming plots
plot <- ggarrange(groomd_site, groomo_site, moved_site, ncol=3, nrow=1)
plot <- annotate_figure(plot, 
        # left=text_grob("Adjusted behaviours over two assays", rot=90, size=16, face="bold"), 
        bottom=text_grob("Study site", size=20))

# Display plot
print(plot)

# Export plot as a jpeg file
ggsave(filename="1st assay - groom and move violin plots.jpeg", 
       plot, width=350, height=150, units="mm")
```

```{r}
# Perching vs temp
perchtemp <- ggplot(data=data1, aes(x=temp, y=perch_d)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, 
              colour="# 1caa85", fill="# 68C6AE") + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=20)) + 
  scale_y_continuous(breaks=seq(0, 1000, 250), 
                     labels=seq(0, 1000, 250), 
                     limits=c(-30, 1000)) + 
  xlab(expression(paste("Ambient temperature (", degree, "C)"))) + 
  ylab("Perching duration (s)") + labs("") + 
  annotate("text", x=23, y=990, label="A", size=10, hjust=0)

# Display plot
print(perchtemp)

# Export plot as a jpeg file
ggsave(filename="output/plots/1st assay perch temp.jpeg", 
       perchtemp, width=150, height=150, units="mm")
```

```{r}
# Latency to emerge vs temp
emergetemp <- ggplot(data=data1, aes(x=temp, y=emerge_max)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, 
              colour="# 482677", fill="# 674A8E") + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=20)) + 
  scale_x_continuous(breaks=seq(10, 25, 5), 
                     labels=seq(10, 25, 5), 
                     limits=c(10, 25)) + 
  xlab(expression(paste("Ambient temperature (", degree, "C)"))) + 
  ylab("Latency to emerge (s)") + labs("") + 
  annotate("text", x=23, y=59, label="B", size=10, hjust=-1)

# Display plot
print(emergetemp)

# Export plot as a jpeg file
ggsave(filename="output/plots/1st assay emerge temp.jpeg", 
       emergetemp, width=150, height=150, units="mm")
```

```{r}
# Emerge weight
emergeweight <- ggplot(data=data1, aes(x=body_weight_kg, y=emerge_max)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, 
              colour="# 2D718E", fill="# 5089A1") + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=20)) + 
  scale_x_continuous(breaks=seq(0.25, 1.75, 0.5), 
                     labels=seq(0.25, 1.75, 0.5), 
                     limits=c(0.25, 1.75)) + 
  labs("") + xlab("Body weight (kg)") + ylab("Latency to emerge (s)") + 
  annotate("text", x=1.6, y=59, label="C", size=10, hjust=0)

# Display plot
print(emergeweight)

# Export plot as a jpeg file
ggsave(filename="output/plots/1st assay emerge weight.jpeg", 
       emergeweight, width=150, height=150, units="mm")
```

Combine plots.

```{r}
# Combine emerge plots
plot <- ggarrange(perchtemp, emergetemp, emergeweight, ncol=3, nrow=1)
plot <- annotate_figure(plot, 
        bottom=text_grob("Study site", size=20))

# Display plot
print(plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/1st assay emerge plots.jpeg", 
       plot, width=350, height=150, units="mm")
```

# **Multiple assays**

I created a data subset to test the behavioural variables over multiple assays for 17 individual eastern quolls. 

## Subset to animals with repeated assays

```{r}
# 
values_to_exclude <- c("524E3", "53221", "53511", "53512", "53515", 
                       "53526", "563A6", "56ABE", "56EB2", "5FC08", 
                       "6D409" , "6D53F" , "6E990", "71A4D", "71B69", 
                       "86E19", "86FFC" , "87F61", "BCA09")

# 
data2 <- data %>%
  filter(!quoll_code %in% values_to_exclude)

# Export to csv file
write.csv(data2, 
          "output/data2 - individuals with two assays raw data.csv")
```

## Capture and recapture environmental vars GLM analysis

```{r}
# Fit GLM to test feeding response by environmental variables
mod <- glm(bait_eaten_g ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data2)

# Fit GLM to test reaching food responses by environmental variables
mod <- glm(food_d ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data2)
mod <- glm(food_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data2)

# Fit GLM to test grooming responses by environmental variables
mod <- glm(grooming_d ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data2)
mod <- glm(grooming_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data2)

# Fit GLM to test jumping and climbing responses by environmental variables
mod <- glm(jump_climb_d ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data2)
mod <- glm(jump_climb_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data2)

# Fit GLM to test standing responses by environmental variables
mod <- glm(legs_d ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data2)
mod <- glm(legs_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data2)

# Fit GLM to test movement responses by environmental variables
mod <- glm(moving_d ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data2)
mod <- glm(moving_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data2)

# Fit GLM to test perching responses by environmental variables
mod <- glm(perch_d ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data2)
mod <- glm(perch_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data2)

# Fit GLM to test emergence responses by environmental variables
mod <- glm(emerge_max ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data2)
mod <- glm(sumsect_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data2)
mod <- glm(totalact_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, data=data2)

# Fit GLM to test stress responses by environmental variables
mod <- glm(stress_in_trap ~ temp + moon_phase, data=data2)
mod <- glm(stress_in_bag ~ temp + moon_phase, data=data2)
mod <- glm(stress_on_table ~ temp + moon_phase, data=data2)
```

## Capture and recapture environmental variable tables

```{r}
# Collect variables
response_var <- all.vars(formula(mod))[1]

# 
tidy_results <- tidy(mod) %>%
  mutate_if(is.numeric, ~round(., digits=3))

# 
table <- tidy_results %>%
  mutate(p.value=ifelse(p.value <=0.05, 
                        cell_spec(p.value, bold=TRUE), 
                        p.value)) %>%
  kbl(caption=response_var, escape=FALSE)

# Display the table
print(table)
```

## Capture and recapture behaviour GLMMs with environmental vars

```{r}
# 
data2 <- data2 %>%
  mutate(age_n=as.numeric(as.character(age_n)))

# Fit GLM to test responses by predictor variables
mod <- lmer(bait_eaten_g ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + moon_phase + (1|arena), 
            data=data2, na.action="na.fail")

# Fit GLM to test responses by predictor variables
mod <- lmer(emerge_max ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + temp + (1|arena), 
            data=data2, na.action="na.fail")

# Fit GLM to test responses by predictor variables
mod <- lmer(food_d ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + moon_phase + (1|arena), 
            data=data2, na.action="na.fail")

# Fit GLM to test responses by predictor variables
mod <- lmer(food_o ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + time_assaytolight + 
              time_processtoassay + (1|arena), data=data2, 
            na.action="na.fail")

# Fit GLM to test responses by predictor variables
mod <- lmer(grooming_d ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + (1|arena), 
            data=data2, na.action="na.fail")

# Fit GLM to test responses by predictor variables
mod <- lmer(grooming_o ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + (1|arena), 
            data=data2, na.action="na.fail")

# Fit GLM to test responses by predictor variables
mod <- lmer(jump_climb_d ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + time_assaytolight +  (1|arena), 
            data=data2, na.action="na.fail")

# Fit GLM to test responses by predictor variables
mod <- lmer(jump_climb_o ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + (1|arena), 
            data=data2, na.action="na.fail")

# Fit GLM to test responses by predictor variables
mod <- lmer(legs_d ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + moon_phase + (1|arena), 
            data=data2, na.action="na.fail")

# Fit GLM to test responses by predictor variables
mod <- lmer(legs_o ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + time_assaytolight + 
              time_processtoassay + (1|arena), 
            data=data2, na.action="na.fail")

# Fit GLM to test responses by predictor variables
mod <- lmer(moving_d ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + moon_phase + 
              time_assaytolight + time_processtoassay + (1|arena), 
            data=data2, na.action="na.fail")

# Fit GLM to test responses by predictor variables
mod <- lmer(moving_o ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + moon_phase + 
              time_assaytolight + time_processtoassay + (1|arena), 
            data=data2, na.action="na.fail")

# Fit GLM to test responses by predictor variables
mod <- lmer(perch_d ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + (1|arena), 
            data=data2, na.action="na.fail")

# Fit GLM to test responses by predictor variables
mod <- lmer(perch_o ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + (1|arena), 
            data=data2, na.action="na.fail")

# Fit GLM to test responses by predictor variables
mod <- lmer(stress_in_bag ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + (1|arena), 
            data=data2, na.action="na.fail")

# Fit GLM to test responses by predictor variables
mod <- lmer(stress_in_trap ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + (1|arena), 
            data=data2, na.action="na.fail")

# Fit GLM to test responses by predictor variables
mod <- lmer(stress_on_table ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + 
            (1|arena), 
            data=data2, na.action="na.fail")

# Fit GLM to test responses by predictor variables
mod <- lmer(sumsect_o ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + moon_phase + 
              time_processtoassay +  (1|arena), 
            data=data2, na.action="na.fail")

# Fit GLM to test responses by predictor variables
mod <- lmer(totalact_o ~ study_site + sex + age_n + 
              cond_n + body_weight_kg + moon_phase + 
              time_processtoassay + time_assaytolight + (1|arena), 
            data=data2, na.action="na.fail")
```

Generate model tables.

```{r}
# Collect variables
response_var <- all.vars(formula(mod))[1]

# 
tidy_results <- tidy(mod) %>%
  mutate_if(is.numeric, ~round(., digits=3))

# 
table <- tidy_results %>%
  mutate(p.value=ifelse(p.value <=0.05, 
                        cell_spec(p.value, bold=TRUE), 
                        p.value)) %>%
  kbl(caption=response_var, escape=FALSE)

# Display table
print(table)
```

## Capture and recapture behaviour AICc model selection

```{r}
# 
control_ml <- lmerControl(optimizer="Nelder_Mead")

# Food occ   
mod_fo_process <- lmer(food_o ~ time_processtoassay + (1|arena), 
            data=data2, control=control_ml, na.action="na.fail")

# 
mod_fo_light <- lmer(food_o ~ time_assaytolight + (1|arena), 
            data=data2, control=control_ml, na.action="na.fail")

# 
models <- list(mod_fo_process, mod_fo_light)

# 
model.names <- c("Process to assay", "Assay to light")

# 
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Legs occ   
mod_lo_process <- lmer(legs_o ~ time_processtoassay + (1|arena), 
            data=data2, control=control_ml, na.action="na.fail")

# 
mod_lo_light <- lmer(legs_o ~ time_assaytolight + (1|arena), 
            data=data2, control=control_ml, na.action="na.fail")

# 
models <- list(mod_lo_process, mod_lo_light)

# 
model.names <- c("Process to assay", "Assay to light")

# 
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Move occ   
mod_mo_process <- lmer(moving_o ~ time_processtoassay + (1|arena), 
            data=data2, control=control_ml, na.action="na.fail")

# 
mod_mo_light <- lmer(moving_o ~ time_assaytolight + (1|arena), 
            data=data2, control=control_ml, na.action="na.fail")

# 
models <- list(mod_mo_process, mod_mo_light)

# 
model.names <- c("Process to assay", "Assay to light")

# 
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Move dur   
mod_md_process <- lmer(moving_d ~ time_processtoassay + (1|arena), 
            data=data2, control=control_ml, na.action="na.fail")

# 
mod_md_light <- lmer(moving_d ~ time_assaytolight + (1|arena), 
            data=data2, control=control_ml, na.action="na.fail")

# 
models <- list(mod_md_process, mod_md_light)

# 
model.names <- c("Process to assay", "Assay to light")

# 
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Table stress   
mod_table_process <- lmer(stress_on_table ~ time_processtoassay + (1|arena), 
            data=data2, control=control_ml, na.action="na.fail")

# 
mod_table_light <- lmer(stress_on_table ~ time_assaytolight + (1|arena), 
            data=data2, control=control_ml, na.action="na.fail")

# 
models <- list(mod_table_process, mod_table_light)

# 
model.names <- c("Process to assay", "Assay to light")

# 
aictab(cand.set=models, modnames=model.names)
```

## Plots for two assays

```{r}
# Grooming duration by sex 
groomdur <- ggplot(data=data2, aes(x=sex, y=grooming_d, fill=sex)) + 
  geom_boxplot() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="black", 
             shape=21, size=1.5, stroke=1) + 
  scale_fill_manual (values=c("# 7E67A0", "# 4DBC94")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=20)) + 
  scale_y_continuous(breaks=seq(0, 80, 20), 
                     labels=seq(0, 80, 20), 
                     limits=c(0, 80)) + 
  xlab("Sex") + 
  ylab("Grooming duration (s)") + labs("") + 
  scale_x_discrete(labels=c("M"="Male", "F"="Female")) + 
  annotate("text", x="M", y=80, label="C", size=10, hjust=-2)

# Display plot
print(groomdur)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assays - sex v grooming.jpeg", 
       groomdur, width=150, height=150, units="mm")
```

```{r}
# Bait eaten v age
baitage <- ggplot(data=data2, aes(x=age_estimate, y=bait_eaten_g, 
                                  fill=age_estimate)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="black", 
             shape=21, size=1.5, stroke=1) + 
  scale_fill_manual (values=c("# 7E67A0", "# 68C6A5", "# D0E970")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19)) + 
  scale_y_continuous(breaks=seq(0, 50, 25), 
                     labels=seq(0, 50, 25), 
                     limits=c(0, 50)) + 
  xlab("Age estimate") + 
  ylab("Bait eaten (g)") + labs("") + 
  scale_x_discrete(labels=c("<1yr"="<1 year", 
                            "1-2yrs"="1-2 years", 
                            "2-3yrs"="2-3 years")) + 
  annotate("text", x=2, y=50, label="A", size=10, hjust=-6)

# Display plot
print(baitage)
```

```{r}
# Perhing v site
perchocc <- ggplot(data=data2, aes(x=study_site, y=perch_o, fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="black", 
             shape=21, size=1.5, stroke=1) + 
  scale_fill_manual (values=c("# 7E67A0", "# 68C6A5")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19)) + 
  scale_y_continuous(breaks=seq(0, 60, 20), 
                     labels=seq(0, 60, 20), 
                     limits=c(0, 60)) + 
  xlab("Study site") + 
  ylab(expression(paste("Perching occurrences ", italic(" (n)")))) + 
  annotate("text", x="Mulligans Flat", y=60, label="B", size=10, hjust=-2)

# Display plot
print(perchocc)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assays raw - site v perching.jpeg", 
       perchocc, width=150, height=150, units="mm")
```

```{r}
# Combine  plots
plot <- ggarrange(baitage, perchocc, groomdur, ncol=3, nrow=1)

# Display plot
print(plot)

# Export plot as a jpeg file
ggsave(plot, filename="2 assays -bait perch emerge.jpeg", 
       height=150, width=350, units="mm")
```

```{r}
# Total section vs moon 
sum_moon <- ggplot(data=data2, aes(x=moon_phase, y=sumsect_o)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, 
              colour="# 440154", fill="# 82568D") + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=18)) + 
  scale_y_continuous(breaks=seq(0, 100, 25), 
                     labels=seq(0, 100, 25), 
                     limits=c(0, 100)) + 
  labs("") + xlab("Moon illumination (%)") + 
  ylab(expression(paste("Sum of arena section visits", italic(" (n)")))) + 
  annotate("text", x=100, y=100, label="A", size=10, hjust=1)

# Display plot
print(sum_moon)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assay raw - emerge temp.jpeg", 
       emergetemp, width=150, height=150, units="mm")
```

```{r}
# Food occ v time assay to light 
foodo_light <- ggplot(data=data2, aes(x=time_assaytolight, y=food_o)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, 
              colour="# 472D7B", fill="# 8473A7") + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=18)) + 
  scale_y_continuous(breaks=seq(0, 50, 10), 
                     labels=seq(0, 50, 10), 
                     limits=c(-5, 55)) + 
  xlab("Time: assay to first light (mins)") + 
  ylab(expression(paste("Food interaction occurrences ", 
                        italic(" (n)")))) + labs("") + 
  annotate("text", x=400, y=55, label="B", size=10, hjust=1)

# Display plot
print(foodo_light)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assay raw - food light.jpeg", 
       foodo_light, width=150, height=150, units="mm")
```

```{r}
# Food occ v time process to assay
foodo_process <- ggplot(data=data2, aes(x=time_processtoassay, y=food_o)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, 
              colour="# 3B528B", fill="# 7C8CB2") + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=18)) + 
  scale_y_continuous(breaks=seq(0, 50, 10), 
                     labels=seq(0, 50, 10), 
                     limits=c(-10, 55)) + 
  scale_x_continuous(breaks=seq(50, 250, 50), 
                     labels=seq(50, 250, 50), 
                     limits=c(40, 250)) + 
  xlab("Time: processing to assay (mins)") + 
  ylab(expression(paste("Food interaction occurrences ", 
                        italic(" (n)")))) + labs("") + 
  annotate("text", x=250, y=55, label="C", size=10, hjust=1)

# Display plot
print(foodo_process)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assay raw - food process.jpeg", 
       foodo_process, width=150, height=150, units="mm")
```

```{r}
# Move dur v time assay to light 
moved_light <- ggplot(data=data2, aes(x=time_assaytolight, y=moving_d)) + 
 geom_point() + 
  geom_smooth(method="lm", se=TRUE, 
              colour="# 2C728E", fill="# 72A1B4") + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=18)) + 
  scale_y_continuous(breaks=seq(0, 250, 50), 
                     labels=seq(0, 250, 50), 
                     limits=c(0, 250)) + 
  xlab("Time: assay to first light (mins)") + 
  ylab("Quadrupedal movement duration (s)") + labs("") + 
  annotate("text", x=400, y=245, label="D", size=10, hjust=1)

# Display plot
print(moved_light)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assay raw - legs light.jpeg", 
       legso_light, width=150, height=150, units="mm")
```

```{r}
# Move occ v time assay to light 
moveo_light <- ggplot(data=data2, aes(x=time_assaytolight, y=moving_o)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, 
              colour="# 21908C", fill="# 6BB5B2") + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=18)) + 
  scale_y_continuous(breaks=seq(0, 200, 50), 
                     labels=seq(0, 200, 50), 
                     limits=c(0, 200)) + 
  labs("") + xlab("Time: assay to first light (mins)") + 
  ylab(expression(paste("Quadrupedal movement occurrences ", italic(" (n)")))) + 
  annotate("text", x=395, y=195, label="E", size=10, hjust=1)

# Display plot
print(moveo_light)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assay raw - legs light.jpeg", 
       legso_light, width=150, height=150, units="mm")
```

```{r}
# Move occ v time process to assay
moveo_process <- ggplot(data=data2, aes(x=time_processtoassay, y=moving_o)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, 
              colour="# 27AD81", fill="# 6FC8AB") + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=18)) + 
  scale_x_continuous(breaks=seq(50, 300, 50), 
                     labels=seq(50, 300, 50), 
                     limits=c(50, 300)) + 
  xlab("Time: processing to assay (mins)") + 
  ylab(expression(paste("Quadrupedal movement occurrences ", 
                        italic(" (n)")))) + labs("") + 
  annotate("text", x=300, y=195, label="F", size=10, hjust=1)

# Display plot
print(moveo_process)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assay raw - legs process.jpeg", 
       legso_process, width=150, height=150, units="mm")
```

```{r}
# Legs occ v time assay to light 
legso_light <- ggplot(data=data2, aes(x=time_assaytolight, y=legs_o)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, 
              colour="# 5DC863", fill="# 93DA97") + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=18)) + 
  scale_y_continuous(breaks=seq(0, 150, 50), 
                     labels=seq(0, 150, 50), 
                     limits=c(0, 150)) + 
  labs("") + xlab("Time: assay to first light (mins)") + 
  ylab(expression(paste("Hind leg stand occurrences", italic(" (n)")))) + 
  annotate("text", x=400, y=150, label="G", size=10, hjust=1)

# Display plot
print(legso_light)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assay raw - legs light.jpeg", 
       legso_light, width=150, height=150, units="mm")
```

```{r}
# Legs occ v time process to assay
legso_process <- ggplot(data=data2, aes(x=time_processtoassay, y=legs_o)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, 
              colour="# AADC32", fill="# C6E876") + 
  theme_minimal() + 
    theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=18)) + 
  scale_y_continuous(breaks=seq(0, 150, 50), 
                     labels=seq(0, 150, 50), 
                     limits=c(-20, 150)) + 
  scale_x_continuous(breaks=seq(50, 280, 50), 
                     labels=seq(50, 280, 50), 
                     limits=c(30, 290)) + 
  labs("") + xlab("Time: processing to assay (mins)") + 
  ylab(expression(paste("Hind leg stand occurrences", italic(" (n)")))) + 
  annotate("text", x=290, y=150, label="H", size=10, hjust=1)

# Display plot
print(legso_process)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assay raw - legs process.jpeg", 
       legso_process, width=150, height=150, units="mm")
```

```{r}
# Latency to emerge vs temp
emergetemp <- ggplot(data=data2, aes(x=temp, y=emerge_max)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, 
              colour="# AADC32", fill="# C6E876") + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=20)) + 
  scale_x_continuous(breaks=seq(10, 25, 5), 
                     labels=seq(10, 25, 5), 
                     limits=c(10, 25)) + 
  xlab(expression(paste("Ambient temperature (", degree, "C)"))) + 
  ylab("Latency to emerge (s)") + labs("") + 
  annotate("text", x=25, y=60, label="I", size=10, hjust=1)

# Display plot
print(emergetemp)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assay raw - emerge temp.jpeg", 
       emergetemp, width=150, height=150, units="mm")
```

Combine plots.

```{r}
# Combine  plots
plot <- ggarrange(sum_moon, foodo_light, foodo_process, 
                  moved_light, moveo_light, moveo_process, 
                  legso_light, legso_process, emergetemp, 
                  ncol=3, nrow=3) 

# Display plot
print(plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assays - fixed effects.jpeg", 
       plot, width=350, height=350, units="mm")
```

## Environmental vars data mutate

I minimised environmental influence on the behaviour models by standardising their values: the means of the environmental variables were all scaled to zero, and the standard deviation to one, as in Wilson *et al*. (2022).

```{r}
# Mutating the environmental variables 
data2_mutate <- data2 %>%
  mutate_at(vars(5, 44, 65, 66), ~ as.vector(scale(.)))

# 
data2$condition <- factor(data2$condition, 
                          levels=c("Excellent", "Good", "Fair", "Poor"))

# 
write.csv(data2_mutate, 
          "output/data2_mutate - both assays env vars adjusted.csv")
```

## Adjusted behaviour variables - extracting values

I fitted GLMs of the adjusted behaviours against assay number and the standardised environmental variables, and at the same time, I extracted intercept (‘personality’ measure) and slope (‘plasticity’ measure) coefficients for each behavioural variable. 

```{r}
# 
mod <- glm(food_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, 
           family=gaussian, data=data2_mutate)
             data2_mutate$foodo_p <- predict(mod, type="response")

#  
mod <- glm(food_d ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, 
           family=gaussian, data=data2_mutate)
             data2_mutate$foodd_p <- predict(mod, type="response")

# 
mod <- glm(grooming_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, 
           family=gaussian, data=data2_mutate)
             data2_mutate$groomo_p <- predict(mod, type="response")

# 
mod <- glm(grooming_d ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, 
           family=gaussian, data=data2_mutate)
             data2_mutate$groomd_p <- predict(mod, type="response")
            
#  
mod <- glm(jump_climb_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, 
           family=gaussian, data=data2_mutate)
             data2_mutate$jumpo_p <- predict(mod, type="response")

# 
mod <- glm(jump_climb_d ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, 
           family=gaussian, data=data2_mutate)
             data2_mutate$jumpd_p <- predict(mod, type="response")

# 
mod <- glm(legs_d ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, 
           family=gaussian, data=data2_mutate)
             data2_mutate$legsd_p <- predict(mod, type="response")

# 
mod <- glm(legs_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, 
           family=gaussian, data=data2_mutate)
             data2_mutate$legso_p <- predict(mod, type="response")

# 
mod <- glm(moving_d ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, 
           family=gaussian, data=data2_mutate)
             data2_mutate$moved_p <- predict(mod, type="response")
          
#    
mod <- glm(moving_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, 
           family=gaussian, data=data2_mutate)
             data2_mutate$moveo_p <- predict(mod, type="response")

# 
mod <- glm(perch_d ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, 
           family=gaussian, data=data2_mutate)
             data2_mutate$perchd_p <- predict(mod, type="response")
             
# 
mod <- glm(perch_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, 
           family=gaussian, data=data2_mutate)
             data2_mutate$percho_p <- predict(mod, type="response")

# 
mod <- glm(bait_eaten_g ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, 
           family=gaussian, data=data2_mutate)
             data2_mutate$bait_p <- predict(mod, type="response")
 
# 
mod <- glm(sumsect_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, 
           family=gaussian, data=
             data2_mutate)
             data2_mutate$sumsecto_p <- predict(mod, type="response")            
             
# 
mod <- glm(totalact_o ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, 
           family=gaussian, data=data2_mutate)
             data2_mutate$totalacto_p <- predict(mod, type="response")
           
#   
mod <- glm(stress_in_trap ~ temp + moon_phase, 
           family=gaussian, data=data2_mutate)
             data2_mutate$trapstress_p <- predict(mod, type="response")

# 
mod <- glm(stress_in_bag ~ temp + moon_phase, 
           family=gaussian, data=data2_mutate)
             data2_mutate$bagstress_p <- predict(mod, type="response")

# 
mod <- glm(stress_on_table ~ temp + moon_phase, 
           family=gaussian, data=data2_mutate)
             data2_mutate$tablestress_p <- predict(mod, type="response")

# 
mod <- glm(emerge_max ~ temp + moon_phase + 
             time_assaytolight + time_processtoassay, 
           family=gaussian, data=data2_mutate)
             data2_mutate$emerge_p <- predict(mod, type="response")
```

## Adjusted behaviour variables

Once adjusted variables were extracted, we tidied up the df. 

```{r}
# 
data2_pred <- data2_mutate %>%
  select(-food_o, -food_d, -grooming_o, -grooming_d, 
         -jump_climb_o, -jump_climb_d, -legs_o, -legs_d, 
         -moving_o, -moving_d, -perch_d, -perch_o, 
         -resting_o, -resting_d, -bait_eaten_g, -sumsect_o, 
         -totalact_o, -emerge_max, -time_to_emerge_s, -arena_entry) %>%
  mutate(assay_number=as.factor(assay_number))

# Export to a csv file
write.csv(data2_pred, 
          "output/data2_pred - both assays adjusted env variables.csv")
```

## Adjusted behaviour variables - test vs assay number

```{r}
# 
mod <- glm(foodd_p ~ assay_number, family=gaussian, data=data2_pred)

# 
mod <- glm(foodo_p ~ assay_number, family=gaussian, data=data2_pred)
mod <- glm(bait_p ~ assay_number, family=gaussian, data=data2_pred)

# 
mod <- glm(groomd_p ~ assay_number, family=gaussian, data=data2_pred)
mod <- glm(groomo_p ~ assay_number, family=gaussian, data=data2_pred)

# 
mod <- glm(jumpd_p ~ assay_number, family=gaussian, data=data2_pred)
mod <- glm(jumpo_p ~ assay_number, family=gaussian, data=data2_pred)

# 
mod <- glm(legsd_p ~ assay_number, family=gaussian, data=data2_pred)
mod <- glm(legso_p ~ assay_number, family=gaussian, data=data2_pred)

# 
mod <- glm(moved_p ~ assay_number, family=gaussian, data=data2_pred)
mod <- glm(moveo_p ~ assay_number, family=gaussian, data=data2_pred)
mod <- glm(emerge_p ~ assay_number, family=gaussian, data=data2_pred)

# 
mod <- glm(perchd_p ~ assay_number, family=gaussian, data=data2_pred)
mod <- glm(percho_p ~ assay_number, family=gaussian, data=data2_pred)

# 
mod <- glm(sumsecto_p ~ assay_number, family=gaussian, data=data2_pred)
mod <- glm(totalacto_p ~ assay_number, family=gaussian, data=data2_pred)

# 
mod <- glm(bagstress_p ~ assay_number, family=gaussian, data=data2_pred)
mod <- glm(trapstress_p ~ assay_number, family=gaussian, data=data2_pred)
mod <- glm(tablestress_p ~ assay_number, family=gaussian, data=data2_pred)
```

```{r}
# Table with kableExtra
response_var <- all.vars(formula(mod))[1]

# 
tidy_results <- tidy(mod) %>%
  mutate_if(is.numeric, ~round(., digits=3))

# 
table <- tidy_results %>%
  mutate(p.value=ifelse(p.value <=0.05, cell_spec(p.value, bold=TRUE), p.value)) %>%
  kbl(caption=response_var, escape=FALSE)

# 
table
```

## Adjusted behaviour variables vs assay number plots

```{r}
# Latency to emerge
ed_plot <- ggplot(data=data2_pred, aes(x=assay_number, y=emerge_p, 
                                       fill=assay_number)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 7E67A0", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) +  
  scale_y_continuous(breaks=seq(0, 50, 10), 
                     labels=seq(0, 50, 10), 
                     limits=c(0, 50)) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Latency to emerge (s)"))) + 
  annotate("text", x="2", y=50, label="D", size=10, hjust=-2)

# Display plot
print(ed_plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/assay number - emerge.jpeg", 
       ed_plot, width=150, height=150, units="mm")
```

```{r}
# Food interaction occurrences
fo_plot <- ggplot(data=data2_pred, aes(x=assay_number, y=foodo_p, 
                                       fill=assay_number)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 7E67A0", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19),  
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Food interaction \noccurrences", italic(" (n) ")))) + 
  annotate("text", x="2", y=30, label="A", size=10, hjust=-2) + 

# Display plot
print(fo_plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/assay number - food occ - site.jpeg", 
       fo_plot, width=200, height=150, units="mm")
```

```{r}
# Jump climb duration
jd_plot <- ggplot(data=data2_pred, aes(x=assay_number, y=jumpd_p, 
                                       fill=assay_number)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 7E67A0", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19),  
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Jumping + climbing \nduration (s)"))) + 
  annotate("text", x="2", y=200, label="B", size=10, hjust=-2)

# Display plot
print(jd_plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/assay number - jump dur - site.jpeg", 
       jd_plot, width=200, height=150, units="mm")
```

```{r}
# Jump climb occurrences
jo_plot <- ggplot(data=data2_pred, aes(x=assay_number, y=jumpo_p, 
                        fill=assay_number)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 7E67A0", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19),  
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Jumping + \nclimbing occurrences ", 
                        italic(" (n) ")))) + 
  annotate("text", x="2", y=80, label="C", size=10, hjust=-2) + 

# Display plot
print(jo_plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/assay number - jump occ - site.jpeg", 
       jo_plot, width=200, height=150, units="mm")
```

```{r}
# Perching occurrences
po_plot <- ggplot(data=data2_pred, aes(x=assay_number, y=percho_p, 
                        fill=assay_number)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 7E67A0", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19),  
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) +   
  scale_y_continuous(breaks=seq(0, 30, 10), 
                     labels=seq(0, 30, 10), 
                     limits=c(0, 30)) + 
  labs("") + xlab("") + 
  lab(expression(paste("Perching \noccurrences ", italic(" (n) ")))) + 
  annotate("text", x="2", y=30, label="E", size=10, hjust=-2) + 

# Display plot
print(po_plot)

# Export plot as a jpeg file
ggsave(po_plot, filename="output/plots/assay number - perch occ.jpeg", 
       height=150, width=150, units="mm")
```

```{r}
# Moving duration
md_plot <- ggplot(data=data2_pred, aes(x=assay_number, y=moved_p, 
                                       fill=assay_number)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 7E67A0", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19),  
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) +   
  scale_y_continuous(breaks=seq(0, 160, 50), 
                     labels=seq(0, 160, 50), 
                     limits=c(0, 160)) + 
  xlab("") + ylab(expression(paste("Quadrupedal \nmovement duration (s)"))) + 
  annotate("text", x="2", y=160, label="F", size=10, hjust=-2) + 
  labs("") 

# Display plot
print(md_plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/assay number - move dur - site.jpeg", 
       md_plot, width=200, height=150, units="mm")
```

```{r}
# Moving occurrences
mo_plot <- ggplot(data=data2_pred, aes(x=assay_number, y=moveo_p, 
                                       fill=assay_number)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 7E67A0", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19),  
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) +   
  scale_y_continuous(breaks=seq(0, 150, 50), 
                     labels=seq(0, 150, 50), 
                     limits=c(0, 150)) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Quadrupedal\n movement occurrences", 
                        italic(" (n) ")))) + 
  annotate("text", x="2", y=150, label="G", size=10, hjust=-2) + 

# Display plot
print(mo_plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/assay number - move occ - site.jpeg", 
       mo_plot, width=200, height=150, units="mm")
```

```{r}
# Legs occurrences
lo_plot <- ggplot(data=data2_pred, aes(x=assay_number, y=legso_p, 
                        fill=assay_number)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 7E67A0", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19),  
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) +   
  scale_y_continuous(breaks=seq(0, 110, 20), 
                     labels=seq(0, 110, 20), 
                     limits=c(0, 110)) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Hindleg stand \noccurrences ", italic("(n) ")))) + 
  annotate("text", x="2", y=110, label="H", size=10, hjust=-2) + 

# Display plot
print(lo_plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/assay number - legs occ - site.jpeg", 
       lo_plot, width=200, height=150, units="mm")
```

```{r}
# Sum total activity 
act_plot <- ggplot(data=data2_pred, aes(x=assay_number, y=totalacto_p, 
                                        fill=assay_number)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 7E67A0", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19),  
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) +   
  scale_y_continuous(breaks=seq(0, 400, 100), 
                     labels=seq(0, 400, 100), 
                     limits=c(0, 400)) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Total activity \noccurrences", italic(" (n) ")))) + 
  annotate("text", x="2", y=400, label="I", size=10, hjust=-2) + 

print(act_plot)

ggsave(filename="output/plots/assay number - tot sect - site.jpeg", 
       act_plot, width=200, height=150, units="mm")
```

```{r}
# Sum section visits
sum_plot <- ggplot(data=data2_pred, aes(x=assay_number, y=sumsecto_p, 
                                        fill=assay_number)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 7E67A0", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=19),  
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) +  
  scale_y_continuous(breaks=seq(0, 80, 20), 
                     labels=seq(0, 80, 20), 
                     limits=c(0, 80)) + 
  xlab("") + 
  ylab(expression(paste("Total arena \nsection visits", 
                                   italic(" (n) ")))) + 
  annotate("text", x="2", y=80, label="J", size=10, hjust=-2) + 
  labs("") 

print(sum_plot)

ggsave(filename="output/plots/assay number - sum sect - site.jpeg", 
       sum_plot, width=200, height=150, units="mm")
```

```{r}
# Bag stress
bag_plot <- ggplot(data=data2_pred, aes(x=assay_number, y=bagstress_p, 
                                        fill=assay_number)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 7E67A0", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) +   
  scale_y_continuous(breaks=seq(1, 1.5, 0.1), 
                     labels=seq(1, 1.5, 0.1), 
                     limits=c(0.9, 1.5)) + 
  labs("") + xlab("") + ylab("Adjusted bag\n stress rating") + 
  annotate("text", x="2", y=1.5, label="K", size=10, hjust=-2) + 

  
print(bag_plot)

ggsave(filename="output/plots/assay number - sum sect - site.jpeg", 
       sum_plot, width=200, height=150, units="mm")
```

```{r}
# Table stress
table_plot <- ggplot(data=data2_pred, aes(x=assay_number, y=tablestress_p, 
                                          fill=assay_number)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 7E67A0", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) +  
  scale_y_continuous(breaks=seq(1, 1.5, 0.1), 
                     labels=seq(1, 1.5, 0.1), 
                     limits=c(0.9, 1.5)) + 
  labs("") + xlab("") + ylab("Adjusted table \nstress rating") + 
  annotate("text", x="2", y=1.5, label="L", size=10, hjust=-2)

# Display plot
print(table_plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/assay number - sum sect - site.jpeg", 
       sum_plot, width=200, height=150, units="mm")
```

```{r}
# 
plot <- ggarrange(fo_plot, jd_plot, jo_plot, ed_plot, po_plot, md_plot, 
                  mo_plot, lo_plot, act_plot, sum_plot, bag_plot, table_plot, 
                  nrow=4, ncol=3)

# 
plot <- annotate_figure(plot, 
                        bottom=text_grob("Assay / capture number", size=25))

# Display plot
print(plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/2 assays - activity by assay number.jpeg", 
       plot, width=400, height=550, units="mm")
```

# **Personality and plasticity**

I created data frame for personality and plasticity analysis with individual eastern quoll demographic and morphological traits.  

```{r}
# 
quoll2 <- data2_pred %>%
  select(-assay_date, -initial_repeat_assay, -trap_location, -snout, 
         -haunches, -trap_session_date, -trap_session_morning, -first_light, 
         -ssr, -process_start, -process_end, -pouch, -teeth_colour, 
         -teeth_sharpness, -teeth_shine, -stress_in_trap, -stress_in_bag, 
         -stress_on_table)

# 
unique(quoll2$age_estimate)
quoll2 <- quoll2 %>%
  # Convert columns to factor format
  mutate(condition=as.factor(condition), 
         age_estimate=as.factor(age_estimate)) %>%
  # Rename columns
  mutate(age_estimate=recode(age_estimate, 
                             "1-2yrs"="1–2 years", 
                             "<1yr"="<1 year", 
                             "2-3yrs"="2–3 years"))  %>%
  # Reorder new labels
   mutate(condition=factor(condition, levels=c("Excellent", "Good", 
                                               "Fair", "Poor")), 
          age_estimate=factor(age_estimate, levels=c("2–3 years", 
                                                     "1–2 years", 
                                                     "<1 year")))

# Export as a csv file
write.csv(quoll2, "output/quoll2.csv")
```

## Intercept and slope 

Using the adjusted values I fitted models to extract the intercept (personality) and slope (plasticity) over multiple assays. 

```{r}
# Create a list of dependent behavioural variables
dependent <- c("foodd_p", "foodo_p", "groomd_p", "groomo_p", 
               "jumpd_p", "jumpo_p", "legsd_p", "legso_p", 
               "moved_p", "moveo_p", "perchd_p", "percho_p", 
               "bait_p", "sumsecto_p", "totalacto_p", "trapstress_p", 
               "bagstress_p", "tablestress_p", "emerge_p")

# Define the levels in an object
quolls <- levels(factor(quoll2$quoll_code))

# Create a blank dataframe with four columns
coefficients <- data.frame(quoll_code=NULL, intercept=NULL, 
                           slope=NULL, variable=NULL)

# Loop to extract the intercept and slope of each behavioural response
for(v in 1:NROW(dependent)) {
  for(i in 1:NROW(quolls)){
    quoll_code <- quolls[i]
    variable <- dependent[v]
    mod <- lm(eval(as.name(paste0(variable))) ~ 
                assay_number + temp + moon_phase + 
                time_assaytolight + time_processtoassay, 
              data=subset(quoll2, quoll_code==quolls[i]))
    i <- coef(mod)[1]
    s <- coef(mod)[2]
    results <- data.frame(cbind(quoll_code, i, s, variable))
    coefficients <- rbind(coefficients, results)
  }
}

# Convert the df to wide format
coefficients <- reshape(coefficients, idvar="quoll_code", 
                        timevar="variable", direction="wide")

# Define names of the coefficients
names(coefficients) <- gsub("\\.", "_", names(coefficients))

# Remove duplicated coefficients
coefficients <- coefficients[ , !duplicated(colnames(coefficients))]

# Check structure of coefficients
str(coefficients)

# If they are being read as characters, change to numeric 
cols_to_convert <- setdiff(names(coefficients), "quoll_code")
coefficients[cols_to_convert] <- lapply(coefficients[cols_to_convert], as.numeric)

# Join behavioural df with post-release df
ppdata <- left_join(quoll2, coefficients, by="quoll_code", "session") %>%
  distinct(quoll_code, .keep_all=TRUE)

# Remove duplicated column names
ppdata <- ppdata[ , !duplicated(colnames(ppdata))]

# Write to csv file
write_csv(ppdata, "output/ppdata - intercept and slope data.csv")
```

## Analyse behaviour indicators for personality and plasticity 

  1. I tested the influence of fixed (e.g., site) and random effects (e.g., arena) on behavioural responses (e.g., food interaction duration) using the `lmer()` function.
  2. If multiple fixed effects produced significance, I performed model selection to determine which fixed effects are within delta 2 AICc.

## Intercept GLMMs - testing behaviour intercept (personality) against independent variables

```{r}
# 
mod <- lmer(i_bait_p ~ sex + body_weight_kg + study_site + 
              cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(i_emerge_p ~ sex + body_weight_kg + study_site + 
              cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(i_foodd_p ~ sex + body_weight_kg + study_site + 
              cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(i_foodo_p ~ sex + body_weight_kg + study_site + 
              cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(i_groomd_p ~ sex + body_weight_kg + study_site + 
              cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(i_groomo_p ~ sex + body_weight_kg + study_site + 
              cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(i_jumpd_p ~ sex + body_weight_kg + study_site + 
              cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(i_jumpo_p ~ sex + body_weight_kg + study_site + 
              cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(i_legsd_p ~ sex + body_weight_kg + study_site + 
              cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(i_legso_p ~ sex + body_weight_kg + study_site + 
              cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(i_moved_p ~ sex + body_weight_kg + study_site + 
              cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(i_moveo_p ~ sex + body_weight_kg + study_site + 
              cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(i_perchd_p ~ sex + body_weight_kg + study_site + 
              cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(i_percho_p ~ sex + body_weight_kg + study_site + 
              cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(i_sumsecto_p ~ sex + body_weight_kg + study_site + 
              cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(i_totalacto_p ~ sex + body_weight_kg + study_site + 
              cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(i_trapstress_p ~ sex + body_weight_kg + study_site + 
              cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(i_bagstress_p ~ sex + body_weight_kg + study_site + 
              cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(i_tablestress_p ~ sex + body_weight_kg + study_site + 
              cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")
```

## Intercept tables

```{r}
# 
response_var <- all.vars(formula(mod))[1]
tidy_results <- tidy(mod) %>%
  mutate_if(is.numeric, ~round(., digits=3))

# 
table <- tidy_results %>%
  mutate(p.value=ifelse(p.value <=0.05, 
                        cell_spec(p.value, bold=TRUE), 
                        p.value)) %>%
  kbl(caption=response_var, escape=FALSE) %>%
  kable_classic(full_width=F)

# 
table
```

## Intercept AICc model selection

```{r}
# Perching duration
mod_pdi_site <- lmer(i_perchd_p ~ study_site + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")
mod_pdi_weight <- lmer(i_perchd_p ~ sex*body_weight_kg + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")
models <- list(mod_pdi_site, mod_pdi_weight)
model.names <- c("Study site", "Interaction of Sex and body weight kg")
aictab(cand.set=models, modnames=model.names)
```

## Intercept plots

```{r}
# Bag stress
i_bs_site <- ggplot(data=ppdata, aes(x=study_site, y=i_bagstress_p, 
                                     fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) +   
  scale_y_continuous(breaks=seq(0.9, 1.3, 0.1), 
                     labels=seq(0.9, 1.3, 0.1), 
                     limits=c(0.9, 1.3)) + 
  labs("") + xlab(" ") + 
  ylab("Adjusted bag stress \nrating intercept") + 
  annotate("text", x="Mulligans Flat", y=1.3, 
           label=parse(text="A"), size=10, hjust=-2)

# Display plot
print(i_bs_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept - study site v bag stress.jpeg", 
       i_bs_site, width=200, height=150, units="mm")
```

```{r}
# Table stress
i_ts_site <- ggplot(data=ppdata, aes(x=study_site, y=i_tablestress_p, 
                                     fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
       text=element_text(size=19), 
       axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  scale_y_continuous(breaks=seq(0.9, 1.3, 0.1), 
                     labels=seq(0.9, 1.3, 0.1), 
                     limits=c(0.9, 1.3)) + 
  labs("") + xlab("") + 
  ylab("Adjusted table stress \nrating intercept") + 
  annotate("text", x="Mulligans Flat", y=1.3, 
           label=parse(text="B"), size=10, hjust=-2)

# Display plot
print(i_ts_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept - study site v table stress.jpeg", 
       i_ts_site, width=200, height=150, units="mm")
```

```{r}
# Latency to emerge
i_e_site <- ggplot(data=ppdata, aes(x=study_site, y=i_emerge_p, 
                                    fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  scale_y_continuous(breaks=seq(0, 50, 10), 
                     labels=seq(0, 50, 10), 
                     limits=c(0, 50)) + 
  labs("") + xlab(" ") + 
  ylab("Adjusted latency \nto emerge (s) intercept") + 
  annotate("text", x="Mulligans Flat", y=50, 
           label=parse(text="C"), size=10, hjust=-2)

# Display plot
print(i_e_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept - study site v latency to emerge.jpeg", 
       i_e_site, width=200, height=150, units="mm")
```

```{r}
# Bait eaten
i_b_site <- ggplot(data=ppdata, aes(x=study_site, y=i_bait_p, 
                                    fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  labs("") + xlab(" ") + 
  ylab("Adjusted \nbait eaten (g) intercept") + 
  annotate("text", x="Mulligans Flat", y=20, 
           label=parse(text="F"), size=10, hjust=-2)

# Display plot
print(i_b_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept - study site v bait.jpeg", 
       i_b_site, width=200, height=150, units="mm")
```

```{r}
# Groom duration
i_gd_site <- ggplot(data=ppdata, aes(x=study_site, y=i_groomd_p, 
                                     fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  xlab("") + 
  ylab("Adjusted grooming\n duration (s) intercept") + labs("") + 
  annotate("text", x="Mulligans Flat", y=25, 
           label=parse(text="E"), size=10, hjust=-2)

# Display plot
print(i_gd_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept - study site v grooming dur.jpeg", 
       i_gd_site, width=150, height=150, units="mm")
```

```{r}
# Hind legs duration
i_ld_site <- ggplot(data=ppdata, aes(x=study_site, y=i_legsd_p, 
                                     fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  scale_y_continuous(breaks=seq(100, 300, 100), 
                     labels=seq(100, 300, 100), 
                     limits=c(100, 300)) + 
  labs("") + xlab(" ") + 
  ylab("Adjusted hindleg stands \nduration (s) intercept") + 
  annotate("text", x="Mulligans Flat", y=300, 
           label=parse(text="D"), size=10, hjust=-2)

# Display plot
print(i_ld_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept - study site v legs dur.jpeg", 
       i_ld_site, width=200, height=150, units="mm")
```

```{r}
# Jump/climb duration
i_jd_site <- ggplot(data=ppdata, aes(x=study_site, y=i_jumpd_p, 
                                     fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  scale_y_continuous(breaks=seq(0, 200, 50), 
                     labels=seq(0, 200, 50), 
                     limits=c(0, 220)) + 
  labs("") + xlab(" ") + 
  ylab("Adjusted jumping + climbing \nduration (s) intercept") + 
  annotate("text", x="Mulligans Flat", y=220, 
           label=parse(text="G"), size=10, hjust=-2)

# Display plot
print(i_jd_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept - study site v jumpclimb dur.jpeg", 
       i_jd_site, width=200, height=150, units="mm")
```

```{r}
# Jump/climb occurrences
i_jo_site <- ggplot(data=ppdata, aes(x=study_site, y=i_jumpo_p, 
                                     fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_y_continuous(breaks=seq(0, 80, 20), 
                     labels=seq(0, 80, 20), 
                     limits=c(0, 90)) + 
  labs("") + xlab(" ") + 
  ylab(expression(paste("Adjusted jumping + climbing\n occurrences intercept", 
                        italic("(n)")))) + 
  annotate("text", x="Mulligans Flat", y=90, 
           label=parse(text="H"), size=10, hjust=-2)

# Display plot
print(i_jo_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept - study site v jumpclimb occ.jpeg", 
       i_jo_site, width=200, height=150, units="mm")
```

```{r}
# Perch duration
i_pd_site <- ggplot(data=ppdata, aes(x=study_site, y=i_perchd_p, 
                                     fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
       text=element_text(size=19), 
       axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  labs("") + xlab(" ") + 
  ylab("Adjusted perching\n duration (s) intercept") + 
  annotate("text", x="Mulligans Flat", y=300, 
           label=parse(text="J"), size=10, hjust=-2)

# Display plot
print(i_pd_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept - study site v perch dur.jpeg", 
       i_pd_site, width=200, height=150, units="mm")
```

```{r}
# Perch occurrences
i_po_site <- ggplot(data=ppdata, aes(x=study_site, y=i_percho_p, 
                                     fill=study_site)) + geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  xlab(" ") + 
  ylab(expression(paste("Adjusted perching \noccurrences intercept ", 
                        italic("(n)")))) + 
  annotate("text", x="Mulligans Flat", y=30, 
           label=parse(text="K"), size=10, hjust=-2)

# Display plot
print(i_po_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept - study site v perch occ.jpeg", 
       i_po_site, width=200, height=150, units="mm")
```

```{r}
# Move duration
i_md_site <- ggplot(data=ppdata, aes(x=study_site, y=i_moved_p, 
                                     fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  labs("") + xlab(" ") + 
  ylab("Adjusted quadrupedal movement\n duration intercept  (s)") + 
  annotate("text", x="Mulligans Flat", y=160, 
           label=parse(text="I"), size=10, hjust=-2)

# Display plot
print(i_md_site)
  
# Export plot as a jpeg file
ggsave(filename="output/plots/intercept - study site v move dur.jpeg",
       i_md_site, width=200, height=150, units="mm")
```

```{r}
# Sum of section visits
i_sumsect_site <- ggplot(data=ppdata, aes(x=study_site, y=i_sumsecto_p, 
                                          fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_y_continuous(breaks=seq(30, 70, 10), 
                     labels=seq(30, 70, 10), 
                     limits=c(30, 70)) + 
  xlab("") +
  ylab(expression(paste("Adjusted total arena \nsection visits intercept ", 
                        italic("(n)")))) + 
  annotate("text", x="Mulligans Flat", y=70, 
           label=parse(text="L"), size=9, hjust=-2)

# Display plot
print(i_sumsect_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept - study site v sum sections.jpeg", 
       i_sumsect_site, width=200, height=150, units="mm")
```

```{r}
# Total activity occurrences
i_act_site <- ggplot(data=ppdata, aes(x=study_site, y=i_totalacto_p, 
                                      fill=study_site)) + 
 geom_violin() + 
 geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_y_continuous(breaks=seq(150, 350, 100), 
                     labels=seq(150, 350, 100), 
                     limits=c(150, 350)) + 
  xlab("") + 
  ylab(expression(paste("Adjusted total activity \noccurrences intercept", 
                        italic("(n)")))) + 
  annotate("text", x="Mulligans Flat", y=350, 
           label=parse(text="M"), size=9, hjust=-2)

# Display plot
print(i_act_site)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept - study site v total activity.jpeg", 
       i_act_site, width=150, height=150, units="mm")
```

```{r}
# Combine plots
plot <- ggarrange(i_bs_site, i_ts_site, i_e_site, i_ld_site, i_gd_site, 
                  i_b_site, i_jd_site, i_jo_site, i_md_site, i_pd_site, 
                  i_po_site, i_sumsect_site, i_act_site, nrow=5, ncol=3)

# Annotate plot
plot <- annotate_figure(plot, 
        bottom=text_grob("Study site", size=25))

# Display plot
print(plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/intercept plots.jpeg", 
       plot, width=450, height=650, units="mm")
```

## Slope GLMMs

Test behaviour slope (plasticity) against independent variables.

```{r}
# 
mod <- lmer(s_bait_p ~ sex + body_weight_kg + 
              study_site + cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(s_emerge_p ~ sex + body_weight_kg + 
              study_site + cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(s_foodd_p ~ sex + body_weight_kg + 
              study_site + cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(s_foodo_p ~ sex + body_weight_kg + 
              study_site + cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(s_groomd_p ~ sex + body_weight_kg + 
              study_site + cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(s_groomo_p ~ sex + body_weight_kg + 
              study_site + cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(s_jumpd_p ~ sex + body_weight_kg + 
              study_site + cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(s_jumpo_p ~ sex + body_weight_kg + 
              study_site + cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(s_legsd_p ~ sex + body_weight_kg + 
              study_site + cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(s_legso_p ~ sex + body_weight_kg + 
              study_site + cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(s_moved_p ~ sex + body_weight_kg + 
              study_site + cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(s_moveo_p ~ sex + body_weight_kg + study_site + cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(s_perchd_p ~ sex + body_weight_kg + 
              study_site + cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(s_percho_p ~ sex + body_weight_kg + 
              study_site + cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(s_sumsecto_p ~ sex + body_weight_kg + 
              study_site + cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(s_totalacto_p ~ sex + body_weight_kg + 
              study_site + cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(s_bagstress_p ~ sex + body_weight_kg + 
              study_site + cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(s_trapstress_p ~ sex + body_weight_kg + 
              study_site + cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")

# 
mod <- lmer(s_tablestress_p ~ sex + body_weight_kg + 
              study_site + cond_n + age_n + (1|arena), 
            data=ppdata, na.action="na.fail")
```

## Tables with kableExtra

```{r}
# 
response_var <- all.vars(formula(mod))[1]

# 
tidy_results <- tidy(mod) %>%
  mutate_if(is.numeric, ~round(., digits=3))

# 
table <- tidy_results %>%
  mutate(p.value=ifelse(p.value <=0.05, cell_spec(p.value, bold=TRUE), p.value)) %>%
  kbl(caption=response_var, escape=FALSE) %>%
  kable_classic(full_width=F)

# 
table
```

## Slope AICc model selection

```{r}
# Food occ
mod_fos_cond <- lmer(s_foodo_p ~ cond_n + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

mod_fos_sex <- lmer(s_foodo_p ~ sex + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

mod_fos_weight <- lmer(s_foodo_p ~ body_weight_kg + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

models <- list(mod_fos_cond, mod_fos_sex, mod_fos_weight)
model.names <- c("Condition", "Sex", "Body weight")
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Legs occ
mod_los_cond <- lmer(s_legso_p ~ cond_n + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

mod_los_sex <- lmer(s_legso_p ~ sex + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

mod_los_weight <- lmer(s_legso_p ~ body_weight_kg + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

mod_los_site <- lmer(s_legso_p ~ study_site + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

models <- list(mod_los_cond, mod_los_sex, mod_los_weight, mod_los_site)
model.names <- c("Condition", "Sex", "Body weight", "Study site")
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Jump occ
mod_jos_cond <- lmer(s_jumpo_p ~ cond_n + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

mod_jos_weight <- lmer(s_jumpo_p ~ body_weight_kg + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

mod_jos_site <- lmer(s_jumpo_p ~ study_site + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

models <- list(mod_jos_cond, mod_jos_weight, mod_jos_site)
model.names <- c("Condition", "Body weight", "Study site")
aictab(cand.set=models, modnames=model.names)

```

```{r}
# Move dur
mod_mds_cond <- lmer(s_moved_p ~ cond_n + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

mod_mds_weight <- lmer(s_moved_p ~ body_weight_kg + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

mod_mds_site <- lmer(s_moved_p ~ study_site + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

models <- list(mod_mds_cond, mod_mds_weight, mod_mds_site)
model.names <- c("Condition", "Body weight", "Study site")
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Move occ
mod_mos_cond <- lmer(s_moveo_p ~ cond_n + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

mod_mos_weight <- lmer(s_moveo_p ~ body_weight_kg + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

mod_mos_site <- lmer(s_moveo_p ~ study_site + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

mod_mos_sex <- lmer(s_moveo_p ~ sex + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

models <- list(mod_mos_cond, mod_mos_weight, mod_mos_site, mod_mos_sex)
model.names <- c("Condition", "Body weight", "Study site", "Sex")
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Table stress
mod_tabs_cond <- lmer(s_tablestress_p ~ cond_n + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

mod_tabs_weight <- lmer(s_tablestress_p ~ body_weight_kg + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

mod_tabs_site <- lmer(s_tablestress_p ~ study_site + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

models <- list(mod_tabs_cond, mod_tabs_weight, mod_tabs_site)
model.names <- c("Condition", "Body weight", "Study site")
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Sum section
mod_sums_weight <- lmer(s_sumsecto_p ~ body_weight_kg + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

mod_sums_sex <- lmer(s_sumsecto_p ~ sex + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

models <- list(mod_sums_weight, mod_sums_sex)
model.names <- c("Body weight", "Sex")
aictab(cand.set=models, modnames=model.names)
```

```{r}
# Total act
mod_tots_cond <- lmer(s_totalacto_p ~ cond_n + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

mod_tots_weight <- lmer(s_totalacto_p ~ body_weight_kg + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

mod_tots_sex <- lmer(s_totalacto_p ~ sex + (1|arena), 
            data=ppdata, control=control_ml, na.action="na.fail")

models <- list(mod_tots_cond, mod_tots_weight, mod_tots_sex)
model.names <- c("Condition", "Body weight", "Sex")
aictab(cand.set=models, modnames=model.names)
```

## Plasticity by weight plots

```{r}
# Food occ v weight
food <- ggplot(data=ppdata, aes(x=body_weight_kg, y=s_foodo_p)) + 
 geom_point() + 
  geom_smooth(method="lm", se=TRUE, 
              colour="# 440154", fill="# 82568D") + 
  theme_minimal() + 
    theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19),  
       axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") +  
  scale_y_continuous(breaks=seq(-30, 10, 10), 
                     labels=seq(-30, 10, 10), 
                     limits=c(-30, 10)) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Adjusted food \ninteraction occurrences slope", 
                        italic(" (n)")))) + 
  annotate("text", x=1.6, y=10, label="A", size=10, hjust=1)

# Display plot
print(food)
```

```{r}
# Legs occ v weight
legso_weight <- ggplot(data=ppdata, aes(x=body_weight_kg, y=s_legso_p)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, 
              colour="# 472D7B", fill="# 8473A7") + 
  theme_minimal() + 
    theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19),  
       axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") +  
  scale_y_continuous(breaks=seq(-100, 25, 25), 
                     labels=seq(-100, 25, 25), 
                     limits=c(-100, 25)) + 
  labs("") + xlab("") + 
  ylab(expression(paste("Adjusted hindleg stand \noccurrences slope",
                        italic(" (n)")))) + 
  annotate("text", x=1.6, y=25, label="B", size=10, hjust=1)

# Display plot
print(legso_weight)
```

```{r}
# Legs dur v weight
legsd_weight <- ggplot(data=ppdata, aes(x=body_weight_kg, y=s_legsd_p)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, 
              colour="# 3B528B", fill="# 7C8CB2") + 
  theme_minimal() + 
    theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19),  
        axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") +  
  scale_y_continuous(breaks=seq(-40, 50, 20), 
                     labels=seq(-40, 50, 20), 
                     limits=c(-40, 50)) + 
  labs("") + xlab("") + 
  ylab("Adjusted hindleg stand \nduration slope (s)") + 
  annotate("text", x=1.6, y=50, label="C", size=10, hjust=1)

# Display plot
print(legsd_weight)
```

```{r}
# Move dur v weight
moveweight <- ggplot(data=ppdata, aes(x=body_weight_kg, y=s_moved_p)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, colour="# 2C728E", fill="# 72A1B4") + 
  theme_minimal() + 
    theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19),  
       axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) +    
  geom_hline(yintercept=0, linetype="dashed", color="grey") +  
  scale_y_continuous(breaks=seq(-150, 50, 50), 
                     labels=seq(-150, 50, 50), 
                     limits=c(-170, 70)) + 
  xlab("") + ylab("Adjusted quadrupedal \nmovement duration slope (s)") + 
  annotate("text", x=1.6, y=70, label="D", size=10, hjust=1)

# Display plot
print(moveweight)
```

```{r}
# Move occ v weight
moveo_weight <- ggplot(data=ppdata, aes(x=body_weight_kg, y=s_moveo_p)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, 
              colour="# 21908C", fill="# 6BB5B2") + 
  theme_minimal() + 
  theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19),  
       axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") +  
  scale_y_continuous(breaks=seq(-150, 50, 50), 
                     labels=seq(-150, 50, 50), 
                     limits=c(-150, 50)) + 
  xlab("") + 
  ylab(expression(paste("Adjusted quadrupedal \nmovement occurrences slope ", 
                        italic(" (n)")))) + 
  annotate("text", x=1.6, y=50, label="E", size=10, hjust=1)

# Display plot
print(moveo_weight)
```

```{r}
# Sums sect v weight
sum_weight <- ggplot(data=ppdata, aes(x=body_weight_kg, y=s_sumsecto_p)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, colour="# 27AD81", fill="# 6FC8AB") + 
  theme_minimal() + 
    theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19),  
       axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") +  
  scale_y_continuous(breaks=seq(-40, 0, 20), 
                     labels=seq(-40, 0, 20), 
                     limits=c(-40, 0)) + 
  xlab("") + 
  ylab(expression(paste("Adjusted total\n arena section visits slope", 
                        italic(" (n)")))) + 
  annotate("text", x=1.6, y=0, label="F", size=10, hjust=1)

# Display plot
#print(sum_weight)
```

```{r}
# Total act v weight
tot_weight <- ggplot(data=ppdata, aes(x=body_weight_kg, y=s_totalacto_p)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, colour="# 5DC863", fill="# 93DA97") + 
  theme_minimal() + 
    theme(legend.position="right", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19),  
       axis.text.x=element_text(size=19), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) +  
  geom_hline(yintercept=0, linetype="dashed", color="grey") +  
  scale_y_continuous(breaks=seq(-300, 10, 50), 
                     labels=seq(-300, 10, 50), 
                     limits=c(-300, 20)) + 
  xlab("") + 
  ylab(expression(paste("Adjusted total\n activity slope", italic(" (n)")))) + 
  annotate("text", x=1.6, y=0, label="G", size=10, hjust=1)

# Display plot
print(tot_weight)
```

```{r}
# Combine plots
plot <- ggarrange(food, legso_weight, legsd_weight, moveweight, 
                  moveo_weight, sum_weight, tot_weight, 
                  nrow=3, ncol=3)

# Annotate plot
plot <- annotate_figure(plot, 
        bottom=text_grob("Body weight (kg)", size=25))

# Display plot
print(plot)

# Export plot as a jpeg file
ggsave(filename="output/plots/slope - weight plots.jpeg", 
       plot, width=350, height=400, units="mm")
```

## Plasticity by site plots

```{r}
# Assign custom numbers per site
custom_colors <- c("Goorooyarroo"="# 2D718E", 
                   "Mulligans Flat"="# B8DE29")
```

```{r}
# Food interaction dur violin
s_fd_site <- ggplot(data=ppdata, aes(x=study_site, y=s_foodd_p, 
                                     fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") +  
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19),  
       axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) +    
  scale_y_continuous(breaks=seq(-100, 60, 20), 
                     labels=seq(-100, 60, 20), 
                     limits=c(-100, 60)) + 
  labs("") + xlab("") + 
  ylab("Adjusted food \ninteraction duration slope (s)") + 
  annotate("text", x="Mulligans Flat", y=60, 
           label="Ai", size=10, hjust=-2)

# Display plot
print(s_fd_site)
```

```{r}
# Food dur vs site smooth
food <- ggplot(data=d2pred, aes(x=assay_number, y=foodd_p, 
                                color=study_site, fill=study_site)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, aes(fill=study_site)) + 
  theme_minimal() + 
    theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19),  
       axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") + 
  scale_y_continuous(breaks=seq(-50, 100, 25), 
                     labels=seq(-50, 100, 25), 
                     limits=c(-50, 110)) + 
  scale_x_continuous(breaks=c(min(d2pred$assay_number), 
                              max(d2pred$assay_number))) + 
  labs(color="Study site", fill="Study site") + xlab("") + 
  ylab("Adjusted food \ninteraction duration (s)") + 
  scale_color_manual(values=custom_colors) + 
  scale_fill_manual(values=custom_colors) + 
  annotate("text", x=max(d2pred$assay_number), y=110, 
           label="Aii", size=10, hjust=1)

# Display plot
print(food)
```

```{r}
# Jump + climb dur violin
s_jd_site <- ggplot(data=ppdata, aes(x=study_site, y=s_jumpd_p, 
                                     fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") + 
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19),  
       axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  scale_y_continuous(breaks=seq(-150, 50, 50), 
                     labels=seq(-150, 50, 50), 
                     limits=c(-150, 50)) + 
  xlab("") + 
  ylab("Adjusted jumping + \nclimbing duration slope (s)") + 
  annotate("text", x="Mulligans Flat", y=50, 
           label="Bi", size=10, hjust=-2)

# Display plot
print(s_jd_site)
```

```{r}
# Jump climb dur smooth
jump <- ggplot(data=d2pred, aes(x=assay_number, y=jumpd_p, 
                                color=study_site, fill=study_site)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, aes(fill=study_site)) + 
  theme_minimal() + 
    theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19),  
       axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") +  
  scale_x_continuous(breaks=c(min(d2pred$assay_number), 
                              max(d2pred$assay_number))) + 
  labs(color="Study site", fill="Study site") + xlab("") + 
  ylab("Adjusted jumping + \nclimbing duration (s)") + 
  scale_color_manual(values=custom_colors) + 
  scale_fill_manual(values=custom_colors) + 
  annotate("text", x=max(d2pred$assay_number), y=200, 
           label="Bii", size=10, hjust=1)

# Display plot
print(jump)
```

```{r}
# Jump + climb occurrences violin
s_jo_site <- ggplot(data=ppdata, aes(x=study_site, y=s_jumpo_p, 
                                     fill=study_site)) + 
 geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") + 
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19),  
       axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_y_continuous(breaks=seq(-60, 0, 20), 
                     labels=seq(-60, 0, 20), 
                     limits=c(-60, 0)) + 
  xlab(" ") + 
  ylab(expression(paste("Adjusted jumping + \nclimbing occurrences slope  ", 
                        italic("(n)")))) + 
  annotate("text", x="Mulligans Flat", y=0, 
           label="Ci", size=10, hjust=-2)

# Display plot
print(s_jo_site)
```

```{r}
# Jump climb occ smooth
jump2 <- ggplot(data=d2pred, aes(x=assay_number, y=jumpo_p, 
                                 color=study_site, fill=study_site)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, aes(fill=study_site)) + 
  theme_minimal() + 
    theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19),  
       axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") + 
  scale_x_continuous(breaks=c(min(d2pred$assay_number), 
                              max(d2pred$assay_number))) + 
  labs(color="Study site", fill="Study site") + xlab("") + 
  ylab(expression(paste("Adjusted jumping + \nclimbing occurrences ", 
                        italic("(n)"), ""))) + 
  scale_color_manual(values=custom_colors) + 
  scale_fill_manual(values=custom_colors) + 
  annotate("text", x=max(d2pred$assay_number), y=80, 
           label="Cii", size=10, hjust=1)

# Display plot
print(jump2)
```

```{r}
# Latency to emerge violin
s_e_site <- ggplot(data=ppdata, aes(x=study_site, y=s_emerge_p, 
                                    fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") + 
  scale_y_continuous(breaks=seq(-10, 50, 10), 
                     labels=seq(-10, 50, 10), 
                     limits=c(-10, 50)) + 
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19),  
       axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) +  
  labs("") + xlab("") + 
  ylab("Adjusted latency to \nemerge slope (s)") + 
  annotate("text", x="Mulligans Flat", y=50, 
           label="Di", size=10, hjust=-2)

# Display plot
print(s_e_site)
```

```{r}
# Latency to emerge smooth
emerge <- ggplot(data=d2pred, aes(x=assay_number, y=emerge_p, 
                                  color=study_site, fill=study_site)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, aes(fill=study_site)) + 
  theme_minimal() + 
    theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19),  
       axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) +  
  geom_hline(yintercept=0, linetype="dashed", color="grey") + 
  scale_x_continuous(breaks=c(min(d2pred$assay_number), 
                              max(d2pred$assay_number))) + 
  scale_y_continuous(breaks=seq(-10, 50, 10), 
                     labels=seq(-10, 50, 10), 
                     limits=c(-10, 50)) + 
  labs(color="Study site", fill="Study site") + xlab("") + 
  ylab("Adjusted latency \nto emerge (s)") + 
  scale_color_manual(values=custom_colors) + 
  scale_fill_manual(values=custom_colors) + 
  annotate("text", x=max(d2pred$assay_number), y=50, 
           label="Dii", size=10, hjust=1)

# Display plot
print(emerge)
```

```{r}
# Perching duration violin
s_pd_site <- ggplot(data=ppdata, aes(x=study_site, y=s_perchd_p, 
                                     fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white",  
               shape=21, size=3, stroke=1) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") +  
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  scale_y_continuous(breaks=seq(-200, 200, 100), 
                     labels=seq(-200, 200, 100), 
                     limits=c(-200, 200)) + 
  labs("") + xlab(" ") + 
  ylab("Adjusted perching \nduration slope (s)") + 
  annotate("text", x="Mulligans Flat", y=200, 
           label="Ei", size=10, hjust=-2)

# Display plot
print(s_pd_site)
```

```{r}
# Perch dur smooth
perch <- ggplot(data=d2pred, aes(x=assay_number, y=perchd_p, 
                                 color=study_site, fill=study_site)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, aes(fill=study_site)) + 
  theme_minimal() + 
    theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") + 
  scale_x_continuous(breaks=c(min(d2pred$assay_number), 
                              max(d2pred$assay_number))) + 
  labs(color="Study site", fill="Study site") + xlab("") + 
  ylab("Adjusted perching \nduration (s)") + 
  scale_color_manual(values=custom_colors) + 
  scale_fill_manual(values=custom_colors) + 
  annotate("text", x=max(d2pred$assay_number), y=300, 
           label="Eii", size=10, hjust=1)

# Display plot
print(perch)
```

```{r}
# Perching occurrences violin
s_po_site <- ggplot(data=ppdata, aes(x=study_site, y=s_percho_p, 
                                     fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") +  
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  xlab("") + 
  ylab(expression(paste("Adjusted perching \noccurrences slope", 
                        italic(" (n)")))) + 
  annotate("text", x="Mulligans Flat", y=5, 
           label="Fi", size=10, hjust=-2)

# Display plot
print(s_po_site)
```

```{r}
# Perch occ smooth 
perch2 <- ggplot(data=d2pred, aes(x=assay_number, y=percho_p, 
                                  color=study_site, fill=study_site)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, aes(fill=study_site)) + 
  theme_minimal() + 
    theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 1, "cm")) + 
  scale_x_continuous(breaks=c(min(d2pred$assay_number), 
                              max(d2pred$assay_number))) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") + 
  labs(color="Study site", fill="Study site") + xlab("") + 
  ylab(expression(paste("Adjusted perching\n occurrences ",
                        italic("(n)"), ""))) + 
  scale_color_manual(values=custom_colors) + 
  scale_fill_manual(values=custom_colors) + 
  annotate("text", x=max(d2pred$assay_number), y=30, 
           label="Fii", size=10, hjust=1)

# Display plot
print(perch2)
```

```{r}
# Movement duration v site
s_md_site <- ggplot(data=ppdata, aes(x=study_site, y=s_moved_p, 
                                     fill=study_site)) + 
 geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") +  
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  labs("") + xlab("") + 
  ylab("Adjusted quadrupedal \nmovement duration slope (s)") + 
    annotate("text", x="Mulligans Flat", y=50, 
             label="Gi", size=10, hjust=-2)

# Display plot
print(s_md_site)
```

```{r}
# Move dur vs site 
move <- ggplot(data=d2pred, aes(x=assay_number, y=moved_p, 
                                color=study_site, fill=study_site)) + 
 geom_point() + 
  geom_smooth(method="lm", se=TRUE, aes(fill=study_site)) + 
  theme_minimal() + 
    theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") + 
  scale_x_continuous(breaks=c(min(d2pred$assay_number), 
                              max(d2pred$assay_number))) + 
  xlab("") + 
  ylab("Adjusted quadrupedal\n movement duration (s)") + 
  labs(color="Study site", fill="Study site") + 
  scale_color_manual(values=custom_colors) + 
  scale_fill_manual(values=custom_colors) + 
  annotate("text", x=max(d2pred$assay_number), 
           y=160, label="Gii", size=10, hjust=1)

# Display plot
print(move)
```

```{r}
# Bag stress rating violin
s_bs_site <- ggplot(data=ppdata, aes(x=study_site, y=s_bagstress_p, 
                                     fill=study_site)) + 
  geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white", 
               shape=21, size=3, stroke=1) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") + 
  scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  xlab("") + 
  ylab("Adjusted bag stress\n rating slope") + labs("") + 
  annotate("text", x="Mulligans Flat", y=0.2, 
           label="Hi", size=10, hjust=-2)

# Display plot
print(s_bs_site)
```

```{r}
# Bag stress vs site smooth
bag <- ggplot(data=d2pred, aes(x=assay_number, y=bagstress_p, 
                               color=study_site, fill=study_site)) + 
  geom_point() + 
  geom_smooth(method="lm", se=TRUE, aes(fill=study_site)) + 
  theme_minimal() + 
    theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  # geom_hline(yintercept=0, linetype="dashed", color="grey") + 
  scale_y_continuous(breaks=seq(0.9, 1.3, 0.1), 
                     labels=seq(0.9, 1.3, 0.1), 
                     limits=c(0.9, 1.3)) + 
  scale_x_continuous(breaks=c(min(d2pred$assay_number), 
                              max(d2pred$assay_number))) + 
  xlab("") + 
  ylab("Adjusted bag \nstress rating") + 
  labs(color="Study site", fill="Study site") + 
  scale_color_manual(values=custom_colors) + 
  scale_fill_manual(values=custom_colors) + 
  annotate("text", x=max(d2pred$assay_number), y=1.3, 
           label="Hii", size=10, hjust=1)

# Display plot
print(bag)
```

```{r}
# Table stress site violin
s_ts_site <- ggplot(data=ppdata, aes(x=study_site, y=s_tablestress_p, 
                                     fill=study_site)) + 
 geom_violin() + 
  geom_boxplot(col="grey20", fill="grey20", width=0.02, lwd=0.5) + 
  stat_summary(fun="median", geom="point", col="black", fill="white",  
               shape=21, size=3, stroke=1) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") + 
 scale_fill_manual (values=c("# 6B9BAF", "# CDE868")) + 
  theme_minimal() + 
  theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
  scale_y_continuous(breaks=seq(-0.1, 0.2, 0.1), 
                     labels=seq(-0.1, 0.2, 0.1), 
                     limits=c(-0.1, 0.2)) + 
  xlab("") + 
  ylab("Adjusted table \nstress rating slope") + labs("") + 
  annotate("text", x="Mulligans Flat", y=0.2, 
           label="Ii", size=10, hjust=-3)

# Display plot
print(s_ts_site)
```

```{r}
# Table stress vs site 
table <- ggplot(data=d2pred, aes(x=assay_number, y=tablestress_p, 
                                 color=study_site, fill=study_site)) + 
 geom_point() + 
  geom_smooth(method="lm", se=TRUE, aes(fill=study_site)) + 
  theme_minimal() + 
    theme(legend.position="none", 
        panel.grid=element_blank(), 
        axis.line.x=element_line(color="black"), 
        axis.line.y=element_line(color="black"), 
        text=element_text(size=19), 
       axis.text.x=element_text(size=18), 
        plot.margin=margin(0.5, 0.5, 0.5, 0.5, "cm")) + 
   scale_x_continuous(breaks=c(min(d2pred$assay_number), 
                               max(d2pred$assay_number))) + 
  geom_hline(yintercept=0, linetype="dashed", color="grey") + 
  xlab("") + 
  ylab("Adjusted table\n stress rating") + 
  labs(color="Study site", fill="Study site") + 
  scale_color_manual(values=custom_colors) + 
  scale_fill_manual(values=custom_colors) + 
  annotate("text", x=max(d2pred$assay_number), y=2, 
           label="Iii", size=10, hjust=1)

# Display plot
print(table)
```

```{r}
# Combine plots
plot <- ggarrange(s_fd_site, 	s_jd_site, 	s_jo_site, 
                  food, 	jump, 	jump2, 
                  s_e_site, 	s_pd_site, s_po_site, 
                  emerge, perch, perch2, 
                  s_md_site, s_bs_site, s_ts_site, 
                  move, bag, table, 
                  nrow=6, ncol=3)

# Export plot as a jpeg file
ggsave(plot, filename="output/plots/plasticity plots.jpeg", 
       height=700, width=450, units="mm")
```

# **Reproducibility and citation**

## Session information

```{r, eval=TRUE}
# Display R version, OS, and loaded packages
sessionInfo()
```

## Citation

Finally, we define functions to extract metadata from this repository to generate a `citation.cff` file that can then be read and exported (e.g., via [GitHub](https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/customizing-your-repository/about-citation-files)). 

```{r, eval=TRUE}
# Define function to extract repo metadata
extract_metadata <- function(rmd="analyses.Rmd") 
  {if (!requireNamespace("yaml", quietly=TRUE)) stop("Please install the 'yaml' package.")
   lines <- suppressWarnings(readLines(rmd))
   yaml_start <- which(lines=="---")[1]
   yaml_end <- which(lines=="---")[2]
   yaml_block <- lines[yaml_start:yaml_end]
   meta <- yaml::yaml.load(paste(yaml_block, collapse="\n"))
   date_iso <- tryCatch(
     as.character(as.Date(meta$date, format="%B %d, %Y")), 
     error=function(e) meta$date)
   repo <- tryCatch(system("git config --get remote.origin.url", intern=TRUE),
                    error=function(e) "")
   repo_url <- sub("git@github.com:", "https://github.com/", repo)
   repo_url <- sub(".git$", "", repo_url)
   list(title=meta$title,
        author=meta$author,
        date=date_iso,
        repo=repo_url,
        license="MIT")}

# Define function to write a citation.cff file
write_cff_from_rmd <- function(rmd="analyses.Rmd", 
                               cff_path="metadata/citation.cff") 
  {if (!requireNamespace("glue", quietly=TRUE)) stop("Please install the 'glue' package.")
   meta <- extract_metadata(rmd)
   cff <- glue::glue(
     "cff-version: 1.2.0\n",
     "message: \"If you use this code, please cite the following.\"\n",
     "title: \"{meta$title}\"\n",
     "authors:\n",
     "  - name: {meta$author}\n",
     "date-released: {meta$date}\n",
     "repository-code: {meta$repo}\n",
     "license: {meta$license}\n")
   writeLines(cff, cff_path)
   message(glue::glue("{cff_path} written"))}

# Define function to print the citation details
cite <- function(rmd="analyses.Rmd") 
  {if (!requireNamespace("crayon", quietly=TRUE)) stop("Please install the 'crayon' package.")
   if (!requireNamespace("glue", quietly=TRUE)) stop("Please install the 'glue' package.")
   meta <- extract_metadata(rmd)
   bold <- crayon::bold
   citation <- glue::glue(
     "\nIf you use this code, please cite the following:\n\n",
     "{bold(glue::glue('{meta$author} ({substr(meta$date, 1, 4)})'))} {meta$title}. ",
     "Coexistence Conservation Lab, Fenner School of Environment and Society, ",
     "The Australian National University, Canberra.\n",
     "{bold('Available at:')} {meta$repo}\n",
     "{bold('Date released:')} {meta$date}\n",
     "{bold('License:')} {meta$license}\n\n",
     "For more information, visit https://www.coexistenceconservationlab.org/")
   cat(citation)}

# Create citation file quietly
invisible(write_cff_from_rmd())

# Print citation details
cite()
```